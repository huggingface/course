<FrameworkSwitchCourse {fw} />

# рдореЙрдбрд▓ рдХрд┐ Trainer API рдХреЗ рд╕рд╛рде

<DocNotebookDropdown
  classNames="absolute z-10 right-0 top-0"
  options={[
    {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/chapter3/section3.ipynb"},
    {label: "Aws Studio", value: "https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/chapter3/section3.ipynb"},
]} />

<Youtube id="nvBXf7s7vTI"/>

ЁЯдЧ рдЯреНрд░рд╛рдиреНрд╕рдлрд╝реЙрд░реНрдорд░ рдПрдХ `рдЯреНрд░реЗрдирд░` рдХреНрд▓рд╛рд╕ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдЖрдкрдХреЛ рдЙрдкрд▓рдмреНрдз рдХрд░рд╛рдП рдЧрдП рдХрд┐рд╕реА рднреА рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрд▓ рдХреЛ рдЕрдкрдиреЗ рдбреЗрдЯрд╛рд╕реЗрдЯ рдкрд░  рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдорд┐рд▓рддреА рд╣реИред рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк рдЕрдВрддрд┐рдо рдЦрдВрдб рдореЗрдВ рд╕рднреА рдбреЗрдЯрд╛ рдкреВрд░реНрд╡ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХрд╛рд░реНрдп рдХрд░ рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЗ рдкрд╛рд╕ `рдЯреНрд░реЗрдирд░` рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╕ рдХреБрдЫ рд╣реА рдЪрд░рдг рд╢реЗрд╖ рд╣реИрдВред рд╕рдмрд╕реЗ рдХрдард┐рди рд╣рд┐рд╕реНрд╕рд╛ `Trainer.train()` рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд╛рддрд╛рд╡рд░рдг рдХреЛ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ CPU рдкрд░ рдмрд╣реБрдд рдзреАрдореА рдЧрддрд┐ рд╕реЗ рдЪрд▓реЗрдЧрд╛ред рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ GPU рд╕реЗрдЯ рдЕрдк рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк [Google Colab](https://colab.research.google.com/) рдкрд░ рдирд┐рдГрд╢реБрд▓реНрдХ GPUs рдпрд╛ TPUs рдХрд╛ рдПрдХреНрд╕реЗрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдХреЛрдб рдЙрджрд╛рд╣рд░рдг рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдиреЗ рдкрд┐рдЫрд▓реЗ рдЦрдВрдб рдореЗрдВ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЛ рдкрд╣рд▓реЗ рд╣реА рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рджрд┐рдпрд╛ рд╣реИред рдпрд╣рд╛рдВ рдПрдХ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╕рд╛рд░рд╛рдВрд╢ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬрд┐рд╕рдХреА рдЖрдкрдХреЛ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:

```py
from datasets import load_dataset
from transformers import AutoTokenizer, DataCollatorWithPadding

raw_datasets = load_dataset("glue", "mrpc")
checkpoint = "bert-base-uncased"
tokenizer = AutoTokenizer.from_pretrained(checkpoint)


def tokenize_function(example):
    return tokenizer(example["sentence1"], example["sentence2"], truncation=True)


tokenized_datasets = raw_datasets.map(tokenize_function, batched=True)
data_collator = DataCollatorWithPadding(tokenizer=tokenizer)
```

### рдкреНрд░рд╢рд┐рдХреНрд╖рдг

рд╣рдорд╛рд░реЗ `рдЯреНрд░реЗрдирд░` рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдкрд╣рд▓рд╛ рдХрджрдо рд╣реИ рдПрдХ `TrainingArguments` рдХреНрд▓рд╛рд╕  рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдирд╛ рдЬрд┐рд╕рдореЗрдВ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдФрд░ рдореВрд▓реНрдпрд╛рдВрдХрди рдХреЗ рд▓рд┐рдП `рдЯреНрд░реЗрдирд░` рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕рднреА рд╣рд╛рдЗрдкрд░рдкреИрд░рд╛рдореАрдЯрд░ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВрдЧреЗред рдПрдХрдорд╛рддреНрд░ рдЖрд░реНрдЧреВрдореЗрдиреНрдЯ рдЬреЛ рдЖрдкрдХреЛ рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рд╣реИ рд╡рд╣ рд╣реИ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЬрд╣рд╛рдВ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрд▓ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛, рд╕рд╛рде рд╣реА рд╕рд╛рде рдЪреМрдХрд┐рдпреЛрдВ рдХреЛ рднреАред рдмрд╛рдХреА рд╕рднреА рдХреЗ рд▓рд┐рдП, рдЖрдк рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рдореЗрдВ рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдПрдХ рдмреБрдирд┐рдпрд╛рджреА рдлрд╝рд╛рдЗрди-рдЯреНрдпреВрдирд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

```py
from transformers import TrainingArguments

training_args = TrainingArguments("test-trainer")
```

<Tip>

ЁЯТб рдпрджрд┐ рдЖрдк рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХреЗ рджреМрд░рд╛рди рдЕрдкрдиреЗ рдореЙрдбрд▓ рдХреЛ рд╣рдм рдкрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЕрдкрд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк `TrainingArguments` рдореЗрдВ `push_to_hub=True` рдХреЗ рд╕рд╛рде рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╣рдо рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ [рдЕрдзреНрдпрд╛рдп 4](/course/chapter4/3) рдореЗрдВ рдФрд░ рдЬрд╛рдиреЗрдВрдЧреЗ

</Tip>

рджреВрд╕рд░рд╛ рдХрджрдо рд╣рдорд╛рд░реЗ рдореЙрдбрд▓ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдирд╛ рд╣реИред [рдкрд┐рдЫрд▓реЗ рдЕрдзреНрдпрд╛рдп](/course/chapter2) рдХреА рддрд░рд╣, рд╣рдо `AutoModelForSequenceClassification` рд╡рд░реНрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ, рджреЛ рд▓реЗрдмрд▓ рдХреЗ рд╕рд╛рде :

```py
from transformers import AutoModelForSequenceClassification

model = AutoModelForSequenceClassification.from_pretrained(checkpoint, num_labels=2)
```

рдЖрдк рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ [рдЕрдзреНрдпрд╛рдп 2](/course/chapter2) рдХреЗ рд╡рд┐рдкрд░реАрдд, рдЖрдкрдХреЛ рдЗрд╕ рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрд▓ рдХреЛ рдЗрдиреНрд╕реНрдЯреИрдиреНрд╢реАрдРрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдПрдХ рдЪреЗрддрд╛рд╡рдиреА рдорд┐рд▓рддреА рд╣реИред рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ BERT рдХреЛ рд╡рд╛рдХреНрдпреЛрдВ рдХреЗ рдЬреЛрдбрд╝реЗ рдХрд╛ рд╡рд░реНрдЧреАрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреВрд░реНрд╡ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрд▓ рдХреЗ рдкреНрд░рдореБрдЦ рдХреЛ рддреНрдпрд╛рдЧ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рдмрдЬрд╛рдпреЗ рдЕрдиреБрдХреНрд░рдо рд╡рд░реНрдЧреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рдПрдХ рдирдпрд╛ рдкреНрд░рдореБрдЦ рдбрд╛рд▓рд╛ рдЧрдпрд╛ рд╣реИред рдЗрди рдЪреЗрддрд╛рд╡рдирд┐рдпреЛрдВ рд╕реЗ рд╕рдВрдХреЗрдд рдорд┐рд▓рддрд╛ рд╣реИ рдХрд┐ рдХреБрдЫ рд╡рдЬрд╝рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ (рддреНрдпрд╛рдЧреЗ рдЧрдП рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХреЗ рдкреНрд░рдореБрдЦ рдХреЗ рдЕрдиреБрд░реВрдк) рдФрд░ рдХреБрдЫ рдЕрдиреНрдп рдХреНрд░рдорд░рд╣рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░рд╛рд░рдВрдн рдХрд┐рдП рдЧрдП рдереЗ (рдирдП рдкреНрд░рдореБрдЦ рдХреЗ рд▓рд┐рдП рд╡рд╛рд▓реЗ)ред рдпрд╣ рд╕рдорд╛рдкрди рдЖрдкрдХреЛ рдореЙрдбрд▓ рдХреЛ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЛрддреНрд╕рд╛рд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд╕рд╛рде рд╣реЛрдЧрд╛, рдЬреЛ рдХрд┐ рдЕрдм рд╣рдо рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВред

рдПрдХ рдмрд╛рд░ рдЬрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╣рдорд╛рд░рд╛ рдореЙрдбрд▓ рд╣реЛрдЧрд╛, рддреЛ рд╣рдо рдПрдХ `Trainer` рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдЕрдм рддрдХ рдХреА рдирд┐рд░реНрдорд┐рдд рд╕рднреА рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдкрд╛рд╕ рдХрд░рдХреЗ рдХрд░ рд╕рдХрддреЗ рд╣реИ тАФ `model`, `training_args`, рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдФрд░ рд╕рддреНрдпрд╛рдкрди рдбреЗрдЯрд╛рд╕реЗрдЯ, рд╣рдорд╛рд░реЗ `data_collator`, рдФрд░ рд╣рдорд╛рд░реЗ `tokenizer`:

```py
from transformers import Trainer

trainer = Trainer(
    model,
    training_args,
    train_dataset=tokenized_datasets["train"],
    eval_dataset=tokenized_datasets["validation"],
    data_collator=data_collator,
    tokenizer=tokenizer,
)
```

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЬрдм рдЖрдк `tokenizer` рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдпрд╣рд╛рдВ рдХрд┐рдпрд╛ рдерд╛, рддреЛ `Trainer` рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ `data_colllator` рдПрдХ `DataCollatorWithPadding` рд╣реЛрдЧрд╛ рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЗрд╕рд▓рд┐рдП рдЖрдк рдЗрд╕ рдХреЙрд▓ рдореЗрдВ `data_collator=data_collator` рд▓рд╛рдЗрди рдХреЛ рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдкрдХреЛ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреЗ рдЗрд╕ рднрд╛рдЧ рдХреЛ рдЦрдВрдб 2 рдореЗрдВ рджрд┐рдЦрд╛рдирд╛ рдлрд┐рд░ рднреА рдорд╣рддреНрд╡рдкреВрд░реНрдг рдерд╛!

рдореЙрдбрд▓ рдХреЛ рд╣рдорд╛рд░реЗ рдбреЗрдЯрд╛рд╕реЗрдЯ рдкрд░ рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдмрд╕ рдЕрдкрдиреЗ `Trainer` рдХреЗ `train()` рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛:

```py
trainer.train()
```

рдпрд╣ рдлрд╛рдЗрди-рдЯреНрдпреВрдирд┐рдВрдЧ рдХреЛ рд╢реБрд░реВ рдХрд░реЗрдЧрд╛ (рдЬрд┐рд╕рдореЗрдВ GPU рдкрд░ рдХреБрдЫ рдорд┐рдирдЯ рд▓рдЧрдиреЗ рдЪрд╛рд╣рд┐рдП) рдФрд░ рд╣рд░ 500 рдХрджрдо рдкрд░ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд▓реЙрд╕ рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХрд░реЗрдЧрд╛ ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдЖрдкрдХреЛ рдпрд╣ рдирд╣реАрдВ рдмрддрд╛рдПрдЧрд╛ рдХрд┐ рдЖрдкрдХрд╛ рдореЙрдбрд▓ рдХрд┐рддрдирд╛ рдЕрдЪреНрдЫрд╛ (рдпрд╛ рдЦрд░рд╛рдм) рдкреНрд░рджрд░реНрд╢рди рдХрд░ рд░рд╣рд╛ рд╣реИред рдпрд╣ рд╣реИ рдХреНрдпреЛрдВрдХрд┐:

1. рд╣рдордиреЗ `Trainer` рдХреЛ рдирд╣реАрдВ рдмрддрд╛рдпрд╛ рдХреА рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХреЗ рджреМрд░рд╛рди рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП  `evaluation_strategy` рдХреЛ рдпрд╛ рддреЛ `"steps"`(рд╣рд░ `eval_steps` рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░реЗрдВ) рдпрд╛ `"epoch"` (рдкреНрд░рддреНрдпреЗрдХ рдПрдкреЙрдХ рдХреЗ рдЕрдВрдд рдореЗрдВ рдореВрд▓реНрдпрд╛рдВрдХрди) рдХреЛ рд╕реЗрдЯ рдХрд░реЗред
2. рд╣рдордиреЗ `Trainer` рдХреЛ `compute_metrics()` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬреЛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХреЗ рджреМрд░рд╛рди рдореАрдЯреНрд░рд┐рдХ рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ (рдЕрдиреНрдпрдерд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдиреЗ рдХреЗрд╡рд▓ рд▓реЙрд╕ рдХреЛ рдореБрджреНрд░рд┐рдд рдХрд┐рдпрд╛ рд╣реЛрдЧрд╛, рдЬреЛ рдмрд╣реБрдд рд╕рд╣рдЬ рд╕рдВрдЦреНрдпрд╛ рдирд╣реАрдВ рд╣реИ)


### рдореВрд▓реНрдпрд╛рдВрдХрди

рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рд╣рдо рдПрдХ рдЙрдкрдпреЛрдЧреА `compute_metrics()` рдлрд╝рдВрдХреНрд╢рди рдХреИрд╕реЗ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдЧрд▓реА рдмрд╛рд░ рдЬрдм рд╣рдо рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХрд░реЗрдВрдЧреЗ рддреЛ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдПрдХ `EvalPrediction` рдСрдмреНрдЬреЗрдХреНрдЯ рд▓реЗрдирд╛ рд╣реЛрдЧрд╛ (рдЬреЛ рдПрдХ `predictions` рдлрд╝реАрд▓реНрдб рдФрд░ рдПрдХ `label_ids` рдлрд╝реАрд▓реНрдб рдХреЗ рд╕рд╛рде рдПрдХ рдирд╛рдорд┐рдд рдЯрдкрд▓ рд╣реИ) рдФрд░ рд▓реМрдЯрд╛рдПрдЧрд╛ рдПрдХ рдбрд┐рдХреНрд╢рдирд░реА рдЬреЛ рдореИрдк рдХрд░реЗрдЧрд╛ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреЛ рдлрд╝реНрд▓реЛрдЯ рдореЗрдВ (рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рд▓реМрдЯрд╛рдП рдЧрдП рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдХреЗ рдирд╛рдо рд╣реИрдВ, рдФрд░ рдлрд╝реНрд▓реЛрдЯ рдЙрдирдХреА рд╡реИрд▓реНрдпреВрдЬ)ред рд╣рдорд╛рд░реЗ рдореЙрдбрд▓ рд╕реЗ рдХреБрдЫ рдкреНрд░рд┐рдбрд┐рдХреНрд╢рдиреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо `Trainer.predict()` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

```py
predictions = trainer.predict(tokenized_datasets["validation"])
print(predictions.predictions.shape, predictions.label_ids.shape)
```

```python out
(408, 2) (408,)
```

`predict()` рд╡рд┐рдзрд┐ рдХрд╛ рдЖрдЙрдЯрдкреБрдЯ рдирд╛рдорд┐рдд рдЯрдкрд▓ рд╣реИ рддреАрди рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рд╕рд╛рде : `predictions`, `label_ids`, рдФрд░ `metrics`ред `metrics` рдлрд╝реАрд▓реНрдб рдореЗрдВ рдХреЗрд╡рд▓ рдкрд╛рд╕ рдХрд┐рдП рдЧрдП рдбреЗрдЯрд╛рд╕реЗрдЯ рдкрд░ рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ рд▓реЙрд╕ рд╣реЛрдЧрд╛, рд╕рд╛рде рд╣реА рд╕рд╛рде рдХреБрдЫ рд╕рдордп рдореАрдЯреНрд░рд┐рдХ (рдХреБрд▓ рдФрд░ рдФрд╕рдд рд░реВрдк рд╕реЗ рдкреНрд░рд┐рдбрд┐рдХреНрдЯ рдХрд░рдиреЗ рдореЗрдВ рдХрд┐рддрдирд╛ рд╕рдордп рд▓рдЧрд╛) рд╢рд╛рдорд┐рд▓ рд╣реЛрдВрдЧреЗред рдПрдХ рдмрд╛рд░ рдЬрдм рд╣рдо рдЕрдкрдирд╛ `compute_metrics()` рдлрд╝рдВрдХреНрд╢рди рдкреВрд░рд╛ рдХрд░ рд▓реЗрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ `рдЯреНрд░реЗрдирд░` рдХреЛ рдкрд╛рд╕ рдХрд░ рджреЗрддреЗ рд╣реИрдВ, рддреЛ рдЙрд╕ рдлрд╝реАрд▓реНрдб рдореЗрдВ `compute_metrics()` рджреНрд╡рд╛рд░рд╛ рд▓реМрдЯрд╛рдП рдЧрдП рдореАрдЯреНрд░рд┐рдХ рднреА рд╢рд╛рдорд┐рд▓ рд╣реЛрдВрдЧреЗред

рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, `predictions` рдПрдХ 2-рдбрд┐рдореЗрдиреНрд╢рдирд▓ рд╕рд░рдгреА рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЖрдХрд╛рд░ 408 x 2 (408 рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдбреЗрдЯрд╛рд╕реЗрдЯ рдореЗрдВ рддрддреНрд╡реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╣реИ)ред рд╡реЗ рдбреЗрдЯрд╛рд╕реЗрдЯ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рддрддреНрд╡ рдХреЗ рд▓рд┐рдП рд▓реЙрдЧрд┐рдЯ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рд╣рдордиреЗ `predict()` рдореЗрдВ рдкрд╛рд╕ рдХрд┐рдпрд╛ рд╣реИ (рдЬреИрд╕рд╛ рдХрд┐ рдЖрдкрдиреЗ [рдкрд┐рдЫрд▓реЗ рдЕрдзреНрдпрд╛рдп](/course/chapter2) рдореЗрдВ рджреЗрдЦрд╛ рдерд╛, рд╕рднреА рдЯреНрд░рд╛рдВрд╕рдлреЙрд░реНрдорд░ рдореЙрдбрд▓ рд▓реЙрдЧрд┐рдЯ рд▓реМрдЯрд╛рддреЗ рд╣реИрдВ)ред рдЙрдиреНрд╣реЗрдВ рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгрд┐рдпреЛрдВ рдпрд╛рдирд┐ рдкреНрд░рд┐рдбрд┐рдХреНрд╢рдиреНрд╕ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдиреНрд╣реЗрдВ рд╣рдо рдЕрдкрдиреЗ рд▓реЗрдмрд▓ рд╕реЗ рддреБрд▓рдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рдореЗрдВ рджреВрд╕рд░реА рдПрдХреНрд╕рд┐рд╕ рдкрд░ рдЕрдзрд┐рдХрддрдо рдореВрд▓реНрдп рдХреЗ рд╕рд╛рде рдЗрдиреНрдбреЗрдХреНрд╕ рд▓реЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:

```py
import numpy as np

preds = np.argmax(predictions.predictions, axis=-1)
```

рдЕрдм рд╣рдо рдЙрди `preds` рдХреА рддреБрд▓рдирд╛ рд▓реЗрдмрд▓ рд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╣рдорд╛рд░реЗ `compute_metric()` рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо ЁЯдЧ рдбреЗрдЯрд╛рд╕реЗрдЯ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдкрд░ рдирд┐рд░реНрднрд░ рд╣реИред рд╣рдо MRPC рдбреЗрдЯрд╛рд╕реЗрдЯ рд╕реЗ рдЬреБрдбрд╝реЗ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдЙрддрдиреА рд╣реА рдЖрд╕рд╛рдиреА рд╕реЗ рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рддрдиреА рдЖрд╕рд╛рдиреА рд╕реЗ рд╣рдордиреЗ рдбреЗрдЯрд╛рд╕реЗрдЯ рд▓реЛрдб рдХрд┐рдпрд╛, рдЗрд╕ рдмрд╛рд░ `load_metric()` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рдеред рдЗрд╕рдиреЗ рдПрдХ рд╡рд╕реНрддреБ рд▓реМрдЯрд╛рдпрд╛ рдЬрд┐рд╕рдореЗ рдПрдХ `compute()` рд╡рд┐рдзрд┐ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдо рдореАрдЯреНрд░рд┐рдХ рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

```py
from datasets import load_metric

metric = load_metric("glue", "mrpc")
metric.compute(predictions=preds, references=predictions.label_ids)
```

```python out
{'accuracy': 0.8578431372549019, 'f1': 0.8996539792387542}
```

рдЖрдкрдХреЛ рдорд┐рд▓рдиреЗ рд╡рд╛рд▓реЗ рд╕рдЯреАрдХ рдкрд░рд┐рдгрд╛рдо рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдореЙрдбрд▓ рд╣реЗрдб рдХреЗ рдХреНрд░рдорд░рд╣рд┐рдд рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рдмрджрд▓рд╛рд╡ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣рд╛рдВ, рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдорд╛рд░реЗ рдореЙрдбрд▓ рдХрд╛ рд╕рддреНрдпрд╛рдкрди рд╕реЗрдЯ рдкрд░ 85.78% рдХреА рд╕рдЯреАрдХрддрд╛ рд╣реИ рдФрд░ 89.97 рдХрд╛ F1 рд╕реНрдХреЛрд░ рд╣реИред рд╡реЗ рджреЛ  рдореЗрдЯреНрд░рд┐рдХреНрд╕ рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ GLUE рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдХреЗ рд▓рд┐рдП MRPC рдбреЗрдЯрд╛рд╕реЗрдЯ рдкрд░ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред [BERT рдкреЗрдкрд░](https://arxiv.org/pdf/1810.04805.pdf) рдореЗрдВ рдЯреЗрдмрд▓ рдиреЗ рдмреЗрд╕ рдореЙрдбрд▓ рдХреЗ рд▓рд┐рдП F1 рд╕реНрдХреЛрд░ 88.9 рдмрддрд╛рдпрд╛ред рд╡рд╣ рдПрдХ `uncased` рдореЙрдбрд▓ рдерд╛ рдЬрдмрдХрд┐ рд╣рдо рд╡рд░реНрддрдорд╛рди рдореЗрдВ `cased` рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдЬреЛ рдмреЗрд╣рддрд░ рдкрд░рд┐рдгрд╛рдо рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рддрд╛ рд╣реИред

рд╕рдм рдХреБрдЫ рдПрдХ рд╕рд╛рде рд▓рдкреЗрдЯрдХрд░, рд╣рдореЗрдВ рдЕрдкрдирд╛ `compute_metrics()` рдлрд╝рдВрдХреНрд╢рди рдорд┐рд▓рддрд╛ рд╣реИ:

```py
def compute_metrics(eval_preds):
    metric = load_metric("glue", "mrpc")
    logits, labels = eval_preds
    predictions = np.argmax(logits, axis=-1)
    return metric.compute(predictions=predictions, references=labels)
```

рдФрд░ рдЗрд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдПрдкреЙрдХ рдХреЗ рдЕрдВрдд рдореЗрдВ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХреЗ рдЙрдкрдпреЛрдЧ рдХреА рдХреНрд░рд┐рдпрд╛ рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣рд╛рдВ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рд╣рдо рдЗрд╕ `compute_metrics()` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдПрдХ рдирдпрд╛ `Trainer` рдХреИрд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ:

```py
training_args = TrainingArguments("test-trainer", evaluation_strategy="epoch")
model = AutoModelForSequenceClassification.from_pretrained(checkpoint, num_labels=2)

trainer = Trainer(
    model,
    training_args,
    train_dataset=tokenized_datasets["train"],
    eval_dataset=tokenized_datasets["validation"],
    data_collator=data_collator,
    tokenizer=tokenizer,
    compute_metrics=compute_metrics,
)
```

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╣рдо рдПрдХ рдирдпрд╛ `TrainingArguments` рдЙрд╕рдХреЗ `evaluation_strategy` рдЬрд┐рд╕реЗ рд╕реЗрдЯ рдХрд┐рдпрд╛ рд╣реИ `"epoch"` рдФрд░ рдПрдХ рдирдП рдореЙрдбрд▓ рдХреЗ рд╕рд╛рде рдмрдирд╛рддреЗ рд╣реИ тАФ рдЕрдиреНрдпрдерд╛, рд╣рдо рдХреЗрд╡рд▓ рдЙрд╕ рдореЙрдбрд▓ рдХрд╛ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдЬрд╛рд░реА рд░рдЦ рд░рд╣реЗ рд╣реЛрддреЗ рдЬрд┐рд╕реЗ рд╣рдордиреЗ рдкрд╣рд▓реЗ рд╣реА рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рд╣реИред рдПрдХ рдирдпрд╛ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд░рди рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдпрд╛рдирд┐ рдПрдХреНрд╕рдХреНрдпреВрдЯ рдХрд░рддреЗ рд╣реИрдВ:

```
trainer.train()
```

рдЗрд╕ рдмрд╛рд░, рдпрд╣ рд╕рддреНрдпрд╛рдкрди рд▓реЙрд╕ рдФрд░ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдХреА рд░рд┐рдкреЛрд░реНрдЯ рд╣рд░ рдПрдкреЙрдХ рдХреЗ рдЕрдВрдд рдореЗрдВ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд▓реЙрд╕ рдХреЗ рдКрдкрд░ рдХрд░реЗрдЧрд╛ред рдлрд┐рд░ рд╕реЗ, рдПрдХ рд╕рдЯреАрдХ рдПрдХреНрдпреВрд░реЗрд╕реА/F1 рд╕реНрдХреЛрд░ рдЬрд┐рд╕рдкреЗ рд╣рдо рдкрд╣реБрдВрдЪреЗ рдереЛреЬрд╛ рдЕрд▓рдЧ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЙрд╕рд╕реЗ рдЬреЛ рд╣рдордиреЗ рдкрд╛рдпрд╛, рдХреНрдпреЛрдВрдХрд┐ рдореЙрдбрд▓ рдХреЗ рд░реИрдВрдбрдо рд╣реЗрдб рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рдХрд╛рд░рдг, рд▓реЗрдХрд┐рди рдпрд╣ рдЙрд╕реА рдмреЙрд▓рдкрд╛рд░реНрдХ рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

`Trainer` рдХрдИ GPUs рдпрд╛ TPUs рдкрд░ рдмрд┐рд▓рдХреБрд▓ рд╣рдЯрдХрд░ рдХрд╛рдо рдХрд░реЗрдЧрд╛ рдФрд░ рдмрд╣реБрдд рд╕рд╛рд░реЗ рд╡рд┐рдХрд▓реНрдк рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдорд┐рд╢реНрд░рд┐рдд-рд╕рдЯреАрдХ рдкреНрд░рд╢рд┐рдХреНрд╖рдг (рдЕрдкрдиреЗ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдЖрд░реНрдЧреВрдореЗрдиреНрдЯ рдореЗрдВ `fp16 = True` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ)ред рд╣рдо рдЕрдзреНрдпрд╛рдп 10 рдореЗрдВ рдЗрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рд╣рд░ рдЪреАрдЬ рдкрд░ рдЕрдзреНрдпрдпрди рдХрд░реЗрдВрдЧреЗред

рдпрд╣ `Trainer` API рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдлрд╛рдЗрди-рдЯреНрдпреВрдирд┐рдВрдЧ рдХреЗ рдкрд░рд┐рдЪрдп рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред рдЕрдзрд┐рдХрд╛рдВрд╢ рд╕рд╛рдорд╛рдиреНрдп NLP рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдРрд╕рд╛ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг [рдЕрдзреНрдпрд╛рдп 7](course/chapter7) рдореЗрдВ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛,  рд▓реЗрдХрд┐рди рдЕрднреА рдХреЗ рд▓рд┐рдП рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рд╢реБрджреНрдз PyTorch рдореЗрдВ рд╡рд╣реА рдХрд╛рдо рдХреИрд╕реЗ рдХрд░реЗрдВред

<Tip>

тЬПя╕П **рдХреЛрд╢рд┐рд╢ рдХрд░рдХреЗ рджреЗрдЦреЗ!** GLUE SST-2 рдбреЗрдЯрд╛рд╕реЗрдЯ рдкрд░ рдПрдХ рдореЙрдбрд▓ рдХреЛ рдлрд╛рдЗрди-рдЯреНрдпреВрди рдХрд░реЗрдВ, рдбреЗрдЯрд╛ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдпрд╛рдирд┐ рдбреЗрдЯрд╛ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬрд┐рд╕реЗ рдЖрдкрдиреЗ рд╕реЗрдХреНрд╢рди 2 рдореЗрдВ рдХрд┐рдпрд╛ рдерд╛

</Tip>

