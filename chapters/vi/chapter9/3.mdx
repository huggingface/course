# Hi·ªÉu l·ªõp Interface

<DocNotebookDropdown
  classNames="absolute z-10 right-0 top-0"
  options={[
    {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/vi/chapter9/section3.ipynb"},
    {label: "Aws Studio", value: "https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/vi/chapter9/section3.ipynb"},
]} />

Trong ph·∫ßn n√†y, ch√∫ng ta s·∫Ω xem x√©t k·ªπ h∆°n v·ªÅ l·ªõp `Interface` v√† hi·ªÉu c√°c tham s·ªë ch√≠nh ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ t·∫°o ra n√≥.

## C√°ch t·∫°o m·ªôt Interface

B·∫°n s·∫Ω nh·∫≠n th·∫•y r·∫±ng l·ªõp `Interface` c√≥ 3 tham s·ªë b·∫Øt bu·ªôc:

`Interface(fn, inputs, outputs, ...)`

C√°c tham s·ªë n√†y l√†:

  - `fn`: h√†m d·ª± ƒëo√°n ƒë∆∞·ª£c bao b·ªçc b·ªüi giao di·ªán Gradio. H√†m n√†y c√≥ th·ªÉ nh·∫≠n m·ªôt ho·∫∑c nhi·ªÅu tham s·ªë v√† tr·∫£ v·ªÅ m·ªôt ho·∫∑c nhi·ªÅu gi√° tr·ªã
  - `inputs`: (c√°c) lo·∫°i th√†nh ph·∫ßn ƒë·∫ßu v√†o. Gradio cung c·∫•p nhi·ªÅu th√†nh ph·∫ßn ƒë∆∞·ª£c t·∫°o s·∫µn nh∆∞`"image"` hay `"mic"`.
  - `outputs`: (c√°c) lo·∫°i th√†nh ph·∫ßn ƒë·∫ßu ra. M·ªôt l·∫ßn n·ªØa, Gradio cung c·∫•p nhi·ªÅu th√†nh ph·∫ßn ƒë∆∞·ª£c t·∫°o s·∫µn, v√≠ d·ª•: `"image"` hay `"label"`.

ƒê·ªÉ c√≥ danh s√°ch ƒë·∫ßy ƒë·ªß c√°c th√†nh ph·∫ßn, [xem t√†i li·ªáu Gradio](https://gradio.app/docs). M·ªói th√†nh ph·∫ßn ƒë∆∞·ª£c t·∫°o s·∫µn c√≥ th·ªÉ ƒë∆∞·ª£c t√πy ch·ªânh b·∫±ng c√°ch kh·ªüi t·∫°o l·ªõp t∆∞∆°ng ·ª©ng v·ªõi th√†nh ph·∫ßn.

V√≠ d·ª•: nh∆∞ ch√∫ng ta ƒë√£ th·∫•y trong [ph·∫ßn tr∆∞·ªõc](/course/chapter9/2), thay v√¨ truy·ªÅn tham s·ªë `input` v√†o trong `"textbox"`, b·∫°n c√≥ th·ªÉ truy·ªÅn v√†o `Textbox(lines=7, label="Prompt")` ƒë·ªÉ t·∫°o m·ªôt h·ªôp vƒÉn b·∫£n c√≥ 7 d√≤ng v√† m·ªôt nh√£n.

H√£y xem m·ªôt v√≠ d·ª• kh√°c, l·∫ßn n√†y v·ªõi th√†nh ph·∫ßn `Audio`.

## M·ªôt v√≠ d·ª• ƒë∆°n gi·∫£n v·ªõi √¢m thanh

Nh∆∞ ƒë√£ ƒë·ªÅ c·∫≠p tr∆∞·ªõc ƒë√≥, Gradio cung c·∫•p nhi·ªÅu ƒë·∫ßu v√†o v√† ƒë·∫ßu ra kh√°c nhau.
V√¨ v·∫≠y, h√£y x√¢y d·ª±ng m·ªôt  `Interface` ho·∫°t ƒë·ªông v·ªõi √¢m thanh.

Trong v√≠ d·ª• n√†y, ch√∫ng t√¥i s·∫Ω x√¢y d·ª±ng m·ªôt h√†m chuy·ªÉn ƒë·ªïi √¢m thanh sang √¢m thanh m√† nh·∫≠n t·∫≠p tin √¢m thanh v√† ch·ªâ c·∫ßn ƒë·∫£o ng∆∞·ª£c n√≥.

Ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng th√†nh ph·∫ßn `Audio` cho ƒë·∫ßu v√†o. Khi s·ª≠ d·ª•ng th√†nh ph·∫ßn `Audio`, b·∫°n c√≥ th·ªÉ ch·ªâ ƒë·ªãnh xem b·∫°n c√≥ mu·ªën `source` c·ªßa √¢m thanh l√† m·ªôt t·ªáp m√† ng∆∞·ªùi d√πng
t·∫£i l√™n ho·∫∑c micr√¥ m√† ng∆∞·ªùi d√πng ghi l·∫°i gi·ªçng n√≥i c·ªßa h·ªç. Trong tr∆∞·ªùng h·ª£p n√†y, h√£y ƒë·∫∑t n√≥ th√†nh `"microphone"`. Ch·ªâ cho vui th√¥i, ch√∫ng ta s·∫Ω th√™m m·ªôt nh√£n v√†o ph·∫ßn  `Audio` c·ªßa m√¨nh c√≥ n·ªôi dung "Speak here...", nghƒ©a l√† "N√≥i ·ªü ƒë√¢y ...".

Ngo√†i ra, ch√∫ng ta mu·ªën nh·∫≠n √¢m thanh d∆∞·ªõi d·∫°ng m·∫£ng numpy ƒë·ªÉ ta c√≥ th·ªÉ d·ªÖ d√†ng "ƒë·∫£o ng∆∞·ª£c" n√≥ l·∫°i. V√¨ v·∫≠y, ch√∫ng ta s·∫Ω ƒë·∫∑t `"type"` l√† `"numpy"`, chuy·ªÉn ƒë·∫ßu v√†o
d·ªØ li·ªáu d∆∞·ªõi d·∫°ng m·ªôt b·ªô (`sample_rate`, `data`) trong h√†m c·ªßa ch√∫ng ta.

Ch√∫ng ta c≈©ng s·∫Ω s·ª≠ d·ª•ng th√†nh ph·∫ßn ƒë·∫ßu ra `Audio` c√≥ th·ªÉ t·ª± ƒë·ªông hi·ªÉn th·ªã m·ªôt b·ªô tuple v·ªõi t·ªëc ƒë·ªô m·∫´u v√† m·∫£ng d·ªØ li·ªáu ph·ª©c t·∫°p d∆∞·ªõi d·∫°ng t·ªáp √¢m thanh c√≥ th·ªÉ ph√°t. Trong tr∆∞·ªùng h·ª£p n√†y, ch√∫ng ta kh√¥ng c·∫ßn th·ª±c hi·ªán b·∫•t k·ª≥ t√πy ch·ªânh n√†o, v√¨ v·∫≠y cta s·∫Ω s·ª≠ d·ª•ng chu·ªói ph√≠m t·∫Øt `"audio"`.


```py
import numpy as np
import gradio as gr


def reverse_audio(audio):
    sr, data = audio
    reversed_audio = (sr, np.flipud(data))
    return reversed_audio


mic = gr.Audio(source="microphone", type="numpy", label="Speak here...")
gr.Interface(reverse_audio, mic, "audio").launch()
```

ƒêo·∫°n m√£ tr√™n s·∫Ω t·∫°o ra m·ªôt giao di·ªán gi·ªëng nh∆∞ b√™n d∆∞·ªõi (n·∫øu tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng y√™u c·∫ßu b·∫°n c·∫•p quy·ªÅn ƒë·ªëi v·ªõi micr√¥, <a href="https://huggingface.co/spaces/course-demos/audio-reverse" target="_blank">m·ªü b·∫£n demo sang m·ªôt tab kh√°c</a>.)

<iframe src="https://course-demos-audio-reverse.hf.space" frameBorder="0" height="250" title="Gradio app" class="container p-0 flex-grow space-iframe" allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>

B√¢y gi·ªù b·∫°n c√≥ th·ªÉ ghi l·∫°i gi·ªçng n√≥i c·ªßa m√¨nh v√† nghe th·∫•y ch√≠nh m√¨nh ƒëang n√≥i ng∆∞·ª£c l·∫°i - th·∫≠t ma qu√°i üëª!

## X·ª≠ l√Ω nhi·ªÅu ƒë·∫ßu v√†o v√† ƒë·∫ßu ra

Gi·∫£ s·ª≠ ch√∫ng ta c√≥ m·ªôt h√†m ph·ª©c t·∫°p h∆°n, v·ªõi nhi·ªÅu ƒë·∫ßu v√†o v√† ƒë·∫ßu ra. Trong v√≠ d·ª• d∆∞·ªõi ƒë√¢y, ch√∫ng ta c√≥ m·ªôt h√†m l·∫•y ch·ªâ m·ª•c th·∫£ xu·ªëng, gi√° tr·ªã thanh tr∆∞·ª£t v√† s·ªë, v√† tr·∫£ v·ªÅ m·ªôt m·∫´u √¢m thanh c·ªßa m·ªôt giai ƒëi·ªáu √¢m nh·∫°c.

H√£y xem c√°ch ch√∫ng ta chuy·ªÉn danh s√°ch c√°c th√†nh ph·∫ßn ƒë·∫ßu v√†o v√† ƒë·∫ßu ra, v√† xem li·ªáu b·∫°n c√≥ th·ªÉ theo d√µi nh·ªØng g√¨ ƒëang x·∫£y ra kh√¥ng.

Ch√¨a kh√≥a ·ªü ƒë√¢y l√† khi b·∫°n truy·ªÅn v√†o:
* danh s√°ch c√°c th√†nh ph·∫ßn ƒë·∫ßu v√†o, m·ªói th√†nh ph·∫ßn t∆∞∆°ng ·ª©ng v·ªõi m·ªôt tham s·ªë theo th·ª© t·ª±.
* danh s√°ch c√°c th√†nh ph·∫ßn ƒë·∫ßu ra, m·ªói th√†nh ph·∫ßn t∆∞∆°ng ·ª©ng v·ªõi m·ªôt gi√° tr·ªã tr·∫£ v·ªÅ.

ƒêo·∫°n m√£ b√™n d∆∞·ªõi cho th·∫•y c√°ch ba th√†nh ph·∫ßn ƒë·∫ßu v√†o x·∫øp h√†ng v·ªõi ba tham s·ªë c·ªßa h√†m `generate_tone()`:

```py
import numpy as np
import gradio as gr

notes = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"]


def generate_tone(note, octave, duration):
    sr = 48000
    a4_freq, tones_from_a4 = 440, 12 * (octave - 4) + (note - 9)
    frequency = a4_freq * 2 ** (tones_from_a4 / 12)
    duration = int(duration)
    audio = np.linspace(0, duration, duration * sr)
    audio = (20000 * np.sin(audio * (2 * np.pi * frequency))).astype(np.int16)
    return (sr, audio)


gr.Interface(
    generate_tone,
    [
        gr.Dropdown(notes, type="index"),
        gr.Slider(minimum=4, maximum=6, step=1),
        gr.Textbox(type="number", value=1, label="Duration in seconds"),
    ],
    "audio",
).launch()
```

<iframe src="https://course-demos-generate-tone.hf.space" frameBorder="0" height="450" title="Gradio app" class="container p-0 flex-grow space-iframe" allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>

### Ph∆∞∆°ng th·ª©c `launch()`

Cho ƒë·∫øn nay, ch√∫ng t√¥i ƒë√£ s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c `launch()` ƒë·ªÉ kh·ªüi ch·∫°y giao di·ªán, nh∆∞ng ch√∫ng ta ch∆∞a th·ª±c s·ª± th·∫£o lu·∫≠n v·ªÅ nh·ªØng g√¨ n√≥ l√†m.

Theo m·∫∑c ƒë·ªãnh, ph∆∞∆°ng th·ª©c `launch()` s·∫Ω kh·ªüi ch·∫°y b·∫£n demo trong m·ªôt m√°y ch·ªß web ƒëang ch·∫°y c·ª•c b·ªô. N·∫øu b·∫°n ƒëang ch·∫°y m√£ c·ªßa m√¨nh trong notebook Jupyter ho·∫∑c Colab, th√¨ Gradio s·∫Ω nh√∫ng GUI demo v√†o notebook ƒë·ªÉ b·∫°n c√≥ th·ªÉ d·ªÖ d√†ng s·ª≠ d·ª•ng.

B·∫°n c√≥ th·ªÉ t√πy ch·ªânh h√†nh vi c·ªßa `launch()` th√¥ng qua c√°c tham s·ªë kh√°c nhau:

   - `inline` - c√≥ hi·ªÉn th·ªã giao di·ªán n·ªôi tuy·∫øn tr√™n notebook Python hay kh√¥ng.
   - `inbrowser` - c√≥ t·ª± ƒë·ªông kh·ªüi ch·∫°y giao di·ªán trong tab m·ªõi tr√™n tr√¨nh duy·ªát m·∫∑c ƒë·ªãnh hay kh√¥ng.
   - `share` - c√≥ t·∫°o m·ªôt li√™n k·∫øt c√≥ th·ªÉ chia s·∫ª c√¥ng khai t·ª´ m√°y t√≠nh c·ªßa b·∫°n cho giao di·ªán hay kh√¥ng. Gi·ªëng nh∆∞ m·ªôt li√™n k·∫øt Google Drive!

Ch√∫ng t√¥i s·∫Ω tr√¨nh b√†y chi ti·∫øt h∆°n v·ªÅ tham s·ªë `share` trong ph·∫ßn ti·∫øp theo!

## ‚úèÔ∏è H√£y √°p d·ª•ng n√≥!

H√£y x√¢y d·ª±ng m·ªôt giao di·ªán cho ph√©p b·∫°n gi·ªõi thi·ªáu m√¥ h√¨nh **nh·∫≠n d·∫°ng gi·ªçng n√≥i**. ƒê·ªÉ l√†m cho n√≥ th√∫ v·ªã, ch√∫ng ta s·∫Ω ch·∫•p nh·∫≠n ho·∫∑c ƒë·∫ßu v√†o micr√¥ ho·∫∑c m·ªôt t·ªáp ƒë√£ t·∫£i l√™n.

Nh∆∞ th∆∞·ªùng l·ªá, ch√∫ng ta s·∫Ω t·∫£i m√¥ h√¨nh nh·∫≠n d·∫°ng gi·ªçng n√≥i c·ªßa m√¨nh b·∫±ng c√°ch s·ª≠ d·ª•ng h√†m `pipeline()` t·ª´ ü§ó Transformers.
N·∫øu b·∫°n c·∫ßn c·∫≠p nh·∫≠t nhanh, b·∫°n c√≥ th·ªÉ quay l·∫°i [ph·∫ßn ƒë√≥ trong Ch∆∞∆°ng 1](/course/chapter1/3). Ti·∫øp theo, ch√∫ng ta s·∫Ω tri·ªÉn khai m·ªôt h√†m `transcribe_audio()` ƒë·ªÉ x·ª≠ l√Ω √¢m thanh v√† tr·∫£ v·ªÅ phi√™n √¢m. Cu·ªëi c√πng, ch√∫ng ta s·∫Ω g√≥i h√†m n√†y trong m·ªôt `Interface` v·ªõi c√°c th√†nh ph·∫ßn `Audio` cho ƒë·∫ßu v√†o v√† ch·ªâ vƒÉn b·∫£n cho ƒë·∫ßu ra. Nh√¨n chung, m√£ cho ·ª©ng d·ª•ng n√†y nh∆∞ sau:

```py
from transformers import pipeline
import gradio as gr

model = pipeline("automatic-speech-recognition")


def transcribe_audio(mic=None, file=None):
    if mic is not None:
        audio = mic
    elif file is not None:
        audio = file
    else:
        return "You must either provide a mic recording or a file"
    transcription = model(audio)["text"]
    return transcription


gr.Interface(
    fn=transcribe_audio,
    inputs=[
        gr.Audio(source="microphone", type="filepath", optional=True),
        gr.Audio(source="upload", type="filepath", optional=True),
    ],
    outputs="text",
).launch()
```

N·∫øu tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng y√™u c·∫ßu b·∫°n c·∫•p quy·ªÅn ƒë·ªëi v·ªõi micr√¥, h√£y <a href="https://huggingface.co/spaces/course-demos/audio-reverse" target="_blank">m·ªü b·∫£n demo trong m·ªôt tab ri√™ng</a>.

<iframe src="https://course-demos-asr.hf.space" frameBorder="0" height="550" title="Gradio app" class="container p-0 flex-grow space-iframe" allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>

N√≥ ƒë√≥! B√¢y gi·ªù b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng giao di·ªán n√†y ƒë·ªÉ phi√™n √¢m √¢m thanh. Ch√∫ √Ω ·ªü ƒë√¢y r·∫±ng b·∫±ng c√°ch ƒë·∫∑t tham s·ªë `option` l√† `True`, ch√∫ng ta cho ph√©p ng∆∞·ªùi d√πng cung c·∫•p micr√¥ ho·∫∑c t·ªáp √¢m thanh (ho·∫∑c kh√¥ng, nh∆∞ng ƒëi·ªÅu ƒë√≥ s·∫Ω tr·∫£ l·∫°i th√¥ng b√°o l·ªói).

Ti·∫øp t·ª•c xem c√°ch chia s·∫ª giao di·ªán c·ªßa b·∫°n v·ªõi nh·ªØng ng∆∞·ªùi kh√°c!
