# å¤§æ•¸æ“š? ğŸ¤— Datasets ä¾†æ•‘æ´!

<CourseFloatingBanner chapter={5}
  classNames="absolute z-10 right-0 top-0"
  notebooks={[
    {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/zh-CN/chapter5/section4.ipynb"},
    {label: "Aws Studio", value: "https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/zh-CN/chapter5/section4.ipynb"},
]} />


å¦‚ä»Š,ä¸é›£ç™¼ç¾æˆ‘å€‘ç¶“å¸¸ä½¿ç”¨æ•¸GBçš„æ•¸æ“šé›†, ç‰¹åˆ¥æ˜¯å¦‚æœä½ æ‰“ç®—å¾é ­é–‹å§‹é è¨“ç·´åƒ BERT æˆ–è€… GPT-2 é€™æ¨£çš„è½‰æ›å™¨ã€‚ åœ¨é€™ç¨®æƒ…æ³ä¸‹, _åŠ è¼‰_ æ•¸æ“šé›†å°±æ˜¯ä¸€å€‹æŒ‘æˆ°ã€‚ä¾‹å¦‚, ç”¨æ–¼é è¨“ç·´ GPT-2 çš„ WebText èªæ–™åº«åŒ…å«è¶…é 800 è¬å€‹æ–‡æª”å’Œ 40 GB çš„æ–‡æœ¬ -- å°‡å…¶åŠ è¼‰åˆ°ç­†è¨˜æœ¬é›»è…¦çš„ RAM ä¸­å¯èƒ½æœƒè®“å®ƒæŠ“ç‹‚ï¼

å¹¸é‹çš„æ˜¯, ğŸ¤— Datasets æ—¨åœ¨å…‹æœé€™äº›é™åˆ¶ã€‚å®ƒé€šéå°‡æ•¸æ“šé›†ä½œç‚ºå…§å­˜æ˜ å°„æ–‡ä»¶ä¾†è™•ç†ï¼Œä¸¦é€šéåœ¨èªæ–™åº«ä¸­æµåŒ–æ¢ç›®ä¾†æ“ºè„«ç¡¬ç›¤é™åˆ¶, å¾è€Œä½¿ä½ é¿å…å…§å­˜ç®¡ç†å•é¡Œã€‚

<Youtube id="JwISwTCPPWo"/>

åœ¨æœ¬ç¯€ä¸­, æˆ‘å€‘å°‡æ¢ç´¢ğŸ¤— Datasets çš„ç‰¹æ€§ã€‚å®ƒæœ‰ä¸€å€‹ç¨±ç‚º [the Pile](https://pile.eleuther.ai)çš„825 GBçš„èªæ–™åº«ã€‚ è®“æˆ‘å€‘é–‹å§‹å§!

## ä»€éº¼æ˜¯Pile?

The Pile æ˜¯ç”±[EleutherAI](https://www.eleuther.ai)å‰µå»ºçš„ä¸€å€‹è‹±èªæ–‡æœ¬èªæ–™åº«, ç”¨æ–¼è¨“ç·´å¤§è¦æ¨¡èªè¨€æ¨¡å‹ã€‚å®ƒåŒ…å«å„ç¨®å„æ¨£çš„æ•¸æ“šé›†, æ¶µè“‹ç§‘å­¸æ–‡ç« , GitHub ä»£ç¢¼åº«ä»¥åŠéæ¿¾çš„Webæ–‡æœ¬ã€‚è¨“ç·´èªæ–™åº«åœ¨[14 GB chunks](https://the-eye.eu/public/AI/pile/), ä¸¦ä¸”ä½ ä¹Ÿå¯ä»¥ä¸‹è¼‰å¹¾å€‹[å–®ç¨çš„çµ„ä»¶](https://the-eye.eu/public/AI/pile_preliminary_components/)ã€‚ è®“æˆ‘å€‘å…ˆä¾†çœ‹çœ‹ PubMed Abstracts æ•¸æ“šé›†, å®ƒæ˜¯[PubMed](https://pubmed.ncbi.nlm.nih.gov/)ä¸Šçš„1500è¬ç¯‡ç”Ÿç‰©é†«å­¸å‡ºç‰ˆç‰©çš„æ‘˜è¦çš„èªæ–™åº«ã€‚ æ•¸æ“šé›†æ¡ç”¨[JSONè¡Œæ ¼å¼](https://jsonlines.org) ä¸¦ä½¿ç”¨`zstandard`åº«é€²è¡Œå£“ç¸®, æ‰€ä»¥æˆ‘å€‘é¦–å…ˆéœ€è¦å…ˆå®‰è£`zstandard`åº«:

```py
!pip install zstandard
```

æ¥ä¸‹ä¾†, æˆ‘å€‘å¯ä»¥ä½¿ç”¨[ç¬¬äºŒç¯€](/course/chapter5/2)ä¸­æ‰€å­¸çš„åŠ è¼‰é ç¨‹æ•¸æ“šé›†çš„æ–¹æ³•åŠ è¼‰æ•¸æ“šé›†:

```py
from datasets import load_dataset

# This takes a few minutes to run, so go grab a tea or coffee while you wait :)
data_files = "https://the-eye.eu/public/AI/pile_preliminary_components/PUBMED_title_abstracts_2019_baseline.jsonl.zst"
pubmed_dataset = load_dataset("json", data_files=data_files, split="train")
pubmed_dataset
```

```python out
Dataset({
    features: ['meta', 'text'],
    num_rows: 15518009
})
```

æˆ‘å€‘å¯ä»¥çœ‹åˆ°æˆ‘å€‘çš„æ•¸æ“šé›†ä¸­æœ‰ 15,518,009 è¡Œå’Œ 2 åˆ— -- é€™æ˜¯éå¸¸å¤šçš„!

<Tip>

âœ é»˜èªæƒ…æ³ä¸‹, ğŸ¤— Datasets æœƒè‡ªå‹•è§£å£“åŠ è¼‰æ•¸æ“šé›†æ‰€éœ€çš„æ–‡ä»¶ã€‚ å¦‚æœä½ æƒ³ä¿ç•™ç¡¬ç›¤ç©ºé–“, ä½ å¯ä»¥å‚³é `DownloadConfig(delete_extracted=True)` åˆ° `download_config` çš„ `load_dataset()`åƒæ•¸. æœ‰é—œæ›´å¤šè©³ç´°ä¿¡æ¯, è«‹åƒé–±æ–‡æª”](https://huggingface.co/docs/datasets/package_reference/builder_classes#datasets.DownloadConfig)ã€‚

</Tip>

è®“æˆ‘å€‘çœ‹çœ‹æ•¸æ“šé›†çš„ç¬¬ä¸€å€‹å…ƒç´ çš„å…§å®¹:

```py
pubmed_dataset[0]
```

```python out
{'meta': {'pmid': 11409574, 'language': 'eng'},
 'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection.\nTo determine the prevalence of hypoxaemia in children aged under 5 years suffering acute lower respiratory infections (ALRI), the risk factors for hypoxaemia in children under 5 years of age with ALRI, and the association of hypoxaemia with an increased risk of dying in children of the same age ...'}
```

å¯ä»¥çœ‹åˆ°, é€™çœ‹èµ·ä¾†åƒæ˜¯é†«å­¸æ–‡ç« çš„æ‘˜è¦ã€‚ ç¾åœ¨è®“æˆ‘å€‘çœ‹çœ‹æˆ‘å€‘ä½¿ç”¨äº†RAMçš„å¤šå°‘å­˜å„²ç©ºé–“ä¾†åŠ è¼‰æ•¸æ“šé›†!

## å…§å­˜æ˜ å°„çš„é­”åŠ›

åœ¨ Python ä¸­æ¸¬é‡å…§å­˜ä½¿ç”¨æƒ…æ³çš„ä¸€å€‹ç°¡å–®çš„æ–¹æ³•æ˜¯ä½¿ç”¨[`psutil`](https://psutil.readthedocs.io/en/latest/)åº«,å®ƒå¯ä»¥ä½¿ç”¨ `pip`å®‰è£, å¦‚ä¸‹æ‰€ç¤º:

```python
!pip install psutil
```

å®ƒæä¾›äº†ä¸€å€‹ `Process` é¡,é€™å€‹é¡å…è¨±æˆ‘å€‘æª¢æŸ¥ç•¶å‰é€²ç¨‹çš„å…§å­˜ä½¿ç”¨æƒ…æ³, å¦‚ä¸‹æ‰€ç¤º:

```py
import psutil

# Process.memory_info is expressed in bytes, so convert to megabytes
print(f"RAM used: {psutil.Process().memory_info().rss / (1024 * 1024):.2f} MB")
```

```python out
RAM used: 5678.33 MB
```

é€™è£¡çš„`rss`å±¬æ€§æ˜¯æŒ‡ _å¸¸é§é›†_ çš„å¤§å°, å®ƒæ˜¯é€²ç¨‹åœ¨RAMä¸­ä½”ç”¨çš„å…§å­˜æ¯”ä¾‹ã€‚ é€™å€‹æ¸¬é‡çµæœä¹ŸåŒ…æ‹¬äº† Python ç·¨è­¯å™¨å’Œæˆ‘å€‘åŠ è¼‰çš„åº«æ‰€ä½¿ç”¨çš„å…§å­˜, æ‰€ä»¥å¯¦éš›ä¸Šç”¨æ–¼åŠ è¼‰æ•¸æ“šé›†çš„å…§å­˜æœƒæ›´å°ä¸€äº›ã€‚ç‚ºäº†æ¯”è¼ƒ, è®“æˆ‘å€‘ä½¿ç”¨ `dataset_size` å±¬æ€§çœ‹çœ‹æ•¸æ“šé›†åœ¨ç£ç›¤ä¸Šæœ‰å¤šå¤§ã€‚ ç”±æ–¼çµæœåƒä¹‹å‰ä¸€æ¨£ç”¨å­—ç¯€è¡¨ç¤º, æˆ‘å€‘éœ€è¦æ‰‹å‹•å°‡å…¶è½‰æ›ç‚ºGB:

```py
print(f"Number of files in dataset : {pubmed_dataset.dataset_size}")
size_gb = pubmed_dataset.dataset_size / (1024**3)
print(f"Dataset size (cache file) : {size_gb:.2f} GB")
```

```python out
Number of files in dataset : 20979437051
Dataset size (cache file) : 19.54 GB
```

éå¸¸æ£’ -- å„˜ç®¡å®ƒå°‡è¿‘20GB, ä½†æˆ‘å€‘èƒ½å¤ ä½”ç”¨å¾ˆå°‘çš„RAMç©ºé–“åŠ è¼‰å’Œè¨ªå•æ•¸æ“šé›†!

<Tip>

âœï¸ **è©¦è©¦çœ‹!** å¾[subsets](https://the-eye.eu/public/AI/pile_preliminary_components/)ä¸­é¸æ“‡ä¸€å€‹å¤§æ–¼ä½ çš„ç­†è¨˜æœ¬æˆ–è€…è‡ºå¼æ©Ÿçš„RAMå¤§å°çš„å­é›†, ç”¨ ğŸ¤— DatasetsåŠ è¼‰é€™å€‹æ•¸æ“šé›†, ä¸¦ä¸”æ¸¬é‡RAMçš„ä½¿ç”¨é‡ã€‚ è«‹æ³¨æ„, è¦ç²å¾—æº–ç¢ºçš„æ¸¬é‡çµæœ, ä½ éœ€è¦åœ¨å¦ä¸€å€‹é€²ç¨‹ä¸­åŸ·è¡Œé€™å€‹æ“ä½œã€‚ä½ å¯ä»¥åœ¨ [the Pile paper](https://arxiv.org/abs/2101.00027)çš„è¡¨ä¸€ä¸­æ‰¾åˆ°æ¯å€‹å­é›†è§£å£“å¾Œçš„å¤§å°ã€‚

</Tip>

å¦‚æœä½ ç†Ÿæ‚‰ Pandas, é€™å€‹çµæœå¯èƒ½æœƒè®“äººæ„Ÿåˆ°å¾ˆæ„å¤–ã€‚å› ç‚º Wes Kinney çš„è‘—åçš„[ç¶“é©—æ³•å‰‡](https://wesmckinney.com/blog/apache-arrow-pandas-internals/) æ˜¯ä½ éœ€è¦çš„RAMæ‡‰è©²æ˜¯æ•¸æ“šé›†çš„å¤§å°çš„5å€åˆ°10å€ã€‚ é‚£éº¼ ğŸ¤— Datasets æ˜¯å¦‚ä½•è§£æ±ºé€™å€‹å…§å­˜ç®¡ç†å•é¡Œçš„å‘¢? ğŸ¤— Datasets å°‡æ¯ä¸€å€‹æ•¸æ“šé›†çœ‹ä½œä¸€å€‹[å…§å­˜æ˜ å°„æ–‡ä»¶](https://en.wikipedia.org/wiki/Memory-mapped_file), å®ƒæä¾›äº†RAMå’Œæ–‡ä»¶ç³»çµ±å­˜å„²ä¹‹é–“çš„æ˜ å°„, è©²æ˜ å°„å…è¨±åº«è¨ªå•å’Œæ“ä½œæ•¸æ“šé›†çš„å…ƒç´ , è€Œä¸”ç„¡éœ€å°‡å…¶å®Œå…¨åŠ è¼‰åˆ°å…§å­˜ä¸­ã€‚

å…§å­˜æ˜ å°„æ–‡ä»¶ä¹Ÿä¸€å€‹åœ¨å¤šå€‹é€²ç¨‹ä¹‹é–“å…±äº«, é€™ä½¿å¾—åƒ `Dataset.map()`ä¹‹é¡çš„æ–¹æ³•å¯ä»¥ä¸¦è¡ŒåŒ–, ä¸¦ä¸”ç„¡éœ€ç§»å‹•æˆ–è€…è³¦å€¼æ•¸æ“šé›†ã€‚åœ¨åº•å±¤, é€™äº›åŠŸèƒ½éƒ½æ˜¯ç”±[Apache Arrow](https://arrow.apache.org)å…§å­˜æ ¼å¼å’Œ[`pyarrow`](https://arrow.apache.org/docs/python/index.html)åº«æä¾›çš„æ”¯æŒ, ä½¿å¾—æ•¸æ“šåŠ è¼‰å’Œè™•ç†é€Ÿåº¦å¿«å¦‚é–ƒé›»ã€‚ (æ›´å¤šæœ‰é—œApache Arrowçš„è©³ç´°ä¿¡æ¯ä»¥åŠèˆ‡Pandasçš„æ¯”è¼ƒ, è«‹æŸ¥çœ‹[Dejan Simic's blog post](https://towardsdatascience.com/apache-arrow-read-dataframe-with-zero-memory-69634092b1a).) ç‚ºäº†æ›´æ¸…æ™°åœ°çœ‹åˆ°é€™å€‹éç¨‹, è®“æˆ‘å€‘é€šéè¿­ä»£PubMed Abstractsæ•¸æ“šé›†ä¸­çš„æ‰€æœ‰å…ƒç´ ä¾†é‹è¡Œä¸€å€‹é€Ÿåº¦æ¸¬è©¦å°ç¨‹åº:

```py
import timeit

code_snippet = """batch_size = 1000

for idx in range(0, len(pubmed_dataset), batch_size):
    _ = pubmed_dataset[idx:idx + batch_size]
"""

time = timeit.timeit(stmt=code_snippet, number=1, globals=globals())
print(
    f"Iterated over {len(pubmed_dataset)} examples (about {size_gb:.1f} GB) in "
    f"{time:.1f}s, i.e. {size_gb/time:.3f} GB/s"
)
```

```python out
'Iterated over 15518009 examples (about 19.5 GB) in 64.2s, i.e. 0.304 GB/s'
```

é€™è£¡æˆ‘å€‘ä½¿ç”¨äº† Pythonçš„ `timeit` æ¨¡å¡Šä¾†æ¸¬é‡åŸ·è¡Œ `code_snippet`æ‰€è€—çš„æ™‚é–“ã€‚ ä½ é€šå¸¸èƒ½ä»¥ååˆ†ä¹‹å¹¾GB/såˆ°å¹¾GB/sçš„é€Ÿåº¦è¿­ä»£æ•¸æ“šé›†ã€‚é€šéä¸Šè¿°çš„æ–¹æ³•å°±å·²ç¶“èƒ½å¤ è§£æ±ºå¤§å¤šæ•¸å¤§æ•¸æ“šé›†åŠ è¼‰çš„é™åˆ¶, ä½†æ˜¯æœ‰æ™‚å€™ä½ ä¸å¾—ä¸ä½¿ç”¨ä¸€å€‹å¾ˆå¤§çš„æ•¸æ“šé›†, å®ƒç”šè‡³éƒ½ä¸èƒ½å­˜å„²åœ¨ç­†è¨˜æœ¬é›»è…¦çš„ç¡¬ç›¤ä¸Šã€‚ä¾‹å¦‚, å¦‚æœæˆ‘å€‘å˜—è©¦ä¸‹è¼‰æ•´å€‹ Pile, æˆ‘å€‘éœ€è¦825GBçš„å¯ç”¨ç£ç›¤ç©ºé–“! ç‚ºäº†è™•ç†é€™ç¨®æƒ…æ³, ğŸ¤— Datasets æä¾›äº†ä¸€å€‹æµå¼åŠŸèƒ½, é€™å€‹åŠŸèƒ½å…è¨±æˆ‘å€‘å‹•æ…‹ä¸‹è¼‰å’Œè¨ªå•å…ƒç´ , ä¸¦ä¸”ä¸éœ€è¦ä¸‹è¼‰æ•´å€‹æ•¸æ“šé›†ã€‚è®“æˆ‘å€‘ä¾†çœ‹çœ‹é€™å€‹åŠŸèƒ½æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

<Tip>

ğŸ’¡åœ¨ Jupyter ç­†è¨˜ä¸­ä½ é‚„å¯ä»¥ä½¿ç”¨[`%%timeit` magic function](https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-timeit)ç‚ºå–®å…ƒæ ¼è¨ˆæ™‚ã€‚

</Tip>

## æµå¼æ•¸æ“šé›†

è¦ä½¿ç”¨æ•¸æ“šé›†æµ, ä½ åªéœ€è¦å°‡ `streaming=True` åƒæ•¸å‚³éçµ¦ `load_dataset()` å‡½æ•¸ã€‚æ¥ä¸‹ä¾†, è®“æˆ‘å€‘å†æ¬¡åŠ è¼‰ PubMed Abstracts æ•¸æ“šé›†, ä½†æ˜¯æ¡ç”¨æµæ¨¡å¼:

```py
pubmed_dataset_streamed = load_dataset(
    "json", data_files=data_files, split="train", streaming=True
)
```

èˆ‡æˆ‘å€‘åœ¨æœ¬ç« å…¶ä»–åœ°æ–¹é‡åˆ°çš„ç†Ÿæ‚‰çš„ `Dataset` ä¸åŒ,  `streaming=True` è¿”å›çš„å°è±¡æ˜¯ä¸€å€‹ `IterableDataset`ã€‚ é¡§åæ€ç¾©, è¦è¨ªå• `IterableDataset` , æˆ‘å€‘éœ€è¦è¿­ä»£å®ƒã€‚æˆ‘å€‘å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è¨ªå•æµå¼æ•¸æ“šé›†çš„ç¬¬ä¸€å€‹å…ƒç´ :


```py
next(iter(pubmed_dataset_streamed))
```

```python out
{'meta': {'pmid': 11409574, 'language': 'eng'},
 'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection.\nTo determine the prevalence of hypoxaemia in children aged under 5 years suffering acute lower respiratory infections (ALRI), the risk factors for hypoxaemia in children under 5 years of age with ALRI, and the association of hypoxaemia with an increased risk of dying in children of the same age ...'}
```

å¦‚æœæ‚¨éœ€è¦åœ¨è¨“ç·´æœŸé–“æ¨™è¨˜æµå¼æ•¸æ“šé›†ä¸­çš„å…ƒç´ å¯ä»¥ä½¿ç”¨ `IterableDataset.map()`é€²è¡Œå‹•æ…‹è™•ç†ã€‚è©²éç¨‹èˆ‡æˆ‘å€‘åœ¨[ç¬¬ä¸‰ç« ](/course/chapter3)ä¸­æ¨™è¨˜æ•¸æ“šé›†çš„éç¨‹å®Œå…¨ç›¸åŒ, å”¯ä¸€çš„å€åˆ¥æ˜¯è¼¸å‡ºæ˜¯é€å€‹è¿”å›çš„:

```py
from transformers import AutoTokenizer

tokenizer = AutoTokenizer.from_pretrained("distilbert-base-uncased")
tokenized_dataset = pubmed_dataset_streamed.map(lambda x: tokenizer(x["text"]))
next(iter(tokenized_dataset))
```

```python out
{'input_ids': [101, 4958, 5178, 4328, 6779, ...], 'attention_mask': [1, 1, 1, 1, 1, ...]}
```

<Tip>

ğŸ’¡ ä½ å¯ä»¥å‚³é `batched=True` ä¾†é€šéæµå¼åŠ é€Ÿæ¨™è¨˜åŒ–, å¦‚åŒæˆ‘å€‘åœ¨ä¸Šä¸€ç¯€çœ‹åˆ°çš„é‚£æ¨£ã€‚å®ƒå°‡é€æ‰¹è™•ç†ç¤ºä¾‹; é»˜èªçš„æ‰¹é‡å¤§å°ç‚º 1,000, å¯ä»¥ä½¿ç”¨ `batch_size` åƒæ•¸æŒ‡å®šæ‰¹é‡å¤§å°ã€‚

</Tip>

ä½ é‚„å¯ä»¥ä½¿ç”¨ `IterableDataset.shuffle()` æ‰“äº‚æµå¼æ•¸æ“šé›†, ä½†èˆ‡ `Dataset.shuffle()` ä¸åŒçš„æ˜¯é€™éš»æœƒæ‰“äº‚é å®šç¾© `buffer_size` ä¸­çš„å…ƒç´ :

```py
shuffled_dataset = pubmed_dataset_streamed.shuffle(buffer_size=10_000, seed=42)
next(iter(shuffled_dataset))
```

```python out
{'meta': {'pmid': 11410799, 'language': 'eng'},
 'text': 'Randomized study of dose or schedule modification of granulocyte colony-stimulating factor in platinum-based chemotherapy for elderly patients with lung cancer ...'}
```

åœ¨é€™å€‹ç¤ºä¾‹ä¸­, æˆ‘å€‘å¾ç·©è¡å€çš„å‰ 10,000 å€‹ç¤ºä¾‹ä¸­éš¨æ©Ÿé¸æ“‡äº†ä¸€å€‹ç¤ºä¾‹ã€‚ä¸€æ—¦è¨ªå•äº†ä¸€å€‹ç¤ºä¾‹, å®ƒåœ¨ç·©è¡å€ä¸­çš„ä½ç½®å°±æœƒè¢«èªæ–™åº«ä¸­çš„ä¸‹ä¸€å€‹ç¤ºä¾‹å¡«å…… (å³, ä¸Šè¿°æ¡ˆä¾‹ä¸­çš„ç¬¬ 10,001å€‹ç¤ºä¾‹)ã€‚ä½ é‚„å¯ä»¥ä½¿ç”¨ `IterableDataset.take()` å’Œ `IterableDataset.skip()` å‡½æ•¸å¾æµå¼æ•¸æ“šé›†ä¸­é¸æ“‡å…ƒç´ , å®ƒçš„ä½œç”¨é¡ä¼¼æ–¼ `Dataset.select()`ã€‚ä¾‹å¦‚, è¦é¸æ“‡ PubMed Abstracts æ•¸æ“šé›†çš„å‰5å€‹ç¤ºä¾‹, æˆ‘å€‘å¯ä»¥åŸ·è¡Œä»¥ä¸‹æ“ä½œ:

```py
dataset_head = pubmed_dataset_streamed.take(5)
list(dataset_head)
```

```python out
[{'meta': {'pmid': 11409574, 'language': 'eng'},
  'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection ...'},
 {'meta': {'pmid': 11409575, 'language': 'eng'},
  'text': 'Clinical signs of hypoxaemia in children with acute lower respiratory infection: indicators of oxygen therapy ...'},
 {'meta': {'pmid': 11409576, 'language': 'eng'},
  'text': "Hypoxaemia in children with severe pneumonia in Papua New Guinea ..."},
 {'meta': {'pmid': 11409577, 'language': 'eng'},
  'text': 'Oxygen concentrators and cylinders ...'},
 {'meta': {'pmid': 11409578, 'language': 'eng'},
  'text': 'Oxygen supply in rural africa: a personal experience ...'}]
```

åŒæ¨£, ä½ å¯ä»¥ä½¿ç”¨ `IterableDataset.skip()` å‡½æ•¸å°‡æ‰“äº‚çš„æ•¸æ“šé›†æ‹†åˆ†ç‚ºè¨“ç·´é›†å’Œé©—è­‰é›†, å¦‚ä¸‹æ‰€ç¤º:

```py
# Skip the first 1,000 examples and include the rest in the training set
train_dataset = shuffled_dataset.skip(1000)
# Take the first 1,000 examples for the validation set
validation_dataset = shuffled_dataset.take(1000)
```

è®“æˆ‘å€‘ç”¨ä¸€å€‹å¸¸è¦‹çš„ä»»å‹™ä¾†é€²è¡Œæˆ‘å€‘å°æ•¸æ“šé›†æµçš„æœ€å¾Œæ¢ç´¢: å°‡å¤šå€‹æ•¸æ“šé›†çµ„åˆåœ¨ä¸€èµ·å‰µå»ºä¸€å€‹å¿ƒå¾—èªæ–™åº«ã€‚ ğŸ¤— Datasets æä¾›äº†ä¸€å€‹ `interleave_datasets()` å‡½æ•¸, å®ƒå°‡ä¸€å€‹ `IterableDataset` å°è±¡åˆ—è¡¨çµ„åˆç‚ºå–®å€‹çš„ `IterableDataset`, å…¶ä¸­æ–°æ•¸æ“šé›†çš„å…ƒç´ æ˜¯é€šéåœ¨åˆ—è¡¨ä¸­çš„å°è±¡äº¤æ›¿ç²å¾—çš„ã€‚ç•¶ä½ è©¦åœ–çµ„åˆå¤§å‹æ•¸æ“šé›†æ™‚, é€™å€‹å‡½æ•¸ç‰¹åˆ¥æœ‰ç”¨, è®“æˆ‘å€‘é€šéä¸‹é¢é€™å€‹ä¾‹å­ä¾†è©¦è‘—çµ„åˆ Pileçš„è‡ªç”±æ³•å¾‹æ•¸æ“šé›†,å®ƒæ˜¯ä¾†è‡ªç¾åœ‹æ³•é™¢çš„51 GBçš„æ³•å¾‹æ„è¦‹æ•¸æ“šé›†:

```py
law_dataset_streamed = load_dataset(
    "json",
    data_files="https://the-eye.eu/public/AI/pile_preliminary_components/FreeLaw_Opinions.jsonl.zst",
    split="train",
    streaming=True,
)
next(iter(law_dataset_streamed))
```

```python out
{'meta': {'case_ID': '110921.json',
  'case_jurisdiction': 'scotus.tar.gz',
  'date_created': '2010-04-28T17:12:49Z'},
 'text': '\n461 U.S. 238 (1983)\nOLIM ET AL.\nv.\nWAKINEKONA\nNo. 81-1581.\nSupreme Court of United States.\nArgued January 19, 1983.\nDecided April 26, 1983.\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...'}
```

é€™å€‹æ•¸æ“šé›†è¶³å¤ å¤§, å¯ä»¥å°å¤§å¤šæ•¸ç­†è¨˜æœ¬é›»è…¦çš„RAMæœ‰è¶³å¤ çš„å£“åŠ›, ä½†æ˜¯æˆ‘å€‘å·²ç¶“èƒ½å¤ æ¯«ä¸è²»åŠ›åœ°åŠ è¼‰å’Œè¨ªå•å®ƒ! ç¾åœ¨æˆ‘å€‘ä½¿ç”¨ `interleave_datasets()` å‡½æ•¸åŠ è¼‰ä¾†è‡ª FreeLaw å’Œ PubMed Abstracts çš„æ•¸æ“šé›†:

```py
from itertools import islice
from datasets import interleave_datasets

combined_dataset = interleave_datasets([pubmed_dataset_streamed, law_dataset_streamed])
list(islice(combined_dataset, 2))
```

```python out
[{'meta': {'pmid': 11409574, 'language': 'eng'},
  'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection ...'},
 {'meta': {'case_ID': '110921.json',
   'case_jurisdiction': 'scotus.tar.gz',
   'date_created': '2010-04-28T17:12:49Z'},
  'text': '\n461 U.S. 238 (1983)\nOLIM ET AL.\nv.\nWAKINEKONA\nNo. 81-1581.\nSupreme Court of United States.\nArgued January 19, 1983.\nDecided April 26, 1983.\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...'}]
```

é€™è£¡æˆ‘å€‘ä½¿ç”¨äº†ä¾†è‡ªPythonçš„ `itertools` æ¨¡å¡Šçš„ `islice()` å‡½æ•¸å¾åˆä½µçš„æ•¸æ“šé›†ä¸­é¸æ“‡å‰å…©å€‹ç¤ºä¾‹, ä¸¦ä¸”æˆ‘å€‘å¯ä»¥çœ‹åˆ°å®ƒå€‘å¯¦éš›ä¸Šå°±æ˜¯å…©å€‹æºæ•¸æ“šé›†ä¸­çš„å‰å…©å€‹ç¤ºä¾‹æ‹¼åœ¨ä¸€èµ·å½¢æˆçš„:

æœ€å¾Œ, å¦‚æœä½ æƒ³æµå¼å‚³è¼¸æ•´å€‹825GBçš„ Pile, ä½ å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼ç²å–æ‰€æœ‰æº–å‚™å¥½çš„æ–‡ä»¶:

```py
base_url = "https://the-eye.eu/public/AI/pile/"
data_files = {
    "train": [base_url + "train/" + f"{idx:02d}.jsonl.zst" for idx in range(30)],
    "validation": base_url + "val.jsonl.zst",
    "test": base_url + "test.jsonl.zst",
}
pile_dataset = load_dataset("json", data_files=data_files, streaming=True)
next(iter(pile_dataset["train"]))
```

```python out
{'meta': {'pile_set_name': 'Pile-CC'},
 'text': 'It is done, and submitted. You can play â€œSurvival of the Tastiestâ€ on Android, and on the web...'}
```

<Tip>

âœï¸ **è©¦è©¦çœ‹!** ä½¿ç”¨åƒ[`mc4`](https://huggingface.co/datasets/mc4) æˆ–è€… [`oscar`](https://huggingface.co/datasets/oscar)é€™æ¨£çš„å¤§å‹ Common Crawl èªæ–™åº«ä¾†å‰µå»ºä¸€å€‹æµå¼å¤šèªè¨€æ•¸æ“šé›†, è©²æ•¸æ“šé›†ä»£è¡¨ä½ é¸æ“‡çš„åœ‹å®¶/åœ°å€èªè¨€çš„å£èªæ¯”ä¾‹ã€‚ä¾‹å¦‚, ç‘å£«çš„å››ç¨®æ°‘æ—èªè¨€åˆ†åˆ¥æ˜¯å¾·èªã€æ³•èªã€æ„å¤§åˆ©èªå’Œç¾…æ›¼ä»€èª, å› æ­¤ä½ å¯ä»¥å˜—è©¦æ ¹æ“šæ ¹æ“šå£èªæ¯”ä¾‹å°Oscarå­é›†é€²è¡Œæ¡ç”¨ä¾†å‰µå»ºç‘å£«èªæ–™åº«ã€‚

</Tip>

ä½ ç¾åœ¨æ“æœ‰åŠ è¼‰å’Œè™•ç†å„ç¨®é¡å‹å’Œå¤§å°çš„æ•¸æ“šé›†çš„æ‰€éœ€çš„æ‰€æœ‰å·¥å…· -- ä½†æ˜¯é™¤éä½ éå¸¸å¹¸é‹, å¦å‰‡åœ¨ä½ çš„NLPä¹‹æ—…ä¸­æœƒæœ‰ä¸€å€‹é›£é¡Œ, ä½ å°‡ä¸å¾—ä¸å‰µå»ºä¸€å€‹æ•¸æ“šé›†ä¾†è§£æ±ºæ‰‹é ­çš„å•é¡Œã€‚é€™å°±æ˜¯ä¸‹ä¸€ç¯€çš„ä¸»é¡Œ!
