# ç­è§£æ¥å£é¡

<DocNotebookDropdown
  classNames="absolute z-10 right-0 top-0"
  options={[
    {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/chapter9/section3.ipynb"},
    {label: "Aws Studio", value: "https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/chapter9/section3.ipynb"},
]} />

åœ¨æœ¬ç¯€ä¸­ï¼Œæˆ‘å€‘å°‡ä»”ç´°ç ”ç©¶ `Interface` é¡ï¼Œä¸¦ç­è§£ç”¨æ–¼å‰µå»ºå…¶çš„ä¸»è¦åƒæ•¸ã€‚

## å¦‚ä½•å‰µå»ºæ¥å£

æ‚¨æœƒæ³¨æ„åˆ° `Interface` é¡æœ‰ 3 å€‹å¿…éœ€åƒæ•¸ï¼š

`Interface(fn, inputs, outputs, ...)`

é€™äº›åƒæ•¸æ˜¯ï¼š

  - `fn`: ç”± Gradio æ¥å£åŒ…è£çš„é æ¸¬å‡½æ•¸ã€‚ è©²å‡½æ•¸å¯ä»¥æ¥å—ä¸€å€‹æˆ–å¤šå€‹åƒæ•¸ä¸¦è¿”å›ä¸€å€‹æˆ–å¤šå€‹å€¼
  - `inputs`: è¼¸å…¥çµ„ä»¶é¡å‹ã€‚ Gradio æä¾›äº†è¨±å¤šé æ§‹å»ºçš„çµ„ä»¶ï¼Œä¾‹å¦‚`"image"` æˆ–`"mic"`ã€‚
  - `outputs`: è¼¸å‡ºçµ„ä»¶é¡å‹ã€‚ åŒæ¨£ï¼ŒGradio æä¾›äº†è¨±å¤šé æ§‹å»ºçš„çµ„ä»¶ï¼Œä¾‹å¦‚ `â€œåœ–åƒâ€`æˆ–â€œæ¨™ç±¤â€`ã€‚

æœ‰é—œçµ„ä»¶çš„å®Œæ•´åˆ—è¡¨ï¼Œ[è«‹åƒé–± Gradio æ–‡æª”](https://gradio.app/docs)ã€‚ æ¯å€‹é æ§‹å»ºçš„çµ„ä»¶éƒ½å¯ä»¥é€šéå¯¦ä¾‹åŒ–è©²çµ„ä»¶å°æ‡‰çš„é¡ä¾†å®šè£½ã€‚

ä¾‹å¦‚ï¼Œæ­£å¦‚æˆ‘å€‘åœ¨ [ä¸Šä¸€ç¯€](/course/chapter9/2) ä¸­çœ‹åˆ°çš„ï¼Œæ‚¨å¯ä»¥å‚³å…¥ä¸€å€‹ `Textbox(lines=7, label="Prompt")` çµ„ä»¶ä¾†å‰µå»ºä¸€å€‹åŒ…å« 7 è¡Œå’Œä¸€å€‹æ¨™ç±¤çš„æ–‡æœ¬æ¡†ï¼Œè€Œä¸æ˜¯å°‡ `"textbox"` å‚³éçµ¦ `inputs` åƒæ•¸ã€‚
è®“æˆ‘å€‘çœ‹å¦ä¸€å€‹ä¾‹å­ï¼Œé€™æ¬¡æ˜¯ä¸€å€‹ `Audio` çµ„ä»¶ã€‚

## ä¸€å€‹å¸¶éŸ³é »çš„ç°¡å–®ç¤ºä¾‹

å¦‚å‰æ‰€è¿°ï¼ŒGradio æä¾›äº†è¨±å¤šä¸åŒçš„è¼¸å…¥å’Œè¼¸å‡ºã€‚
å› æ­¤ï¼Œè®“æˆ‘å€‘æ§‹å»ºä¸€å€‹é©ç”¨æ–¼éŸ³é »çš„â€œæ¥å£â€ã€‚

åœ¨é€™å€‹ä¾‹å­ä¸­ï¼Œæˆ‘å€‘å°‡æ§‹å»ºä¸€å€‹éŸ³é »åˆ°éŸ³é »çš„å‡½æ•¸ï¼Œå®ƒéœ€è¦ä¸€å€‹éŸ³é »æ–‡ä»¶ä¸¦ç°¡å–®åœ°åè½‰å®ƒã€‚

æˆ‘å€‘å°‡ä½¿ç”¨ `Audio` çµ„ä»¶ä½œç‚ºè¼¸å…¥ã€‚ ä½¿ç”¨ `Audio` çµ„ä»¶æ™‚ï¼Œæ‚¨å¯ä»¥æŒ‡å®šå¸Œæœ›éŸ³é »çš„ `source` æ˜¯ç”¨æˆ¶ä¸Šå‚³çš„æ–‡ä»¶é‚„æ˜¯ç”¨æˆ¶éŒ„è£½è²éŸ³çš„éº¥å…‹é¢¨ã€‚ åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œè®“æˆ‘å€‘å°‡å…¶è¨­ç½®ç‚ºâ€œéº¥å…‹é¢¨â€ã€‚ åªæ˜¯ç‚ºäº†å¥½ç©ï¼Œæˆ‘å€‘æœƒåœ¨æˆ‘å€‘çš„â€œéŸ³é »â€ä¸­æ·»åŠ ä¸€å€‹æ¨™ç±¤ï¼Œä¸Šé¢å¯«è‘—â€œåœ¨é€™è£¡èªªè©±â€¦â€¦â€ã€‚

æ­¤å¤–ï¼Œæˆ‘å€‘å¸Œæœ›å°‡éŸ³é »ä½œç‚º numpy æ•¸çµ„æ¥æ”¶ï¼Œä»¥ä¾¿æˆ‘å€‘å¯ä»¥è¼•é¬†åœ°â€œåè½‰â€å®ƒã€‚ æ‰€ä»¥æˆ‘å€‘å°‡ `"type"` è¨­ç½®ç‚º `"numpy"`ï¼Œå®ƒæœƒå‚³éè¼¸å…¥data ä½œç‚º (`sample_rate`, `data`) çš„å…ƒçµ„é€²å…¥æˆ‘å€‘çš„å‡½æ•¸ã€‚

æˆ‘å€‘é‚„å°‡ä½¿ç”¨ `Audio` è¼¸å‡ºçµ„ä»¶ï¼Œå®ƒå¯ä»¥è‡ªå‹•å°‡å…·æœ‰é‡‡æ¨£ç‡å’Œ numpy æ•¸æ“šæ•¸çµ„çš„å…ƒçµ„æ¸²æŸ“ç‚ºå¯æ’­æ”¾çš„éŸ³é »æ–‡ä»¶ã€‚ åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œæˆ‘å€‘ä¸éœ€è¦é€²è¡Œä»»ä½•è‡ªå®šç¾©ï¼Œå› æ­¤æˆ‘å€‘å°‡ä½¿ç”¨å­—ç¬¦ä¸²å¿«æ·æ–¹å¼â€œaudioâ€ã€‚


```py
import numpy as np
import gradio as gr


def reverse_audio(audio):
    sr, data = audio
    reversed_audio = (sr, np.flipud(data))
    return reversed_audio


mic = gr.Audio(source="microphone", type="numpy", label="Speak here...")
gr.Interface(reverse_audio, mic, "audio").launch()
```

ä¸Šé¢çš„ä»£ç¢¼æœƒç”¢ç”Ÿä¸€å€‹é¡ä¼¼ä¸‹é¢çš„ç•Œé¢ï¼ˆå¦‚æœä½ çš„ç€è¦½å™¨æ²’æœ‰
è©¢å•æ‚¨çš„éº¥å…‹é¢¨æ¬Šé™ï¼Œ <a href="https://huggingface.co/spaces/course-demos/audio-reverse" target="_blank">open the demo in  a separate tab</a>.)

<iframe src="https://course-demos-audio-reverse.hf.space" frameBorder="0" height="250" title="Gradio app" class="container p-0 flex-grow space-iframe" allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>

æ‚¨ç¾åœ¨æ‡‰è©²èƒ½å¤ éŒ„è£½è‡ªå·±çš„è²éŸ³ä¸¦è½åˆ°è‡ªå·±åœ¨åå‘èªªè©± - è½èµ·ä¾†å¥½æ€ªğŸ‘»!

## è™•ç†å¤šå€‹è¼¸å…¥å’Œè¼¸å‡º

å‡è¨­æˆ‘å€‘æœ‰ä¸€å€‹æ›´å¾©é›œçš„å‡½æ•¸ï¼Œæœ‰å¤šå€‹è¼¸å…¥å’Œè¼¸å‡ºã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘å€‘æœ‰ä¸€å€‹æ¥å—ä¸‹æ‹‰ç´¢å¼•ã€æ»‘å¡Šå€¼å’Œæ•¸å­—çš„å‡½æ•¸ï¼Œä¸¦è¿”å›ä¸€å€‹éŸ³èª¿çš„éŸ³é »æ¨£æœ¬ã€‚

çœ‹çœ‹æˆ‘å€‘å¦‚ä½•å‚³éè¼¸å…¥å’Œè¼¸å‡ºçµ„ä»¶åˆ—è¡¨ï¼Œçœ‹çœ‹ä½ èƒ½ä¸èƒ½è·Ÿä¸Šæ­£åœ¨ç™¼ç”Ÿçš„äº‹æƒ…ã€‚

é€™è£¡çš„é—œéµæ˜¯ç•¶ä½ é€šéæ™‚ï¼š
* è¼¸å…¥çµ„ä»¶åˆ—è¡¨ï¼Œæ¯å€‹çµ„ä»¶ä¾æ¬¡å°æ‡‰ä¸€å€‹åƒæ•¸ã€‚
* è¼¸å‡ºçµ„ä»¶åˆ—è¡¨ï¼Œæ¯å€‹çµ„ä»¶å°æ‡‰ä¸€å€‹è¿”å›å€¼ã€‚

ä¸‹é¢çš„ä»£ç¢¼ç‰‡æ®µé¡¯ç¤ºäº†ä¸‰å€‹è¼¸å…¥çµ„ä»¶å¦‚ä½•èˆ‡ `generate_tone()` å‡½æ•¸çš„ä¸‰å€‹åƒæ•¸å°é½Šï¼š

```py
import numpy as np
import gradio as gr

notes = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"]


def generate_tone(note, octave, duration):
    sr = 48000
    a4_freq, tones_from_a4 = 440, 12 * (octave - 4) + (note - 9)
    frequency = a4_freq * 2 ** (tones_from_a4 / 12)
    duration = int(duration)
    audio = np.linspace(0, duration, duration * sr)
    audio = (20000 * np.sin(audio * (2 * np.pi * frequency))).astype(np.int16)
    return (sr, audio)


gr.Interface(
    generate_tone,
    [
        gr.Dropdown(notes, type="index"),
        gr.Slider(minimum=4, maximum=6, step=1),
        gr.Textbox(type="number", value=1, label="Duration in seconds"),
    ],
    "audio",
).launch()
```

<iframe src="https://course-demos-generate-tone.hf.space" frameBorder="0" height="450" title="Gradio app" class="container p-0 flex-grow space-iframe" allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>


### `launch()` æ–¹æ³•

åˆ°ç›®å‰ç‚ºæ­¢ï¼Œæˆ‘å€‘å·²ç¶“ä½¿ç”¨äº†`launch()`æ–¹æ³•ä¾†å•Ÿå‹•ç•Œé¢ï¼Œä½†æ˜¯æˆ‘å€‘
é‚„æ²’æœ‰çœŸæ­£è¨è«–éå®ƒçš„ä½œç”¨ã€‚

é»˜èªæƒ…æ³ä¸‹ï¼Œ`launch()` æ–¹æ³•å°‡åœ¨ Web æœå‹™å™¨ä¸­å•Ÿå‹•æ¼”ç¤ºæ­£åœ¨æœ¬åœ°é‹è¡Œã€‚ å¦‚æœæ‚¨åœ¨ Jupyter æˆ– Colab ç­†è¨˜æœ¬ä¸­é‹è¡Œä»£ç¢¼ï¼Œé‚£éº¼Gradio æœƒå°‡æ¼”ç¤º GUI åµŒå…¥åˆ°ç­†è¨˜æœ¬ä¸­ï¼Œä»¥ä¾¿æ‚¨è¼•é¬†ä½¿ç”¨å®ƒã€‚

æ‚¨å¯ä»¥é€šéä¸åŒçš„åƒæ•¸è‡ªå®šç¾© `launch()` çš„è¡Œç‚ºï¼š

  - `inline` - whether to display the interface inline on Python notebooks.
  - `inbrowser` - whether to automatically launch the interface in a new tab on the default browser.
  - `share` - whether to create a publicly shareable link from your computer for the interface. Kind of like a Google Drive link!

æˆ‘å€‘å°‡åœ¨ä¸‹ä¸€ç¯€ä¸­æ›´è©³ç´°åœ°ä»‹ç´¹ `share` åƒæ•¸ï¼

## âœï¸ è®“æˆ‘å€‘æ‡‰ç”¨å®ƒï¼

è®“æˆ‘å€‘æ§‹å»ºä¸€å€‹ç•Œé¢ï¼Œè®“æ‚¨æ¼”ç¤º **speech-recognition** æ¨¡å‹ã€‚
ç‚ºäº†è®“å®ƒè®Šå¾—æœ‰è¶£ï¼Œæˆ‘å€‘å°‡æ¥å— *or* éº¥å…‹é¢¨è¼¸å…¥æˆ–ä¸Šå‚³çš„æ–‡ä»¶ã€‚

åƒå¾€å¸¸ä¸€æ¨£ï¼Œæˆ‘å€‘å°‡ä½¿ç”¨ ğŸ¤— Transformers ä¸­çš„ `pipeline()` å‡½æ•¸åŠ è¼‰æˆ‘å€‘çš„èªéŸ³è­˜åˆ¥æ¨¡å‹ã€‚å¦‚æœæ‚¨éœ€è¦å¿«é€Ÿè¤‡ç¿’ï¼Œæ‚¨å¯ä»¥è¿”å› [ç¬¬ 1 ç« ä¸­çš„é‚£å€‹éƒ¨åˆ†](/course/chapter1/3)ã€‚ æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘å°‡å¯¦ç¾ä¸€å€‹ `transcribe_audio()` å‡½æ•¸ä¾†è™•ç†éŸ³é »ä¸¦è¿”å›è½‰éŒ„ã€‚ æœ€å¾Œï¼Œæˆ‘å€‘å°‡æŠŠé€™å€‹å‡½æ•¸åŒ…è£åœ¨ä¸€å€‹ `Interface` ä¸­ï¼Œå…¶ä¸­ `Audio` çµ„ä»¶ç”¨æ–¼è¼¸å…¥ï¼Œåªæœ‰æ–‡æœ¬ç”¨æ–¼è¼¸å‡ºã€‚ ç¸½è€Œè¨€ä¹‹ï¼Œæ­¤æ‡‰ç”¨ç¨‹åºçš„ä»£ç¢¼å¦‚ä¸‹ï¼š

```py
from transformers import pipeline
import gradio as gr

model = pipeline("automatic-speech-recognition")


def transcribe_audio(mic=None, file=None):
    if mic is not None:
        audio = mic
    elif file is not None:
        audio = file
    else:
        return "You must either provide a mic recording or a file"
    transcription = model(audio)["text"]
    return transcription


gr.Interface(
    fn=transcribe_audio,
    inputs=[
        gr.Audio(source="microphone", type="filepath", optional=True),
        gr.Audio(source="upload", type="filepath", optional=True),
    ],
    outputs="text",
).launch()
```

å¦‚æœæ‚¨çš„ç€è¦½å™¨æ²’æœ‰è¦æ±‚æ‚¨æä¾›éº¥å…‹é¢¨æ¬Šé™ï¼Œ<a href="https://huggingface.co/spaces/course-demos/audio-reverse" target="_blank">open the demo in a separate tab</a>.

<iframe src="https://course-demos-asr.hf.space" frameBorder="0" height="550" title="Gradio app" class="container p-0 flex-grow space-iframe" allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>


å°±æ˜¯é€™æ¨£ï¼ æ‚¨ç¾åœ¨å¯ä»¥ä½¿ç”¨æ­¤ç•Œé¢ä¾†è½‰éŒ„éŸ³é »ã€‚ æ³¨æ„é€™è£¡
é€šéå°‡ `optional` åƒæ•¸ä½œç‚º `True` å‚³éï¼Œæˆ‘å€‘å…è¨±ç”¨æˆ¶
æä¾›éº¥å…‹é¢¨æˆ–éŸ³é »æ–‡ä»¶ï¼ˆæˆ–å…©è€…éƒ½ä¸æä¾›ï¼Œä½†é€™æœƒè¿”å›éŒ¯èª¤æ¶ˆæ¯ï¼‰ã€‚

ç¹¼çºŒçœ‹çœ‹å¦‚ä½•èˆ‡ä»–äººåˆ†äº«æ‚¨çš„ç•Œé¢ï¼