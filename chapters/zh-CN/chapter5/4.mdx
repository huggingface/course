# å¤§æ•°æ®? ğŸ¤— Datasets æ¥æ•‘æ´!

<DocNotebookDropdown
  classNames="absolute z-10 right-0 top-0"
  options={[
    {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/chapter5/section4.ipynb"},
    {label: "Aws Studio", value: "https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/chapter5/section4.ipynb"},
]} />


å¦‚ä»Š,ä¸éš¾å‘ç°æˆ‘ä»¬ç»å¸¸ä½¿ç”¨æ•°GBçš„æ•°æ®é›†, ç‰¹åˆ«æ˜¯å¦‚æœä½ æ‰“ç®—ä»å¤´å¼€å§‹é¢„è®­ç»ƒåƒ BERT æˆ–è€… GPT-2 è¿™æ ·çš„è½¬æ¢å™¨ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹, _åŠ è½½_ æ•°æ®é›†å°±æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚ä¾‹å¦‚, ç”¨äºé¢„è®­ç»ƒ GPT-2 çš„ WebText è¯­æ–™åº“åŒ…å«è¶…è¿‡ 800 ä¸‡ä¸ªæ–‡æ¡£å’Œ 40 GB çš„æ–‡æœ¬ -- å°†å…¶åŠ è½½åˆ°ç¬”è®°æœ¬ç”µè„‘çš„ RAM ä¸­å¯èƒ½ä¼šè®©å®ƒæŠ“ç‹‚ï¼

å¹¸è¿çš„æ˜¯, ğŸ¤— Datasets æ—¨åœ¨å…‹æœè¿™äº›é™åˆ¶ã€‚å®ƒé€šè¿‡å°†æ•°æ®é›†ä½œä¸ºå†…å­˜æ˜ å°„æ–‡ä»¶æ¥å¤„ç†ï¼Œå¹¶é€šè¿‡åœ¨è¯­æ–™åº“ä¸­æµåŒ–æ¡ç›®æ¥æ‘†è„±ç¡¬ç›˜é™åˆ¶, ä»è€Œä½¿ä½ é¿å…å†…å­˜ç®¡ç†é—®é¢˜ã€‚

<Youtube id="JwISwTCPPWo"/>

åœ¨æœ¬èŠ‚ä¸­, æˆ‘ä»¬å°†æ¢ç´¢ğŸ¤— Datasets çš„ç‰¹æ€§ã€‚å®ƒæœ‰ä¸€ä¸ªç§°ä¸º [the Pile](https://pile.eleuther.ai)çš„825 GBçš„è¯­æ–™åº“ã€‚ è®©æˆ‘ä»¬å¼€å§‹å§!

## ä»€ä¹ˆæ˜¯Pile?

The Pile æ˜¯ç”±[EleutherAI](https://www.eleuther.ai)åˆ›å»ºçš„ä¸€ä¸ªè‹±è¯­æ–‡æœ¬è¯­æ–™åº“, ç”¨äºè®­ç»ƒå¤§è§„æ¨¡è¯­è¨€æ¨¡å‹ã€‚å®ƒåŒ…å«å„ç§å„æ ·çš„æ•°æ®é›†, æ¶µç›–ç§‘å­¦æ–‡ç« , GitHub ä»£ç åº“ä»¥åŠè¿‡æ»¤çš„Webæ–‡æœ¬ã€‚è®­ç»ƒè¯­æ–™åº“åœ¨[14 GB chunks](https://mystic.the-eye.eu/public/AI/pile/), å¹¶ä¸”ä½ ä¹Ÿå¯ä»¥ä¸‹è½½å‡ ä¸ª[å•ç‹¬çš„ç»„ä»¶](https://mystic.the-eye.eu/public/AI/pile_preliminary_components/)ã€‚ è®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ PubMed Abstracts æ•°æ®é›†, å®ƒæ˜¯[PubMed](https://pubmed.ncbi.nlm.nih.gov/)ä¸Šçš„1500ä¸‡ç¯‡ç”Ÿç‰©åŒ»å­¦å‡ºç‰ˆç‰©çš„æ‘˜è¦çš„è¯­æ–™åº“ã€‚ æ•°æ®é›†é‡‡ç”¨[JSONè¡Œæ ¼å¼](https://jsonlines.org) å¹¶ä½¿ç”¨`zstandard`åº“è¿›è¡Œå‹ç¼©, æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦å…ˆå®‰è£…`zstandard`åº“:

```py
!pip install zstandard
```

æ¥ä¸‹æ¥, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨[ç¬¬äºŒèŠ‚](/course/chapter5/2)ä¸­æ‰€å­¦çš„åŠ è½½è¿œç¨‹æ•°æ®é›†çš„æ–¹æ³•åŠ è½½æ•°æ®é›†:

```py
from datasets import load_dataset

# This takes a few minutes to run, so go grab a tea or coffee while you wait :)
data_files = "https://mystic.the-eye.eu/public/AI/pile_preliminary_components/PUBMED_title_abstracts_2019_baseline.jsonl.zst"
pubmed_dataset = load_dataset("json", data_files=data_files, split="train")
pubmed_dataset
```

```python out
Dataset({
    features: ['meta', 'text'],
    num_rows: 15518009
})
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æ•°æ®é›†ä¸­æœ‰ 15,518,009 è¡Œå’Œ 2 åˆ— -- è¿™æ˜¯éå¸¸å¤šçš„!

<Tip>

âœ é»˜è®¤æƒ…å†µä¸‹, ğŸ¤— Datasets ä¼šè‡ªåŠ¨è§£å‹åŠ è½½æ•°æ®é›†æ‰€éœ€çš„æ–‡ä»¶ã€‚ å¦‚æœä½ æƒ³ä¿ç•™ç¡¬ç›˜ç©ºé—´, ä½ å¯ä»¥ä¼ é€’ `DownloadConfig(delete_extracted=True)` åˆ° `download_config` çš„ `load_dataset()`å‚æ•°. æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯, è¯·å‚é˜…æ–‡æ¡£](https://huggingface.co/docs/datasets/package_reference/builder_classes.html?#datasets.utils.DownloadConfig)ã€‚

</Tip>

è®©æˆ‘ä»¬çœ‹çœ‹æ•°æ®é›†çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å†…å®¹:

```py
pubmed_dataset[0]
```

```python out
{'meta': {'pmid': 11409574, 'language': 'eng'},
 'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection.\nTo determine the prevalence of hypoxaemia in children aged under 5 years suffering acute lower respiratory infections (ALRI), the risk factors for hypoxaemia in children under 5 years of age with ALRI, and the association of hypoxaemia with an increased risk of dying in children of the same age ...'}
```

å¯ä»¥çœ‹åˆ°, è¿™çœ‹èµ·æ¥åƒæ˜¯åŒ»å­¦æ–‡ç« çš„æ‘˜è¦ã€‚ ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬ä½¿ç”¨äº†RAMçš„å¤šå°‘å­˜å‚¨ç©ºé—´æ¥åŠ è½½æ•°æ®é›†!

## å†…å­˜æ˜ å°„çš„é­”åŠ›

åœ¨ Python ä¸­æµ‹é‡å†…å­˜ä½¿ç”¨æƒ…å†µçš„ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨[`psutil`](https://psutil.readthedocs.io/en/latest/)åº“,å®ƒå¯ä»¥ä½¿ç”¨ `pip`å®‰è£…, å¦‚ä¸‹æ‰€ç¤º:

```python
!pip install psutil
```

å®ƒæä¾›äº†ä¸€ä¸ª `Process` ç±»,è¿™ä¸ªç±»å…è®¸æˆ‘ä»¬æ£€æŸ¥å½“å‰è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ, å¦‚ä¸‹æ‰€ç¤º:

```py
import psutil

# Process.memory_info is expressed in bytes, so convert to megabytes
print(f"RAM used: {psutil.Process().memory_info().rss / (1024 * 1024):.2f} MB")
```

```python out
RAM used: 5678.33 MB
```

è¿™é‡Œçš„`rss`å±æ€§æ˜¯æŒ‡ _å¸¸é©»é›†_ çš„å¤§å°, å®ƒæ˜¯è¿›ç¨‹åœ¨RAMä¸­å ç”¨çš„å†…å­˜æ¯”ä¾‹ã€‚ è¿™ä¸ªæµ‹é‡ç»“æœä¹ŸåŒ…æ‹¬äº† Python ç¼–è¯‘å™¨å’Œæˆ‘ä»¬åŠ è½½çš„åº“æ‰€ä½¿ç”¨çš„å†…å­˜, æ‰€ä»¥å®é™…ä¸Šç”¨äºåŠ è½½æ•°æ®é›†çš„å†…å­˜ä¼šæ›´å°ä¸€äº›ã€‚ä¸ºäº†æ¯”è¾ƒ, è®©æˆ‘ä»¬ä½¿ç”¨ `dataset_size` å±æ€§çœ‹çœ‹æ•°æ®é›†åœ¨ç£ç›˜ä¸Šæœ‰å¤šå¤§ã€‚ ç”±äºç»“æœåƒä¹‹å‰ä¸€æ ·ç”¨å­—èŠ‚è¡¨ç¤º, æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å°†å…¶è½¬æ¢ä¸ºGB:

```py
print(f"Number of files in dataset : {pubmed_dataset.dataset_size}")
size_gb = pubmed_dataset.dataset_size / (1024**3)
print(f"Dataset size (cache file) : {size_gb:.2f} GB")
```

```python out
Number of files in dataset : 20979437051
Dataset size (cache file) : 19.54 GB
```

éå¸¸æ£’ -- å°½ç®¡å®ƒå°†è¿‘20GB, ä½†æˆ‘ä»¬èƒ½å¤Ÿå ç”¨å¾ˆå°‘çš„RAMç©ºé—´åŠ è½½å’Œè®¿é—®æ•°æ®é›†!

<Tip>

âœï¸ **è¯•è¯•çœ‹!** ä»[subsets](https://mystic.the-eye.eu/public/AI/pile_preliminary_components/)ä¸­é€‰æ‹©ä¸€ä¸ªå¤§äºä½ çš„ç¬”è®°æœ¬æˆ–è€…å°å¼æœºçš„RAMå¤§å°çš„å­é›†, ç”¨ ğŸ¤— DatasetsåŠ è½½è¿™ä¸ªæ•°æ®é›†, å¹¶ä¸”æµ‹é‡RAMçš„ä½¿ç”¨é‡ã€‚ è¯·æ³¨æ„, è¦è·å¾—å‡†ç¡®çš„æµ‹é‡ç»“æœ, ä½ éœ€è¦åœ¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚ä½ å¯ä»¥åœ¨ [the Pile paper](https://arxiv.org/abs/2101.00027)çš„è¡¨ä¸€ä¸­æ‰¾åˆ°æ¯ä¸ªå­é›†è§£å‹åçš„å¤§å°ã€‚

</Tip>

å¦‚æœä½ ç†Ÿæ‚‰ Pandas, è¿™ä¸ªç»“æœå¯èƒ½ä¼šè®©äººæ„Ÿåˆ°å¾ˆæ„å¤–ã€‚å› ä¸º Wes Kinney çš„è‘—åçš„[ç»éªŒæ³•åˆ™](https://wesmckinney.com/blog/apache-arrow-pandas-internals/) æ˜¯ä½ éœ€è¦çš„RAMåº”è¯¥æ˜¯æ•°æ®é›†çš„å¤§å°çš„5å€åˆ°10å€ã€‚ é‚£ä¹ˆ ğŸ¤— Datasets æ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªå†…å­˜ç®¡ç†é—®é¢˜çš„å‘¢? ğŸ¤— Datasets å°†æ¯ä¸€ä¸ªæ•°æ®é›†çœ‹ä½œä¸€ä¸ª[å†…å­˜æ˜ å°„æ–‡ä»¶](https://en.wikipedia.org/wiki/Memory-mapped_file), å®ƒæä¾›äº†RAMå’Œæ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ä¹‹é—´çš„æ˜ å°„, è¯¥æ˜ å°„å…è®¸åº“è®¿é—®å’Œæ“ä½œæ•°æ®é›†çš„å…ƒç´ , è€Œä¸”æ— éœ€å°†å…¶å®Œå…¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚

å†…å­˜æ˜ å°„æ–‡ä»¶ä¹Ÿä¸€ä¸ªåœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«, è¿™ä½¿å¾—åƒ `Dataset.map()`ä¹‹ç±»çš„æ–¹æ³•å¯ä»¥å¹¶è¡ŒåŒ–, å¹¶ä¸”æ— éœ€ç§»åŠ¨æˆ–è€…èµ‹å€¼æ•°æ®é›†ã€‚åœ¨åº•å±‚, è¿™äº›åŠŸèƒ½éƒ½æ˜¯ç”±[Apache Arrow](https://arrow.apache.org)å†…å­˜æ ¼å¼å’Œ[`pyarrow`](https://arrow.apache.org/docs/python/index.html)åº“æä¾›çš„æ”¯æŒ, ä½¿å¾—æ•°æ®åŠ è½½å’Œå¤„ç†é€Ÿåº¦å¿«å¦‚é—ªç”µã€‚ (æ›´å¤šæœ‰å…³Apache Arrowçš„è¯¦ç»†ä¿¡æ¯ä»¥åŠä¸Pandasçš„æ¯”è¾ƒ, è¯·æŸ¥çœ‹[Dejan Simic's blog post](https://towardsdatascience.com/apache-arrow-read-dataframe-with-zero-memory-69634092b1a).) ä¸ºäº†æ›´æ¸…æ™°åœ°çœ‹åˆ°è¿™ä¸ªè¿‡ç¨‹, è®©æˆ‘ä»¬é€šè¿‡è¿­ä»£PubMed Abstractsæ•°æ®é›†ä¸­çš„æ‰€æœ‰å…ƒç´ æ¥è¿è¡Œä¸€ä¸ªé€Ÿåº¦æµ‹è¯•å°ç¨‹åº:

```py
import timeit

code_snippet = """batch_size = 1000

for idx in range(0, len(pubmed_dataset), batch_size):
    _ = pubmed_dataset[idx:idx + batch_size]
"""

time = timeit.timeit(stmt=code_snippet, number=1, globals=globals())
print(
    f"Iterated over {len(pubmed_dataset)} examples (about {size_gb:.1f} GB) in "
    f"{time:.1f}s, i.e. {size_gb/time:.3f} GB/s"
)
```

```python out
'Iterated over 15518009 examples (about 19.5 GB) in 64.2s, i.e. 0.304 GB/s'
```

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† Pythonçš„ `timeit` æ¨¡å—æ¥æµ‹é‡æ‰§è¡Œ `code_snippet`æ‰€è€—çš„æ—¶é—´ã€‚ ä½ é€šå¸¸èƒ½ä»¥ååˆ†ä¹‹å‡ GB/såˆ°å‡ GB/sçš„é€Ÿåº¦è¿­ä»£æ•°æ®é›†ã€‚é€šè¿‡ä¸Šè¿°çš„æ–¹æ³•å°±å·²ç»èƒ½å¤Ÿè§£å†³å¤§å¤šæ•°å¤§æ•°æ®é›†åŠ è½½çš„é™åˆ¶, ä½†æ˜¯æœ‰æ—¶å€™ä½ ä¸å¾—ä¸ä½¿ç”¨ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ®é›†, å®ƒç”šè‡³éƒ½ä¸èƒ½å­˜å‚¨åœ¨ç¬”è®°æœ¬ç”µè„‘çš„ç¡¬ç›˜ä¸Šã€‚ä¾‹å¦‚, å¦‚æœæˆ‘ä»¬å°è¯•ä¸‹è½½æ•´ä¸ª Pile, æˆ‘ä»¬éœ€è¦825GBçš„å¯ç”¨ç£ç›˜ç©ºé—´! ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µ, ğŸ¤— Datasets æä¾›äº†ä¸€ä¸ªæµå¼åŠŸèƒ½, è¿™ä¸ªåŠŸèƒ½å…è®¸æˆ‘ä»¬åŠ¨æ€ä¸‹è½½å’Œè®¿é—®å…ƒç´ , å¹¶ä¸”ä¸éœ€è¦ä¸‹è½½æ•´ä¸ªæ•°æ®é›†ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªåŠŸèƒ½æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

<Tip>

ğŸ’¡åœ¨ Jupyter ç¬”è®°ä¸­ä½ è¿˜å¯ä»¥ä½¿ç”¨[`%%timeit` magic function](https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-timeit)ä¸ºå•å…ƒæ ¼è®¡æ—¶ã€‚

</Tip>

## æµå¼æ•°æ®é›†

è¦ä½¿ç”¨æ•°æ®é›†æµ, ä½ åªéœ€è¦å°† `streaming=True` å‚æ•°ä¼ é€’ç»™ `load_dataset()` å‡½æ•°ã€‚æ¥ä¸‹æ¥, è®©æˆ‘ä»¬å†æ¬¡åŠ è½½ PubMed Abstracts æ•°æ®é›†, ä½†æ˜¯é‡‡ç”¨æµæ¨¡å¼:

```py
pubmed_dataset_streamed = load_dataset(
    "json", data_files=data_files, split="train", streaming=True
)
```

ä¸æˆ‘ä»¬åœ¨æœ¬ç« å…¶ä»–åœ°æ–¹é‡åˆ°çš„ç†Ÿæ‚‰çš„ `Dataset` ä¸åŒ,  `streaming=True` è¿”å›çš„å¯¹è±¡æ˜¯ä¸€ä¸ª `IterableDataset`ã€‚ é¡¾åæ€ä¹‰, è¦è®¿é—® `IterableDataset` , æˆ‘ä»¬éœ€è¦è¿­ä»£å®ƒã€‚æˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è®¿é—®æµå¼æ•°æ®é›†çš„ç¬¬ä¸€ä¸ªå…ƒç´ :


```py
next(iter(pubmed_dataset_streamed))
```

```python out
{'meta': {'pmid': 11409574, 'language': 'eng'},
 'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection.\nTo determine the prevalence of hypoxaemia in children aged under 5 years suffering acute lower respiratory infections (ALRI), the risk factors for hypoxaemia in children under 5 years of age with ALRI, and the association of hypoxaemia with an increased risk of dying in children of the same age ...'}
```

å¦‚æœæ‚¨éœ€è¦åœ¨è®­ç»ƒæœŸé—´æ ‡è®°æµå¼æ•°æ®é›†ä¸­çš„å…ƒç´ å¯ä»¥ä½¿ç”¨ `IterableDataset.map()`è¿›è¡ŒåŠ¨æ€å¤„ç†ã€‚è¯¥è¿‡ç¨‹ä¸æˆ‘ä»¬åœ¨[ç¬¬ä¸‰ç« ](/course/chapter3)ä¸­æ ‡è®°æ•°æ®é›†çš„è¿‡ç¨‹å®Œå…¨ç›¸åŒ, å”¯ä¸€çš„åŒºåˆ«æ˜¯è¾“å‡ºæ˜¯é€ä¸ªè¿”å›çš„:

```py
from transformers import AutoTokenizer

tokenizer = AutoTokenizer.from_pretrained("distilbert-base-uncased")
tokenized_dataset = pubmed_dataset_streamed.map(lambda x: tokenizer(x["text"]))
next(iter(tokenized_dataset))
```

```python out
{'input_ids': [101, 4958, 5178, 4328, 6779, ...], 'attention_mask': [1, 1, 1, 1, 1, ...]}
```

<Tip>

ğŸ’¡ ä½ å¯ä»¥ä¼ é€’ `batched=True` æ¥é€šè¿‡æµå¼åŠ é€Ÿæ ‡è®°åŒ–, å¦‚åŒæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚çœ‹åˆ°çš„é‚£æ ·ã€‚å®ƒå°†é€æ‰¹å¤„ç†ç¤ºä¾‹; é»˜è®¤çš„æ‰¹é‡å¤§å°ä¸º 1,000, å¯ä»¥ä½¿ç”¨ `batch_size` å‚æ•°æŒ‡å®šæ‰¹é‡å¤§å°ã€‚

</Tip>

ä½ è¿˜å¯ä»¥ä½¿ç”¨ `IterableDataset.shuffle()` æ‰“ä¹±æµå¼æ•°æ®é›†, ä½†ä¸ `Dataset.shuffle()` ä¸åŒçš„æ˜¯è¿™åªä¼šæ‰“ä¹±é¢„å®šä¹‰ `buffer_size` ä¸­çš„å…ƒç´ :

```py
shuffled_dataset = pubmed_dataset_streamed.shuffle(buffer_size=10_000, seed=42)
next(iter(shuffled_dataset))
```

```python out
{'meta': {'pmid': 11410799, 'language': 'eng'},
 'text': 'Randomized study of dose or schedule modification of granulocyte colony-stimulating factor in platinum-based chemotherapy for elderly patients with lung cancer ...'}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­, æˆ‘ä»¬ä»ç¼“å†²åŒºçš„å‰ 10,000 ä¸ªç¤ºä¾‹ä¸­éšæœºé€‰æ‹©äº†ä¸€ä¸ªç¤ºä¾‹ã€‚ä¸€æ—¦è®¿é—®äº†ä¸€ä¸ªç¤ºä¾‹, å®ƒåœ¨ç¼“å†²åŒºä¸­çš„ä½ç½®å°±ä¼šè¢«è¯­æ–™åº“ä¸­çš„ä¸‹ä¸€ä¸ªç¤ºä¾‹å¡«å…… (å³, ä¸Šè¿°æ¡ˆä¾‹ä¸­çš„ç¬¬ 10,001ä¸ªç¤ºä¾‹)ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨ `IterableDataset.take()` å’Œ `IterableDataset.skip()` å‡½æ•°ä»æµå¼æ•°æ®é›†ä¸­é€‰æ‹©å…ƒç´ , å®ƒçš„ä½œç”¨ç±»ä¼¼äº `Dataset.select()`ã€‚ä¾‹å¦‚, è¦é€‰æ‹© PubMed Abstracts æ•°æ®é›†çš„å‰5ä¸ªç¤ºä¾‹, æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œ:

```py
dataset_head = pubmed_dataset_streamed.take(5)
list(dataset_head)
```

```python out
[{'meta': {'pmid': 11409574, 'language': 'eng'},
  'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection ...'},
 {'meta': {'pmid': 11409575, 'language': 'eng'},
  'text': 'Clinical signs of hypoxaemia in children with acute lower respiratory infection: indicators of oxygen therapy ...'},
 {'meta': {'pmid': 11409576, 'language': 'eng'},
  'text': "Hypoxaemia in children with severe pneumonia in Papua New Guinea ..."},
 {'meta': {'pmid': 11409577, 'language': 'eng'},
  'text': 'Oxygen concentrators and cylinders ...'},
 {'meta': {'pmid': 11409578, 'language': 'eng'},
  'text': 'Oxygen supply in rural africa: a personal experience ...'}]
```

åŒæ ·, ä½ å¯ä»¥ä½¿ç”¨ `IterableDataset.skip()` å‡½æ•°å°†æ‰“ä¹±çš„æ•°æ®é›†æ‹†åˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›†, å¦‚ä¸‹æ‰€ç¤º:

```py
# Skip the first 1,000 examples and include the rest in the training set
train_dataset = shuffled_dataset.skip(1000)
# Take the first 1,000 examples for the validation set
validation_dataset = shuffled_dataset.take(1000)
```

è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªå¸¸è§çš„ä»»åŠ¡æ¥è¿›è¡Œæˆ‘ä»¬å¯¹æ•°æ®é›†æµçš„æœ€åæ¢ç´¢: å°†å¤šä¸ªæ•°æ®é›†ç»„åˆåœ¨ä¸€èµ·åˆ›å»ºä¸€ä¸ªå¿ƒå¾—è¯­æ–™åº“ã€‚ ğŸ¤— Datasets æä¾›äº†ä¸€ä¸ª `interleave_datasets()` å‡½æ•°, å®ƒå°†ä¸€ä¸ª `IterableDataset` å¯¹è±¡åˆ—è¡¨ç»„åˆä¸ºå•ä¸ªçš„ `IterableDataset`, å…¶ä¸­æ–°æ•°æ®é›†çš„å…ƒç´ æ˜¯é€šè¿‡åœ¨åˆ—è¡¨ä¸­çš„å¯¹è±¡äº¤æ›¿è·å¾—çš„ã€‚å½“ä½ è¯•å›¾ç»„åˆå¤§å‹æ•°æ®é›†æ—¶, è¿™ä¸ªå‡½æ•°ç‰¹åˆ«æœ‰ç”¨, è®©æˆ‘ä»¬é€šè¿‡ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥è¯•ç€ç»„åˆ Pileçš„è‡ªç”±æ³•å¾‹æ•°æ®é›†,å®ƒæ˜¯æ¥è‡ªç¾å›½æ³•é™¢çš„51 GBçš„æ³•å¾‹æ„è§æ•°æ®é›†:

```py
law_dataset_streamed = load_dataset(
    "json",
    data_files="https://mystic.the-eye.eu/public/AI/pile_preliminary_components/FreeLaw_Opinions.jsonl.zst",
    split="train",
    streaming=True,
)
next(iter(law_dataset_streamed))
```

```python out
{'meta': {'case_ID': '110921.json',
  'case_jurisdiction': 'scotus.tar.gz',
  'date_created': '2010-04-28T17:12:49Z'},
 'text': '\n461 U.S. 238 (1983)\nOLIM ET AL.\nv.\nWAKINEKONA\nNo. 81-1581.\nSupreme Court of United States.\nArgued January 19, 1983.\nDecided April 26, 1983.\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...'}
```

è¿™ä¸ªæ•°æ®é›†è¶³å¤Ÿå¤§, å¯ä»¥å¯¹å¤§å¤šæ•°ç¬”è®°æœ¬ç”µè„‘çš„RAMæœ‰è¶³å¤Ÿçš„å‹åŠ›, ä½†æ˜¯æˆ‘ä»¬å·²ç»èƒ½å¤Ÿæ¯«ä¸è´¹åŠ›åœ°åŠ è½½å’Œè®¿é—®å®ƒ! ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ `interleave_datasets()` å‡½æ•°åŠ è½½æ¥è‡ª FreeLaw å’Œ PubMed Abstracts çš„æ•°æ®é›†:

```py
from itertools import islice
from datasets import interleave_datasets

combined_dataset = interleave_datasets([pubmed_dataset_streamed, law_dataset_streamed])
list(islice(combined_dataset, 2))
```

```python out
[{'meta': {'pmid': 11409574, 'language': 'eng'},
  'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection ...'},
 {'meta': {'case_ID': '110921.json',
   'case_jurisdiction': 'scotus.tar.gz',
   'date_created': '2010-04-28T17:12:49Z'},
  'text': '\n461 U.S. 238 (1983)\nOLIM ET AL.\nv.\nWAKINEKONA\nNo. 81-1581.\nSupreme Court of United States.\nArgued January 19, 1983.\nDecided April 26, 1983.\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...'}]
```

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†æ¥è‡ªPythonçš„ `itertools` æ¨¡å—çš„ `islice()` å‡½æ•°ä»åˆå¹¶çš„æ•°æ®é›†ä¸­é€‰æ‹©å‰ä¸¤ä¸ªç¤ºä¾‹, å¹¶ä¸”æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒä»¬å®é™…ä¸Šå°±æ˜¯ä¸¤ä¸ªæºæ•°æ®é›†ä¸­çš„å‰ä¸¤ä¸ªç¤ºä¾‹æ‹¼åœ¨ä¸€èµ·å½¢æˆçš„:

æœ€å, å¦‚æœä½ æƒ³æµå¼ä¼ è¾“æ•´ä¸ª825GBçš„ Pile, ä½ å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è·å–æ‰€æœ‰å‡†å¤‡å¥½çš„æ–‡ä»¶:

```py
base_url = "https://mystic.the-eye.eu/public/AI/pile/"
data_files = {
    "train": [base_url + "train/" + f"{idx:02d}.jsonl.zst" for idx in range(30)],
    "validation": base_url + "val.jsonl.zst",
    "test": base_url + "test.jsonl.zst",
}
pile_dataset = load_dataset("json", data_files=data_files, streaming=True)
next(iter(pile_dataset["train"]))
```

```python out
{'meta': {'pile_set_name': 'Pile-CC'},
 'text': 'It is done, and submitted. You can play â€œSurvival of the Tastiestâ€ on Android, and on the web...'}
```

<Tip>

âœï¸ **è¯•è¯•çœ‹!** ä½¿ç”¨åƒ[`mc4`](https://huggingface.co/datasets/mc4) æˆ–è€… [`oscar`](https://huggingface.co/datasets/oscar)è¿™æ ·çš„å¤§å‹ Common Crawl è¯­æ–™åº“æ¥åˆ›å»ºä¸€ä¸ªæµå¼å¤šè¯­è¨€æ•°æ®é›†, è¯¥æ•°æ®é›†ä»£è¡¨ä½ é€‰æ‹©çš„å›½å®¶/åœ°åŒºè¯­è¨€çš„å£è¯­æ¯”ä¾‹ã€‚ä¾‹å¦‚, ç‘å£«çš„å››ç§æ°‘æ—è¯­è¨€åˆ†åˆ«æ˜¯å¾·è¯­ã€æ³•è¯­ã€æ„å¤§åˆ©è¯­å’Œç½—æ›¼ä»€è¯­, å› æ­¤ä½ å¯ä»¥å°è¯•æ ¹æ®æ ¹æ®å£è¯­æ¯”ä¾‹å¯¹Oscarå­é›†è¿›è¡Œé‡‡ç”¨æ¥åˆ›å»ºç‘å£«è¯­æ–™åº“ã€‚

</Tip>

ä½ ç°åœ¨æ‹¥æœ‰åŠ è½½å’Œå¤„ç†å„ç§ç±»å‹å’Œå¤§å°çš„æ•°æ®é›†çš„æ‰€éœ€çš„æ‰€æœ‰å·¥å…· -- ä½†æ˜¯é™¤éä½ éå¸¸å¹¸è¿, å¦åˆ™åœ¨ä½ çš„NLPä¹‹æ—…ä¸­ä¼šæœ‰ä¸€ä¸ªéš¾é¢˜, ä½ å°†ä¸å¾—ä¸åˆ›å»ºä¸€ä¸ªæ•°æ®é›†æ¥è§£å†³æ‰‹å¤´çš„é—®é¢˜ã€‚è¿™å°±æ˜¯ä¸‹ä¸€èŠ‚çš„ä¸»é¢˜!
