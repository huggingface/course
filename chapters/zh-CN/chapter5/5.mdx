# åˆ›å»ºè‡ªå·±çš„æ•°æ®é›† [[åˆ›å»ºè‡ªå·±çš„æ•°æ®é›†]]

<CourseFloatingBanner chapter={5}
  classNames="absolute z-10 right-0 top-0"
  notebooks={[
    {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/zh-CN/chapter5/section5.ipynb"},
    {label: "Aws Studio", value: "https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/zh-CN/chapter5/section5.ipynb"},
]} />

æœ‰æ—¶ï¼Œä¸å­˜åœ¨ç°æœ‰çš„åˆé€‚çš„æ•°æ®é›†é€‚ç”¨äºä½ æ„å»º NLP åº”ç”¨ï¼Œå› æ­¤ä½ éœ€è¦è‡ªå·±åˆ›å»ºã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å‘ä½ å±•ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªç”± [GitHub issues](https://github.com/features/issues/) ç»„æˆçš„çš„è¯­æ–™åº“ï¼Œè¿™äº› issues é€šå¸¸ç”¨äºè·Ÿè¸ª GitHub ä»“åº“ä¸­çš„é”™è¯¯æˆ–åŠŸèƒ½ã€‚è¯¥è¯­æ–™åº“å¯ç”¨äºå„ç§åº”ç”¨åœºæ™¯ï¼ŒåŒ…æ‹¬ï¼š
* æ¢ç´¢è§£å†³ issue æˆ–åˆå¹¶ pull è¯·æ±‚éœ€è¦å¤šé•¿æ—¶é—´
* è®­ç»ƒä¸€ä¸ª `å¤šæ ‡ç­¾åˆ†ç±»å™¨ï¼ˆmultilabel classifierï¼‰` å¯ä»¥æ ¹æ® issue çš„æè¿°ä¸º issue æ ‡ä¸Šå…ƒæ•°æ®æ ‡ç­¾ï¼ˆä¾‹å¦‚ï¼Œâ€œbugâ€ã€â€œenhancementï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰â€æˆ–â€œquestionâ€ï¼‰
* åˆ›å»ºè¯­ä¹‰æœç´¢å¼•æ“ä»¥æŸ¥æ‰¾ä¸ç”¨æˆ·æŸ¥è¯¢åŒ¹é…çš„ issue

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å…³æ³¨å¦‚ä½•åˆ›å»ºè¯­æ–™åº“ï¼Œåœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢è¯­ä¹‰æœç´¢ã€‚åŸæ±¤åŒ–åŸé£Ÿï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªæµè¡Œçš„å¼€æºé¡¹ç›®çš„ GitHub issueï¼šğŸ¤— Datasetsï¼æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•è·å–æ•°æ®å¹¶æ¢ç´¢è¿™äº› issue ä¸­åŒ…å«çš„ä¿¡æ¯ã€‚

## è·å–æ•°æ® [[è·å–æ•°æ®]]

ä½ å¯ä»¥ç‚¹å‡» [Issues é€‰é¡¹å¡](https://github.com/huggingface/datasets/issues) æµè§ˆ ğŸ¤— Datasets ä¸­çš„æ‰€æœ‰ issusã€‚å¦‚ä»¥ä¸‹å±å¹•æˆªå›¾æ‰€ç¤ºï¼Œåœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œæœ‰ 331 ä¸ªæœªè§£å†³çš„ issue å’Œ 668 ä¸ªå·²å…³é—­çš„ issueã€‚

<div class="flex justify-center">
<img src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter5/datasets-issues.png" alt="The GitHub issues associated with ğŸ¤— Datasets." width="80%"/>
</div>

å¦‚æœä½ å•å‡»å…¶ä¸­ä¸€ä¸ª issueï¼Œä½ ä¼šå‘ç°å®ƒåŒ…å«ä¸€ä¸ªæ ‡é¢˜ã€ä¸€ä¸ªæè¿°å’Œä¸€ç»„æ ‡ç­¾ï¼Œè¿™äº›æ ‡ç­¾æ˜¯å¯¹ issue çš„æè¿°ã€‚ä¸‹é¢çš„å±å¹•æˆªå›¾æ˜¾ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹ï¼š

<div class="flex justify-center">
<img src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter5/datasets-issues-single.png" alt="A typical GitHub issue in the ğŸ¤— Datasets repository." width="80%"/>
</div>

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [GitHub REST API](https://docs.github.com/en/rest) éå† [Issues èŠ‚ç‚¹(endpoint)](https://docs.github.com/en/rest/reference/issues#list-repository-issues) ä¸‹è½½æ‰€æœ‰ä»“åº“çš„ issueã€‚èŠ‚ç‚¹ï¼ˆendpointï¼‰å°†è¿”å›ä¸€ä¸ª JSON å¯¹è±¡åˆ—è¡¨ï¼Œæ¯ä¸ªå¯¹è±¡åŒ…å«å¤§é‡å­—æ®µï¼Œå…¶ä¸­åŒ…æ‹¬æ ‡é¢˜å’Œæè¿°ä»¥åŠæœ‰å…³ issue çŠ¶æ€çš„å…ƒæ•°æ®ç­‰ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ `requests` åº“æ¥ä¸‹è½½ï¼Œè¿™æ˜¯ç”¨ Python ä¸­å‘å‡º HTTP è¯·æ±‚çš„æ ‡å‡†æ–¹å¼ã€‚ä½ å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹çš„ä»£ç æ¥å®‰è£… `requests` åº“ï¼š

```python
!pip install requests
```

å®‰è£…åº“åï¼Œä½ é€šè¿‡è°ƒç”¨ `requests.get()` åŠŸèƒ½æ¥è·å– `Issues` èŠ‚ç‚¹ï¼ˆendpointï¼‰ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥è·å–ç¬¬ä¸€é¡µä¸Šçš„ç¬¬ä¸€ä¸ª Issuesï¼š

```py
import requests

url = "https://api.github.com/repos/huggingface/datasets/issues?page=1&per_page=1"
response = requests.get(url)
```

`response` å¯¹è±¡åŒ…å«å¾ˆå¤šå…³äºè¯·æ±‚çš„æœ‰ç”¨ä¿¡æ¯,åŒ…æ‹¬ HTTP çŠ¶æ€ç :

```py
response.status_code
```

```python out
200
```

å…¶ä¸­ï¼Œ `200` çŠ¶æ€è¡¨ç¤ºè¯·æ±‚æˆåŠŸï¼ˆä½ å¯ä»¥åœ¨ [è¿™é‡Œ](https://en.wikipedia.org/wiki/List_of_HTTP_status_codes) æ‰¾åˆ°æ‰€æœ‰å¯èƒ½çš„ HTTP çŠ¶æ€ä»£ç åˆ—è¡¨ï¼‰ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬çœŸæ­£æ„Ÿå…´è¶£çš„æ˜¯æ¶ˆæ¯ä½“ä¸­çš„æœ‰æ•ˆä¿¡æ¯ï¼Œç”±äºæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬çš„ issues æ˜¯ JSON æ ¼å¼ï¼Œè®©æˆ‘ä»¬æŒ‰å¦‚ä¸‹æ–¹å¼æŸ¥çœ‹æ¶ˆæ¯ä½“çš„ä¿¡æ¯ï¼š

```py
response.json()
```

```python out
[{'url': 'https://api.github.com/repos/huggingface/datasets/issues/2792',
  'repository_url': 'https://api.github.com/repos/huggingface/datasets',
  'labels_url': 'https://api.github.com/repos/huggingface/datasets/issues/2792/labels{/name}',
  'comments_url': 'https://api.github.com/repos/huggingface/datasets/issues/2792/comments',
  'events_url': 'https://api.github.com/repos/huggingface/datasets/issues/2792/events',
  'html_url': 'https://github.com/huggingface/datasets/pull/2792',
  'id': 968650274,
  'node_id': 'MDExOlB1bGxSZXF1ZXN0NzEwNzUyMjc0',
  'number': 2792,
  'title': 'Update GooAQ',
  'user': {'login': 'bhavitvyamalik',
   'id': 19718818,
   'node_id': 'MDQ6VXNlcjE5NzE4ODE4',
   'avatar_url': 'https://avatars.githubusercontent.com/u/19718818?v=4',
   'gravatar_id': '',
   'url': 'https://api.github.com/users/bhavitvyamalik',
   'html_url': 'https://github.com/bhavitvyamalik',
   'followers_url': 'https://api.github.com/users/bhavitvyamalik/followers',
   'following_url': 'https://api.github.com/users/bhavitvyamalik/following{/other_user}',
   'gists_url': 'https://api.github.com/users/bhavitvyamalik/gists{/gist_id}',
   'starred_url': 'https://api.github.com/users/bhavitvyamalik/starred{/owner}{/repo}',
   'subscriptions_url': 'https://api.github.com/users/bhavitvyamalik/subscriptions',
   'organizations_url': 'https://api.github.com/users/bhavitvyamalik/orgs',
   'repos_url': 'https://api.github.com/users/bhavitvyamalik/repos',
   'events_url': 'https://api.github.com/users/bhavitvyamalik/events{/privacy}',
   'received_events_url': 'https://api.github.com/users/bhavitvyamalik/received_events',
   'type': 'User',
   'site_admin': False},
  'labels': [],
  'state': 'open',
  'locked': False,
  'assignee': None,
  'assignees': [],
  'milestone': None,
  'comments': 1,
  'created_at': '2021-08-12T11:40:18Z',
  'updated_at': '2021-08-12T12:31:17Z',
  'closed_at': None,
  'author_association': 'CONTRIBUTOR',
  'active_lock_reason': None,
  'pull_request': {'url': 'https://api.github.com/repos/huggingface/datasets/pulls/2792',
   'html_url': 'https://github.com/huggingface/datasets/pull/2792',
   'diff_url': 'https://github.com/huggingface/datasets/pull/2792.diff',
   'patch_url': 'https://github.com/huggingface/datasets/pull/2792.patch'},
  'body': '[GooAQ](https://github.com/allenai/gooaq) dataset was recently updated after splits were added for the same. This PR contains new updated GooAQ with train/val/test splits and updated README as well.',
  'performed_via_github_app': None}]
```

å“‡ï¼Œå¥½å¤§é‡çš„ä¿¡æ¯ï¼æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ç”¨çš„å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¸å¦‚ `title` ã€ `body` å’Œ `number` ç­‰æè¿° issue çš„æœ‰ç”¨å­—æ®µï¼Œä»¥åŠå…³äºåˆ›å»º issue çš„ GitHub ç”¨æˆ·çš„ä¿¡æ¯ã€‚

<Tip>

âœï¸ **è¯•è¯•çœ‹ï¼**æ‰“å¼€ä¸Šé¢ JSON ä¸­çš„ä¸€äº› URLï¼Œä»¥äº†è§£æ¯ä¸ª GitHub issue ä¸­ url æ‰€é“¾æ¥çš„ä¿¡æ¯ç±»å‹ã€‚

</Tip>

å¦‚ GitHub [æ–‡æ¡£](https://docs.github.com/en/rest/overview/resources-in-the-rest-api#rate-limiting) ä¸­æ‰€è¿°ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¯·æ±‚é™åˆ¶ä¸ºæ¯å°æ—¶ 60 ä¸ªè¯·æ±‚ã€‚è™½ç„¶ä½ å¯ä»¥å¢åŠ  `per_page` æŸ¥è¯¢å‚æ•°ä»¥å‡å°‘ä½ å‘å‡ºçš„è¯·æ±‚æ¬¡æ•°ï¼Œä½†ä½ ä»ä¼šåœ¨ä»»ä½•æœ‰å‡ åƒä¸ªä»¥ä¸Š issue çš„ä»“åº“ä¸Šè§¦å‘é€Ÿç‡é™åˆ¶ã€‚å› æ­¤ï¼Œä½ åº”è¯¥æŒ‰ç…§ GitHub çš„ [è¯´æ˜](https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token) ï¼Œåˆ›å»ºä¸€ä¸ª `ä¸ªäººè®¿é—®ä»¤ç‰Œï¼ˆpersonal access tokenï¼‰` è¿™æ ·ä½ å°±å¯ä»¥å°†é€Ÿç‡é™åˆ¶æé«˜åˆ°æ¯å°æ—¶ 5,000 ä¸ªè¯·æ±‚ã€‚è·å¾—ä»¤ç‰Œåï¼Œä½ å¯ä»¥å°†å…¶æ”¾åœ¨è¯·æ±‚æ ‡å¤´ä¸­ï¼š

```py
GITHUB_TOKEN = xxx  #  å°†ä½ çš„GitHubä»¤ç‰Œå¤åˆ¶åˆ°æ­¤å¤„
headers = {"Authorization": f"token {GITHUB_TOKEN}"}
```

<Tip warning={true}>

âš ï¸ ä¸è¦ä¸é™Œç”Ÿäººå…±äº«å­˜åœ¨ `GITHUBä»¤ç‰Œ` çš„ç¬”è®°æœ¬ã€‚æˆ‘ä»¬å»ºè®®ä½ åœ¨ä½¿ç”¨å®Œåå°† `GITHUBä»¤ç‰Œ` åˆ é™¤ï¼Œä»¥é¿å…æ„å¤–æ³„æ¼ã€‚ä¸€ä¸ªæ›´å¥½çš„åšæ³•æ˜¯ï¼Œå°†ä»¤ç‰Œå­˜å‚¨åœ¨ï¼env æ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨ [`python-dotenv`åº“](https://github.com/theskumar/python-dotenv) è‡ªåŠ¨åŠ è½½ç¯å¢ƒå˜é‡ã€‚

</Tip>

ç°åœ¨æˆ‘ä»¬æœ‰äº†è®¿é—®ä»¤ç‰Œï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯ä»¥ä» GitHub ä»“åº“ä¸‹è½½æ‰€æœ‰ issue çš„å‡½æ•°ï¼š

```py
import time
import math
from pathlib import Path
import pandas as pd
from tqdm.notebook import tqdm


def fetch_issues(
    owner="huggingface",
    repo="datasets",
    num_issues=10_000,
    rate_limit=5_000,
    issues_path=Path("."),
):
    if not issues_path.is_dir():
        issues_path.mkdir(exist_ok=True)

    batch = []
    all_issues = []
    per_page = 100  ## æ¯é¡µè¿”å›çš„ issue çš„æ•°é‡
    num_pages = math.ceil(num_issues / per_page)
    base_url = "https://api.github.com/repos"

    for page in tqdm(range(num_pages)):
        # ä½¿ç”¨ state=all è¿›è¡ŒæŸ¥è¯¢æ¥è·å– open å’Œ closed çš„issue
        query = f"issues?page={page}&per_page={per_page}&state=all"
        issues = requests.get(f"{base_url}/{owner}/{repo}/{query}", headers=headers)
        batch.extend(issues.json())

        if len(batch) > rate_limit and len(all_issues) < num_issues:
            all_issues.extend(batch)
            batch = []  # é‡ç½®batch
            print(f"Reached GitHub rate limit. Sleeping for one hour ...")
            time.sleep(60 * 60 + 1)

    all_issues.extend(batch)
    df = pd.DataFrame.from_records(all_issues)
    df.to_json(f"{issues_path}/{repo}-issues.jsonl", orient="records", lines=True)
    print(
        f"Downloaded all the issues for {repo}! Dataset stored at {issues_path}/{repo}-issues.jsonl"
    )
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥è°ƒç”¨ `fetch_issues()` å®ƒå°†æŒ‰æ‰¹æ¬¡ä¸‹è½½æ‰€æœ‰ issueï¼Œä»¥é¿å…è¶…è¿‡ GitHub æ¯å°æ—¶è¯·æ±‚æ¬¡æ•°çš„é™åˆ¶ï¼›ç»“æœå°†å­˜å‚¨åœ¨ `repository_name-issues.jsonl` æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œä»£è¡¨ä¸€ä¸ª issueã€‚è®©æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå‡½æ•°ä» ğŸ¤— Datasets ä¸­æŠ“å–æ‰€æœ‰ issueï¼š

```py
# å–å†³äºä½ çš„ç½‘ç»œè¿æ¥,è¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´æ¥è¿è¡Œ...
fetch_issues()
```

ä¸‹è½½ issue åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬åœ¨ [ç¬¬äºŒèŠ‚](/course/chapter5/2) æ–°å­¦ä¼šçš„æ–¹æ³•åœ¨æœ¬åœ°åŠ è½½å®ƒä»¬ï¼š

```py
issues_dataset = load_dataset("json", data_files="datasets-issues.jsonl", split="train")
issues_dataset
```

```python out
Dataset({
    features: ['url', 'repository_url', 'labels_url', 'comments_url', 'events_url', 'html_url', 'id', 'node_id', 'number', 'title', 'user', 'labels', 'state', 'locked', 'assignee', 'assignees', 'milestone', 'comments', 'created_at', 'updated_at', 'closed_at', 'author_association', 'active_lock_reason', 'pull_request', 'body', 'timeline_url', 'performed_via_github_app'],
    num_rows: 3019
})
```

å¤ªå¥½äº†ï¼Œæˆ‘ä»¬å·²ç»ä»å¤´å¼€å§‹åˆ›å»ºäº†æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ•°æ®é›†ï¼ä½†æ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰å‡ åƒä¸ª issueï¼Œè€ŒğŸ¤— Datasets ä»“åº“ä¸­çš„ [Issues é€‰é¡¹å¡](https://github.com/huggingface/datasets/issues) æ€»å…±å´åªæ˜¾ç¤ºäº†å¤§çº¦ 1,000 ä¸ª issueğŸ¤”ï¼Ÿå¦‚ GitHub [æ–‡æ¡£](https://docs.github.com/en/rest/reference/issues#list-issues-assigned-to-the-authenticated-user) ä¸­æ‰€è¿°ï¼Œé‚£æ˜¯å› ä¸ºæˆ‘ä»¬ä¸åŠ ä¸‹è½½äº† issue è¿˜ä¸‹è½½äº†æ‰€æœ‰çš„ pull è¯·æ±‚ï¼š

> Git Hub çš„ REST API v3 è®¤ä¸ºæ¯ä¸ª pull è¯·æ±‚éƒ½æ˜¯ä¸€ä¸ª issueï¼Œä½†äº‹å®ä¸Šå¹¶ä¸æ˜¯æ¯ä¸ª issue éƒ½æ˜¯ä¸€ä¸ª pull è¯·æ±‚ã€‚å› æ­¤ï¼Œâ€œIssuesâ€èŠ‚ç‚¹å¯èƒ½åŒæ—¶è¿”å›äº† issue å’Œ pull è¯·æ±‚ã€‚ä½ å¯ä»¥é€šè¿‡ `pull_request` çš„ key æ¥è¾¨åˆ« pull è¯·æ±‚ã€‚è¯·æ³¨æ„ï¼Œä»â€œIssuesâ€èŠ‚ç‚¹è¿”å›çš„ pull è¯·æ±‚çš„ id å°†æ˜¯ä¸€ä¸ª issue idã€‚

ç”±äº issue å’Œ pull request çš„å†…å®¹æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œæˆ‘ä»¬å…ˆåšä¸€äº›å°çš„é¢„å¤„ç†ï¼Œè®©æˆ‘ä»¬èƒ½å¤ŸåŒºåˆ†å®ƒä»¬ã€‚

## æ¸…æ´—æ•°æ® [[æ¸…æ´—æ•°æ®]]

ä¸Šé¢çš„ GitHub æ–‡æ¡£å‘Šè¯‰æˆ‘ä»¬ï¼Œ `pull_request` åˆ—å¯ç”¨äºåŒºåˆ† issue å’Œ pull è¯·æ±‚ã€‚è®©æˆ‘ä»¬éšæœºæŒ‘é€‰ä¸€äº›æ ·æœ¬ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆä¸åŒã€‚æˆ‘ä»¬å°†ä½¿ç”¨åœ¨ [ç¬¬ä¸‰èŠ‚](/course/chapter5/3) ï¼Œå­¦ä¹ çš„æ–¹æ³•ï¼Œä½¿ç”¨ `Dataset.shuffle()` å’Œ `Dataset.select()` æŠ½å–ä¸€ä¸ªéšæœºæ ·æœ¬ï¼Œç„¶åå°† `html_url` å’Œ `pull_request` åˆ—ä½¿ç”¨ zip å‡½æ•°ç»„åˆèµ·æ¥ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æ¯”è¾ƒå„ç§ URLï¼š

```py
sample = issues_dataset.shuffle(seed=666).select(range(3))

# æ‰“å°å‡º URL å’Œ pull è¯·æ±‚
for url, pr in zip(sample["html_url"], sample["pull_request"]):
    print(f">> URL: {url}")
    print(f">> Pull request: {pr}\n")
```

```python out
>> URL: https://github.com/huggingface/datasets/pull/850
>> Pull request: {'url': 'https://api.github.com/repos/huggingface/datasets/pulls/850', 'html_url': 'https://github.com/huggingface/datasets/pull/850', 'diff_url': 'https://github.com/huggingface/datasets/pull/850.diff', 'patch_url': 'https://github.com/huggingface/datasets/pull/850.patch'}

>> URL: https://github.com/huggingface/datasets/issues/2773
>> Pull request: None

>> URL: https://github.com/huggingface/datasets/pull/783
>> Pull request: {'url': 'https://api.github.com/repos/huggingface/datasets/pulls/783', 'html_url': 'https://github.com/huggingface/datasets/pull/783', 'diff_url': 'https://github.com/huggingface/datasets/pull/783.diff', 'patch_url': 'https://github.com/huggingface/datasets/pull/783.patch'}
```

è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ª pull è¯·æ±‚éƒ½ä¸å„ç§ url ç›¸å…³è”ï¼Œè€Œæ™®é€š issue åªæœ‰ä¸€ä¸ª `None` æ¡ç›®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸€ç‚¹ä¸åŒæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ `is_pull_request` åˆ—ï¼Œé€šè¿‡æ£€æŸ¥ `pull_request` å­—æ®µæ˜¯å¦ä¸º `None` æ¥åŒºåˆ†å®ƒä»¬ï¼š

```py
issues_dataset = issues_dataset.map(
    lambda x: {"is_pull_request": False if x["pull_request"] is None else True}
)
```

<Tip>

âœï¸ **è¯•è¯•çœ‹ï¼**è®¡ç®—åœ¨ ğŸ¤— Datasets ä¸­è§£å†³ issue æ‰€éœ€çš„å¹³å‡æ—¶é—´ã€‚ä½ å¯èƒ½ä¼šå‘ç° `Dataset.filter()` å‡½æ•°å¯¹äºè¿‡æ»¤ pull è¯·æ±‚å’Œæœªè§£å†³çš„ issue å¾ˆæœ‰ç”¨ï¼Œå¹¶ä¸”ä½ å¯ä»¥ä½¿ç”¨ `Dataset.set_format()` å‡½æ•°å°†æ•°æ®é›†è½¬æ¢ä¸º `DataFrame` ï¼Œä»¥ä¾¿ä½ å¯ä»¥è½»æ¾åœ°æŒ‰ç…§éœ€æ±‚ä¿®æ”¹ `åˆ›å»º(created_at)` å’Œ `å…³é—­(closed_at)` çš„æ—¶é—´çš„æ ¼å¼ï¼ˆä»¥æ—¶é—´æˆ³æ ¼å¼ï¼‰ã€‚

</Tip>

å°½ç®¡æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ é™¤æˆ–é‡å‘½åæŸäº›åˆ—æ¥è¿›ä¸€æ­¥æ¸…ç†æ•°æ®é›†ï¼Œä½†åœ¨æ­¤é˜¶æ®µå°½å¯èƒ½ä¿æŒæ•°æ®é›†â€œåŸå§‹â€çŠ¶æ€é€šå¸¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åšæ³•ï¼Œä»¥ä¾¿å®ƒå¯ä»¥åœ¨å¤šä¸ªä¸åŒçš„é¡¹ç›®ä¸­è½»æ¾ä½¿ç”¨ã€‚åœ¨æˆ‘ä»¬å°†æ•°æ®é›†æ¨é€åˆ° Hugging Face Hub ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å†æ·»åŠ ä¸€äº›ç¼ºå°‘çš„æ•°æ®ï¼šæ¯ä¸ª issue å’Œ pull ä¸­çš„è¯„è®ºã€‚æˆ‘ä»¬æ¥ä¸‹æ¥å°†æ·»åŠ å®ƒä»¬â€”â€”ä½ çŒœå¯¹äº†â€”â€”æˆ‘ä»¬å°†ä¾ç„¶ä½¿ç”¨ GitHub REST APIï¼

## æ‰©å……æ•°æ®é›† [[æ‰©å……æ•°æ®é›†]]

å¦‚ä»¥ä¸‹æˆªå›¾æ‰€ç¤ºï¼Œissue æˆ– pull è¯·æ±‚ç›¸å…³çš„è¯„è®ºæä¾›äº†ä¸°å¯Œçš„ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯å¦‚æœæˆ‘ä»¬æœ‰å…´è¶£æ„å»ºæœç´¢å¼•æ“æ¥å›ç­”ç”¨æˆ·å¯¹è¿™ä¸ªä»“åº“çš„ç–‘é—®æ—¶ï¼Œè¿™äº›ä¿¡æ¯å°†éå¸¸æœ‰ç”¨ã€‚

<div class="flex justify-center">
<img src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter5/datasets-issues-comment.png" alt="Comments associated with an issue about ğŸ¤— Datasets." width="80%"/>
</div>

GitHub REST API æä¾›äº†ä¸€ä¸ª [`Comments(è¯„è®º)`èŠ‚ç‚¹](https://docs.github.com/en/rest/reference/issues#list-issue-comments) è¿”å›ä¸ issue ç¼–å·ç›¸å…³çš„æ‰€æœ‰è¯„è®ºã€‚è®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹è¯¥èŠ‚ç‚¹è¿”å›çš„å†…å®¹ï¼š

```py
issue_number = 2792
url = f"https://api.github.com/repos/huggingface/datasets/issues/{issue_number}/comments"
response = requests.get(url, headers=headers)
response.json()
```

```python out
[{'url': 'https://api.github.com/repos/huggingface/datasets/issues/comments/897594128',
  'html_url': 'https://github.com/huggingface/datasets/pull/2792#issuecomment-897594128',
  'issue_url': 'https://api.github.com/repos/huggingface/datasets/issues/2792',
  'id': 897594128,
  'node_id': 'IC_kwDODunzps41gDMQ',
  'user': {'login': 'bhavitvyamalik',
   'id': 19718818,
   'node_id': 'MDQ6VXNlcjE5NzE4ODE4',
   'avatar_url': 'https://avatars.githubusercontent.com/u/19718818?v=4',
   'gravatar_id': '',
   'url': 'https://api.github.com/users/bhavitvyamalik',
   'html_url': 'https://github.com/bhavitvyamalik',
   'followers_url': 'https://api.github.com/users/bhavitvyamalik/followers',
   'following_url': 'https://api.github.com/users/bhavitvyamalik/following{/other_user}',
   'gists_url': 'https://api.github.com/users/bhavitvyamalik/gists{/gist_id}',
   'starred_url': 'https://api.github.com/users/bhavitvyamalik/starred{/owner}{/repo}',
   'subscriptions_url': 'https://api.github.com/users/bhavitvyamalik/subscriptions',
   'organizations_url': 'https://api.github.com/users/bhavitvyamalik/orgs',
   'repos_url': 'https://api.github.com/users/bhavitvyamalik/repos',
   'events_url': 'https://api.github.com/users/bhavitvyamalik/events{/privacy}',
   'received_events_url': 'https://api.github.com/users/bhavitvyamalik/received_events',
   'type': 'User',
   'site_admin': False},
  'created_at': '2021-08-12T12:21:52Z',
  'updated_at': '2021-08-12T12:31:17Z',
  'author_association': 'CONTRIBUTOR',
  'body': "@albertvillanova my tests are failing here:\r\n```\r\ndataset_name = 'gooaq'\r\n\r\n    def test_load_dataset(self, dataset_name):r\n        configs = self.dataset_tester.load_all_configs(dataset_name, is_local=True)[:1]\r\n>       self.dataset_tester.check_load_dataset(dataset_name, configs, is_local=True, use_local_dummy_data=True)\r\n\r\ntests/test_dataset_common.py:234: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\ntests/test_dataset_common.py:187: in check_load_dataset\r\n    self.parent.assertTrue(len(dataset[split]) > 0)\r\nE   AssertionError: False is not true\r\n```\r\nWhen I try loading dataset on local machine it works fine. Any suggestions on how can I avoid this error?",
  'performed_via_github_app': None}]
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯„è®ºå­˜å‚¨åœ¨ `body` å­—æ®µä¸­ï¼Œå› æ­¤è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œé€šè¿‡æŒ‘é€‰å‡º `response.json()` ä¸­æ¯ä¸ªå…ƒç´ çš„ `body` å†…å®¹ï¼Œè¿”å›ä¸æŸä¸ª issue ç›¸å…³çš„æ‰€æœ‰è¯„è®ºï¼š

```py
def get_comments(issue_number):
    url = f"https://api.github.com/repos/huggingface/datasets/issues/{issue_number}/comments"
    response = requests.get(url, headers=headers)
    return [r["body"] for r in response.json()]


# æµ‹è¯•æˆ‘ä»¬çš„å‡½æ•°æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ
get_comments(2792)
```

```python out
["@albertvillanova my tests are failing here:\r\n```\r\ndataset_name = 'gooaq'\r\n\r\n    def test_load_dataset(self, dataset_name):r\n        configs = self.dataset_tester.load_all_configs(dataset_name, is_local=True)[:1]\r\n>       self.dataset_tester.check_load_dataset(dataset_name, configs, is_local=True, use_local_dummy_data=True)\r\n\r\ntests/test_dataset_common.py:234: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\ntests/test_dataset_common.py:187: in check_load_dataset\r\n    self.parent.assertTrue(len(dataset[split]) > 0)\r\nE   AssertionError: False is not true\r\n```\r\nWhen I try loading dataset on local machine it works fine. Any suggestions on how can I avoid this error?"]
```

è¿™çœ‹èµ·æ¥ä¸é”™ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä½¿ç”¨ `Dataset.map()` æ–¹æ³•ï¼Œä¸ºæˆ‘ä»¬æ•°æ®é›†ä¸­æ¯ä¸ª issue çš„æ·»åŠ ä¸€ä¸ª `comments` åˆ—ï¼š

```py
# å–å†³äºä½ çš„ç½‘ç»œè¿æ¥,è¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´...
issues_with_comments_dataset = issues_dataset.map(
    lambda x: {"comments": get_comments(x["number"])}
)
```

æœ€åä¸€æ­¥æ˜¯å°†æˆ‘ä»¬çš„æ•°æ®é›†æ¨é€åˆ° Hubï¼Œè®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹è¯¥æ€ä¹ˆæ¨é€ï¼š

## å°†æ•°æ®é›†ä¸Šä¼ åˆ° Hugging Face Hub [[å°†æ•°æ®é›†ä¸Šä¼ åˆ° Hugging Face Hub]]

<Youtube id="HaN6qCr_Afc"/>

ç°åœ¨æˆ‘ä»¬æœ‰äº†æ‰©å……åçš„æ•°æ®é›†ï¼Œæ˜¯æ—¶å€™å°†å®ƒæ¨é€åˆ° Hub å¹¶ä¸ç¤¾åŒºå…±äº«äº†ï¼ä¸Šä¼ æ•°æ®é›†éå¸¸ç®€å•ï¼šå°±åƒ ğŸ¤— Transformers ä¸­çš„æ¨¡å‹å’Œ tokenizer ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `push_to_hub()` æ–¹æ³•æ¥æ¨é€æ•°æ®é›†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªèº«ä»½éªŒè¯ä»¤ç‰Œï¼Œå®ƒå¯ä»¥é€šè¿‡é¦–å…ˆä½¿ç”¨ `notebook_login()` å‡½æ•°ç™»å½•åˆ° Hugging Face Hub æ¥è·å¾—ï¼š

```py
from huggingface_hub import notebook_login

notebook_login()
```
è¿™å°†åˆ›å»ºä¸€ä¸ªå°éƒ¨ä»¶ï¼Œä½ å¯ä»¥åœ¨å…¶ä¸­è¾“å…¥ä½ çš„ç”¨æˆ·åå’Œå¯†ç ï¼ŒAPI ä»¤ç‰Œå°†ä¿å­˜åœ¨ `~/.huggingface/token` ä¸­ã€‚å¦‚æœä½ åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»£ç ï¼Œåˆ™å¯ä»¥æ”¹ä¸ºä½¿ç”¨å‘½ä»¤è¡Œç™»å½•ï¼š

```bash
huggingface-cli login
```

å®Œæˆæ­¤æ“ä½œåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œä¸‹é¢çš„ä»£ç ä¸Šä¼ æˆ‘ä»¬çš„æ•°æ®é›†ï¼š

```py
issues_with_comments_dataset.push_to_hub("github-issues")
```

ä¹‹åï¼Œä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡ä¾¿æ·åœ°ä½¿ç”¨é™„å¸¦ä»“åº“ ID ä½œä¸º `path` å‚æ•°çš„ `load_dataset()` å‡½æ•° æ¥ä¸‹è½½æ•°æ®é›†ï¼š

```py
remote_dataset = load_dataset("lewtun/github-issues", split="train")
remote_dataset
```

```python out
Dataset({
    features: ['url', 'repository_url', 'labels_url', 'comments_url', 'events_url', 'html_url', 'id', 'node_id', 'number', 'title', 'user', 'labels', 'state', 'locked', 'assignee', 'assignees', 'milestone', 'comments', 'created_at', 'updated_at', 'closed_at', 'author_association', 'active_lock_reason', 'pull_request', 'body', 'performed_via_github_app', 'is_pull_request'],
    num_rows: 2855
})
```

å¾ˆé…·ï¼Œæˆ‘ä»¬å·²ç»å°†æˆ‘ä»¬çš„æ•°æ®é›†æ¨é€åˆ° Hubï¼Œå…¶ä»–äººå¯ä»¥ä½¿ç”¨å®ƒï¼åªå‰©ä¸‹ä¸€ä»¶é‡è¦çš„äº‹æƒ…è¦åšï¼šæ·»åŠ ä¸€ä¸ªæ•°æ®å¡ç‰‡ï¼Œè§£é‡Šè¯­æ–™åº“æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼Œå¹¶ä¸ºä½¿ç”¨æ•°æ®é›†çš„å…¶ä»–æä¾›ä¸€äº›å…¶ä»–æœ‰ç”¨çš„ä¿¡æ¯ã€‚

<Tip>

ğŸ’¡ ä½ è¿˜å¯ä»¥ä½¿ç”¨ä¸€äº› Git æŠ€å·§å’Œ `huggingface-cli` ç›´æ¥ä»ç»ˆç«¯å°†æ•°æ®é›†ä¸Šä¼ åˆ° Hugging Face Hubã€‚æœ‰å…³å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… [ğŸ¤— Datasets æŒ‡å—](https://huggingface.co/docs/datasets/share#share-a-dataset-using-the-cli) æŒ‡å—ã€‚

</Tip>

## åˆ›å»ºæ•°æ®é›†å¡ç‰‡ [[åˆ›å»ºæ•°æ®é›†å¡ç‰‡]]

æœ‰æ®å¯æŸ¥çš„æ•°æ®é›†æ›´æœ‰å¯èƒ½å¯¹å…¶ä»–äººï¼ˆåŒ…æ‹¬ä½ æœªæ¥çš„è‡ªå·±ï¼ï¼‰æœ‰ç”¨ï¼Œå› ä¸ºå®ƒä»¬æä¾›äº†æ•°æ®é›†ç›¸å…³çš„ä¿¡æ¯ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå†³å®šæ•°æ®é›†æ˜¯å¦ä¸ä»–ä»¬çš„ä»»åŠ¡ç›¸å…³ï¼Œå¹¶è¯„ä¼°ä»»ä½•æ½œåœ¨çš„åè§æˆ–ä¸ä½¿ç”¨ç›¸å…³çš„é£é™©ã€‚

åœ¨ Hugging Face Hub ä¸Šï¼Œæ­¤ä¿¡æ¯å­˜å‚¨åœ¨æ¯ä¸ªæ•°æ®é›†ä»“åº“çš„è‡ªè¿°æ–‡ä»¶ï¼ˆ`README.md`ï¼‰ã€‚åœ¨åˆ›å»ºæ­¤æ–‡ä»¶ä¹‹å‰ï¼Œä½ åº”è¯¥é‡‡å–ä¸¤ä¸ªä¸»è¦æ­¥éª¤ï¼š

1. ä½¿ç”¨ [`datasets-tagging`åº”ç”¨ç¨‹åº](https://huggingface.co/datasets/tagging/) åˆ›å»º YAML æ ¼å¼çš„å…ƒæ•°æ®æ ‡ç­¾ã€‚è¿™äº›æ ‡ç­¾ç”¨äº Hugging Face Hub ä¸Šçš„å„ç§æœç´¢åŠŸèƒ½ï¼Œå¹¶ç¡®ä¿ä½ çš„æ•°æ®é›†å¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«ç¤¾åŒºæˆå‘˜æ‰¾åˆ°ã€‚ç”±äºæˆ‘ä»¬å·²ç»åœ¨è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰æ•°æ®é›†ï¼Œæ‰€ä»¥ä½ éœ€è¦å…‹éš†æ•°æ®é›†æ ‡ç­¾ä»“åº“( `datasets-tagging` )å¹¶åœ¨æœ¬åœ°è¿è¡Œåº”ç”¨ç¨‹åºã€‚å®ƒçš„ç•Œé¢æ˜¯è¿™æ ·çš„ï¼š

<div class="flex justify-center">
<img src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter5/datasets-tagger.png" alt=" datasets-tagger interface." width="80%"/>
</div>

2ï¼é˜…è¯» [ğŸ¤— Datasets æŒ‡å—](https://github.com/huggingface/datasets/blob/master/templates/README_guide.md) ä¸­å…³äºåˆ›å»ºå®Œå–„çš„æ•°æ®é›†å¡ç‰‡çš„æŒ‡å—ï¼Œå¹¶å°†å…¶ä½œä¸ºæ¨¡æ¿ä½¿ç”¨ã€‚

ä½ å¯ä»¥ç›´æ¥åœ¨ Hub ä¸Šåˆ›å»º README.md æ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨ `lewtun/github-issues` æ•°æ®é›†ä»“åº“ä¸­æ‰¾åˆ°ä¸€ä¸ªæ¨¡æ¿æ•°æ®é›†å¡ç‰‡ã€‚ä¸‹é¢æ˜¾ç¤ºäº†å¡«å†™å¥½çš„æ•°æ®é›†å¡ç‰‡çš„æˆªå›¾ã€‚

<div class="flex justify-center">
<img src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter5/dataset-card.png" alt="A dataset card." width="80%"/>
</div>

<Tip>

âœï¸**è¯•è¯•çœ‹ï¼**ä½¿ç”¨ `dataset-tagging` åº”ç”¨ç¨‹åºå’Œ [ğŸ¤— Datasets æŒ‡å—](https://github.com/huggingface/datasets/blob/master/templates/README_guide.md) æŒ‡å—æ¥å®Œæˆ GitHub issue æ•°æ®é›†çš„ README.md æ–‡ä»¶ã€‚

</Tip>

å¾ˆå¥½ï¼æˆ‘ä»¬åœ¨æœ¬èŠ‚ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºä¸€ä¸ªå¥½çš„æ•°æ®é›†å¯èƒ½æ¶‰åŠç›¸å½“å¤šçš„å·¥ä½œï¼Œä½†å¹¸è¿çš„æ˜¯ï¼Œå°†å…¶ä¸Šä¼ å¹¶ä¸ç¤¾åŒºå…±äº«ä¼šå¾ˆå®¹æ˜“å®ç°ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æˆ‘ä»¬çš„æ–°æ•°æ®é›†åˆ›å»ºä¸€ä¸ª ğŸ¤— Datasets çš„è¯­ä¹‰æœç´¢å¼•æ“ï¼Œè¯¥å¼•æ“å¯ä»¥å°†è¾“å…¥åŒ¹é…åˆ°æœ€ç›¸å…³çš„ issue å’Œè¯„è®ºã€‚

<Tip>

âœï¸ **è¯•è¯•çœ‹ï¼**æŒ‰ç…§æˆ‘ä»¬åœ¨æœ¬èŠ‚ä¸­é‡‡å–çš„æ­¥éª¤ä¸ºä½ æœ€å–œæ¬¢çš„å¼€æºåº“åˆ›å»ºä¸€ä¸ª GitHub issue æ•°æ®é›†ï¼ˆå½“ç„¶æ˜¯é™¤äº† ğŸ¤— Datasetsï¼‰ã€‚è¿›é˜¶çš„æŒ‘æˆ˜ï¼šå¾®è°ƒå¤šæ ‡ç­¾åˆ†ç±»å™¨ä»¥é¢„æµ‹åœ¨ `labels` å­—æ®µä¸­å‡ºç°çš„æ ‡ç­¾ã€‚
</Tip>

