# äº†è§£æ¥å£ç±»

<DocNotebookDropdown
  classNames="absolute z-10 right-0 top-0"
  options={[
    {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/chapter9/section3.ipynb"},
    {label: "Aws Studio", value: "https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/chapter9/section3.ipynb"},
]} />

åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»”ç»†ç ”ç©¶ `Interface` ç±»ï¼Œå¹¶äº†è§£ç”¨äºåˆ›å»ºå…¶çš„ä¸»è¦å‚æ•°ã€‚

## å¦‚ä½•åˆ›å»ºæ¥å£

æ‚¨ä¼šæ³¨æ„åˆ° `Interface` ç±»æœ‰ 3 ä¸ªå¿…éœ€å‚æ•°ï¼š

`Interface(fn, inputs, outputs, ...)`

è¿™äº›å‚æ•°æ˜¯ï¼š

  - `fn`: ç”± Gradio æ¥å£åŒ…è£…çš„é¢„æµ‹å‡½æ•°ã€‚ è¯¥å‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°å¹¶è¿”å›ä¸€ä¸ªæˆ–å¤šä¸ªå€¼
  - `inputs`: è¾“å…¥ç»„ä»¶ç±»å‹ã€‚ Gradio æä¾›äº†è®¸å¤šé¢„æ„å»ºçš„ç»„ä»¶ï¼Œä¾‹å¦‚`"image"` æˆ–`"mic"`ã€‚
  - `outputs`: è¾“å‡ºç»„ä»¶ç±»å‹ã€‚ åŒæ ·ï¼ŒGradio æä¾›äº†è®¸å¤šé¢„æ„å»ºçš„ç»„ä»¶ï¼Œä¾‹å¦‚ `â€œå›¾åƒâ€`æˆ–â€œæ ‡ç­¾â€`ã€‚

æœ‰å…³ç»„ä»¶çš„å®Œæ•´åˆ—è¡¨ï¼Œ[è¯·å‚é˜… Gradio æ–‡æ¡£](https://gradio.app/docs)ã€‚ æ¯ä¸ªé¢„æ„å»ºçš„ç»„ä»¶éƒ½å¯ä»¥é€šè¿‡å®ä¾‹åŒ–è¯¥ç»„ä»¶å¯¹åº”çš„ç±»æ¥å®šåˆ¶ã€‚

ä¾‹å¦‚ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨ [ä¸Šä¸€èŠ‚](/course/chapter9/2) ä¸­çœ‹åˆ°çš„ï¼Œæ‚¨å¯ä»¥ä¼ å…¥ä¸€ä¸ª `Textbox(lines=7, label="Prompt")` ç»„ä»¶æ¥åˆ›å»ºä¸€ä¸ªåŒ…å« 7 è¡Œå’Œä¸€ä¸ªæ ‡ç­¾çš„æ–‡æœ¬æ¡†ï¼Œè€Œä¸æ˜¯å°† `"textbox"` ä¼ é€’ç»™ `inputs` å‚æ•°ã€‚
è®©æˆ‘ä»¬çœ‹å¦ä¸€ä¸ªä¾‹å­ï¼Œè¿™æ¬¡æ˜¯ä¸€ä¸ª `Audio` ç»„ä»¶ã€‚

## ä¸€ä¸ªå¸¦éŸ³é¢‘çš„ç®€å•ç¤ºä¾‹

å¦‚å‰æ‰€è¿°ï¼ŒGradio æä¾›äº†è®¸å¤šä¸åŒçš„è¾“å…¥å’Œè¾“å‡ºã€‚
å› æ­¤ï¼Œè®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªé€‚ç”¨äºéŸ³é¢‘çš„â€œæ¥å£â€ã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªéŸ³é¢‘åˆ°éŸ³é¢‘çš„å‡½æ•°ï¼Œå®ƒéœ€è¦ä¸€ä¸ªéŸ³é¢‘æ–‡ä»¶å¹¶ç®€å•åœ°åè½¬å®ƒã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ `Audio` ç»„ä»¶ä½œä¸ºè¾“å…¥ã€‚ ä½¿ç”¨ `Audio` ç»„ä»¶æ—¶ï¼Œæ‚¨å¯ä»¥æŒ‡å®šå¸Œæœ›éŸ³é¢‘çš„ `source` æ˜¯ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶è¿˜æ˜¯ç”¨æˆ·å½•åˆ¶å£°éŸ³çš„éº¦å…‹é£ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®©æˆ‘ä»¬å°†å…¶è®¾ç½®ä¸ºâ€œéº¦å…‹é£â€ã€‚ åªæ˜¯ä¸ºäº†å¥½ç©ï¼Œæˆ‘ä»¬ä¼šåœ¨æˆ‘ä»¬çš„â€œéŸ³é¢‘â€ä¸­æ·»åŠ ä¸€ä¸ªæ ‡ç­¾ï¼Œä¸Šé¢å†™ç€â€œåœ¨è¿™é‡Œè¯´è¯â€¦â€¦â€ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬å¸Œæœ›å°†éŸ³é¢‘ä½œä¸º numpy æ•°ç»„æ¥æ”¶ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°â€œåè½¬â€å®ƒã€‚ æ‰€ä»¥æˆ‘ä»¬å°† `"type"` è®¾ç½®ä¸º `"numpy"`ï¼Œå®ƒä¼šä¼ é€’è¾“å…¥data ä½œä¸º (`sample_rate`, `data`) çš„å…ƒç»„è¿›å…¥æˆ‘ä»¬çš„å‡½æ•°ã€‚

æˆ‘ä»¬è¿˜å°†ä½¿ç”¨ `Audio` è¾“å‡ºç»„ä»¶ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨å°†å…·æœ‰é‡‡æ ·ç‡å’Œ numpy æ•°æ®æ•°ç»„çš„å…ƒç»„æ¸²æŸ“ä¸ºå¯æ’­æ”¾çš„éŸ³é¢‘æ–‡ä»¶ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿›è¡Œä»»ä½•è‡ªå®šä¹‰ï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨å­—ç¬¦ä¸²å¿«æ·æ–¹å¼â€œaudioâ€ã€‚


```py
import numpy as np
import gradio as gr


def reverse_audio(audio):
    sr, data = audio
    reversed_audio = (sr, np.flipud(data))
    return reversed_audio


mic = gr.Audio(source="microphone", type="numpy", label="Speak here...")
gr.Interface(reverse_audio, mic, "audio").launch()
```

ä¸Šé¢çš„ä»£ç ä¼šäº§ç”Ÿä¸€ä¸ªç±»ä¼¼ä¸‹é¢çš„ç•Œé¢ï¼ˆå¦‚æœä½ çš„æµè§ˆå™¨æ²¡æœ‰
è¯¢é—®æ‚¨çš„éº¦å…‹é£æƒé™ï¼Œ <a href="https://huggingface.co/spaces/course-demos/audio-reverse" target="_blank">open the demo in  a separate tab</a>.)

<iframe src="https://course-demos-audio-reverse.hf.space" frameBorder="0" height="250" title="Gradio app" class="container p-0 flex-grow space-iframe" allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>

æ‚¨ç°åœ¨åº”è¯¥èƒ½å¤Ÿå½•åˆ¶è‡ªå·±çš„å£°éŸ³å¹¶å¬åˆ°è‡ªå·±åœ¨åå‘è¯´è¯ - æ€ªå¼‚ ğŸ‘»!

## å¤„ç†å¤šä¸ªè¾“å…¥å’Œè¾“å‡º

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ›´å¤æ‚çš„å‡½æ•°ï¼Œæœ‰å¤šä¸ªè¾“å…¥å’Œè¾“å‡ºã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ¥å—ä¸‹æ‹‰ç´¢å¼•ã€æ»‘å—å€¼å’Œæ•°å­—çš„å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªéŸ³è°ƒçš„éŸ³é¢‘æ ·æœ¬ã€‚

çœ‹çœ‹æˆ‘ä»¬å¦‚ä½•ä¼ é€’è¾“å…¥å’Œè¾“å‡ºç»„ä»¶åˆ—è¡¨ï¼Œçœ‹çœ‹ä½ èƒ½ä¸èƒ½è·Ÿä¸Šæ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚

è¿™é‡Œçš„å…³é”®æ˜¯å½“ä½ é€šè¿‡æ—¶ï¼š
* è¾“å…¥ç»„ä»¶åˆ—è¡¨ï¼Œæ¯ä¸ªç»„ä»¶ä¾æ¬¡å¯¹åº”ä¸€ä¸ªå‚æ•°ã€‚
* è¾“å‡ºç»„ä»¶åˆ—è¡¨ï¼Œæ¯ä¸ªç»„ä»¶å¯¹åº”ä¸€ä¸ªè¿”å›å€¼ã€‚

ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ˜¾ç¤ºäº†ä¸‰ä¸ªè¾“å…¥ç»„ä»¶å¦‚ä½•ä¸ `generate_tone()` å‡½æ•°çš„ä¸‰ä¸ªå‚æ•°å¯¹é½ï¼š

```py
import numpy as np
import gradio as gr

notes = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"]


def generate_tone(note, octave, duration):
    sr = 48000
    a4_freq, tones_from_a4 = 440, 12 * (octave - 4) + (note - 9)
    frequency = a4_freq * 2 ** (tones_from_a4 / 12)
    duration = int(duration)
    audio = np.linspace(0, duration, duration * sr)
    audio = (20000 * np.sin(audio * (2 * np.pi * frequency))).astype(np.int16)
    return (sr, audio)


gr.Interface(
    generate_tone,
    [
        gr.Dropdown(notes, type="index"),
        gr.Slider(minimum=4, maximum=6, step=1),
        gr.Textbox(type="number", value=1, label="Duration in seconds"),
    ],
    "audio",
).launch()
```

<iframe src="https://course-demos-generate-tone.hf.space" frameBorder="0" height="450" title="Gradio app" class="container p-0 flex-grow space-iframe" allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>


### `launch()` æ–¹æ³•

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨äº†`launch()`æ–¹æ³•æ¥å¯åŠ¨ç•Œé¢ï¼Œä½†æ˜¯æˆ‘ä»¬
è¿˜æ²¡æœ‰çœŸæ­£è®¨è®ºè¿‡å®ƒçš„ä½œç”¨ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`launch()` æ–¹æ³•å°†åœ¨ Web æœåŠ¡å™¨ä¸­å¯åŠ¨æ¼”ç¤ºæ­£åœ¨æœ¬åœ°è¿è¡Œã€‚ å¦‚æœæ‚¨åœ¨ Jupyter æˆ– Colab ç¬”è®°æœ¬ä¸­è¿è¡Œä»£ç ï¼Œé‚£ä¹ˆGradio ä¼šå°†æ¼”ç¤º GUI åµŒå…¥åˆ°ç¬”è®°æœ¬ä¸­ï¼Œä»¥ä¾¿æ‚¨è½»æ¾ä½¿ç”¨å®ƒã€‚

æ‚¨å¯ä»¥é€šè¿‡ä¸åŒçš„å‚æ•°è‡ªå®šä¹‰ `launch()` çš„è¡Œä¸ºï¼š

  - `inline` - whether to display the interface inline on Python notebooks.
  - `inbrowser` - whether to automatically launch the interface in a new tab on the default browser.
  - `share` - whether to create a publicly shareable link from your computer for the interface. Kind of like a Google Drive link!

æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­æ›´è¯¦ç»†åœ°ä»‹ç» `share` å‚æ•°ï¼

## âœï¸ è®©æˆ‘ä»¬åº”ç”¨å®ƒï¼

è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç•Œé¢ï¼Œè®©æ‚¨æ¼”ç¤º **speech-recognition** æ¨¡å‹ã€‚
ä¸ºäº†è®©å®ƒå˜å¾—æœ‰è¶£ï¼Œæˆ‘ä»¬å°†æ¥å— *or* éº¦å…‹é£è¾“å…¥æˆ–ä¸Šä¼ çš„æ–‡ä»¶ã€‚

åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ ğŸ¤— Transformers ä¸­çš„ `pipeline()` å‡½æ•°åŠ è½½æˆ‘ä»¬çš„è¯­éŸ³è¯†åˆ«æ¨¡å‹ã€‚å¦‚æœæ‚¨éœ€è¦å¿«é€Ÿå¤ä¹ ï¼Œæ‚¨å¯ä»¥è¿”å› [ç¬¬ 1 ç« ä¸­çš„é‚£ä¸ªéƒ¨åˆ†](/course/chapter1/3)ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å®ç°ä¸€ä¸ª `transcribe_audio()` å‡½æ•°æ¥å¤„ç†éŸ³é¢‘å¹¶è¿”å›è½¬å½•ã€‚ æœ€åï¼Œæˆ‘ä»¬å°†æŠŠè¿™ä¸ªå‡½æ•°åŒ…è£…åœ¨ä¸€ä¸ª `Interface` ä¸­ï¼Œå…¶ä¸­ `Audio` ç»„ä»¶ç”¨äºè¾“å…¥ï¼Œåªæœ‰æ–‡æœ¬ç”¨äºè¾“å‡ºã€‚ æ€»è€Œè¨€ä¹‹ï¼Œæ­¤åº”ç”¨ç¨‹åºçš„ä»£ç å¦‚ä¸‹ï¼š

```py
from transformers import pipeline
import gradio as gr

model = pipeline("automatic-speech-recognition")


def transcribe_audio(mic=None, file=None):
    if mic is not None:
        audio = mic
    elif file is not None:
        audio = file
    else:
        return "You must either provide a mic recording or a file"
    transcription = model(audio)["text"]
    return transcription


gr.Interface(
    fn=transcribe_audio,
    inputs=[
        gr.Audio(source="microphone", type="filepath", optional=True),
        gr.Audio(source="upload", type="filepath", optional=True),
    ],
    outputs="text",
).launch()
```

å¦‚æœæ‚¨çš„æµè§ˆå™¨æ²¡æœ‰è¦æ±‚æ‚¨æä¾›éº¦å…‹é£æƒé™ï¼Œ<a href="https://huggingface.co/spaces/course-demos/audio-reverse" target="_blank">open the demo in a separate tab</a>.

<iframe src="https://course-demos-asr.hf.space" frameBorder="0" height="550" title="Gradio app" class="container p-0 flex-grow space-iframe" allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>


å°±æ˜¯è¿™æ ·ï¼ æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨æ­¤ç•Œé¢æ¥è½¬å½•éŸ³é¢‘ã€‚ æ³¨æ„è¿™é‡Œ
é€šè¿‡å°† `optional` å‚æ•°ä½œä¸º `True` ä¼ é€’ï¼Œæˆ‘ä»¬å…è®¸ç”¨æˆ·
æä¾›éº¦å…‹é£æˆ–éŸ³é¢‘æ–‡ä»¶ï¼ˆæˆ–ä¸¤è€…éƒ½ä¸æä¾›ï¼Œä½†è¿™ä¼šè¿”å›é”™è¯¯æ¶ˆæ¯ï¼‰ã€‚

ç»§ç»­çœ‹çœ‹å¦‚ä½•ä¸ä»–äººåˆ†äº«æ‚¨çš„ç•Œé¢ï¼