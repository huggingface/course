<FrameworkSwitchCourse {fw} />

# –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã[[question-answering]]

{#if fw === 'pt'}

<CourseFloatingBanner chapter={7}
  classNames="absolute z-10 right-0 top-0"
  notebooks={[
    {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/en/chapter7/section7_pt.ipynb"},
    {label: "Aws Studio", value: "https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/en/chapter7/section7_pt.ipynb"},
]} />

{:else}

<CourseFloatingBanner chapter={7}
  classNames="absolute z-10 right-0 top-0"
  notebooks={[
    {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/en/chapter7/section7_tf.ipynb"},
    {label: "Aws Studio", value: "https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/en/chapter7/section7_tf.ipynb"},
]} />

{/if}

–ü—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –≤–∑–≥–ª—è–Ω—É—Ç—å –Ω–∞ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã! –≠—Ç–∞ –∑–∞–¥–∞—á–∞ –∏–º–µ–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–∞–∑–Ω–æ–≤–∏–¥–Ω–æ—Å—Ç–µ–π, –Ω–æ —Ç–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –º—ã —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏–º—Å—è –≤ —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ, –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è *—ç–∫—Å—Ç—Ä–∞–∫—Ç–∏–≤–Ω—ã–º* –æ—Ç–≤–µ—Ç–æ–º –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã. –û–Ω–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –ø–æ—Å—Ç–∞–Ω–æ–≤–∫—É –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –¥–æ–∫—É–º–µ–Ω—Ç–µ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –≤ –≤–∏–¥–µ _—É—á–∞—Å—Ç–∫–æ–≤ —Ç–µ–∫—Å—Ç–∞_ –≤ —Å–∞–º–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ.

<Youtube id="ajPx5LwJD-I"/>

–ú—ã –ø—Ä–æ–≤–µ–¥–µ–º –¥–æ–æ–±—É—á–µ–Ω–∏–µ BERT-–º–æ–¥–µ–ª–∏ –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ [SQuAD](https://rajpurkar.github.io/SQuAD-explorer/), —Å–æ—Å—Ç–æ—è—â–µ–º –∏–∑ –≤–æ–ø—Ä–æ—Å–æ–≤, –∑–∞–¥–∞–Ω–Ω—ã—Ö –∫—Ä–∞—É–¥–≤–æ—Ä–∫–µ—Ä–∞–º–∏ –ø–æ –Ω–∞–±–æ—Ä—É —Å—Ç–∞—Ç–µ–π –í–∏–∫–∏–ø–µ–¥–∏–∏. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –º—ã –ø–æ–ª—É—á–∏–º –º–æ–¥–µ–ª—å, —Å–ø–æ—Å–æ–±–Ω—É—é –≤—ã—á–∏—Å–ª—è—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã, –ø–æ–¥–æ–±–Ω—ã–µ —ç—Ç–æ–º—É:

<iframe src="https://course-demos-bert-finetuned-squad.hf.space" frameBorder="0" height="450" title="Gradio app" class="block dark:hidden container p-0 flex-grow space-iframe" allow="accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"></iframe>

–ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —ç—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –æ–±—É—á–µ–Ω–∞ –∏ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –Ω–∞ Hub —Å –ø–æ–º–æ—â—å—é –∫–æ–¥–∞, –ø–æ–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤ —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ. –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –µ–µ –∏ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã [–∑–¥–µ—Å—å](https://huggingface.co/huggingface-course/bert-finetuned-squad?context=%F0%9F%A4%97+Transformers+is+backed+by+the+three+most+popular+deep+learning+libraries+%E2%80%94+Jax%2C+PyTorch+and+TensorFlow+%E2%80%94+with+a+seamless+integration+between+them.+It%27s+straightforward+to+train+your+models+with+one+before+loading+them+for+inference+with+the+other.&question=Which+deep+learning+libraries+back+%F0%9F%A4%97+Transformers%3F).

<Tip>

üí° –ú–æ–¥–µ–ª–∏, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –Ω–∞ —ç–Ω–∫–æ–¥–µ—Ä–µ, —Ç–∞–∫–∏–µ –∫–∞–∫ BERT, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –æ—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —Ñ–∞–∫—Ç–æ–∏–¥–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Ç–∏–ø–∞ "–ö—Ç–æ –∏–∑–æ–±—Ä–µ–ª –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–∞?", –Ω–æ –ø–ª–æ—Ö–æ —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ —Ç–∏–ø–∞ "–ü–æ—á–µ–º—É –Ω–µ–±–æ –≥–æ–ª—É–±–æ–µ?". –í —Ç–∞–∫–∏—Ö —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–æ–¥–µ–ª–∏ —ç–Ω–∫–æ–¥–µ—Ä–æ–≤-–¥–µ–∫–æ–¥–µ—Ä–æ–≤, —Ç–∞–∫–∏–µ –∫–∞–∫ T5 –∏ BART, —á—Ç–æ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–µ –Ω–∞ [—Å—É–º—Ä–∏–∑–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞](/course/chapter7/5). –ï—Å–ª–∏ –≤–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–µ–Ω —ç—Ç–æ—Ç —Ç–∏–ø *–≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω—ã—Ö* –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –Ω–∞—à–∏–º [–¥–µ–º–æ](https://yjernite.github.io/lfqa.html) –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–º –Ω–∞ [–¥–∞—Ç–∞—Å–µ—Ç–µ ELI5](https://huggingface.co/datasets/eli5).

</Tip>

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö[[preparing-the-data]]

–í –∫–∞—á–µ—Å—Ç–≤–µ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–æ–≥–æ –±–µ–Ω—á–º–∞—Ä–∫–∞ –¥–ª—è —ç–∫—Å—Ç—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã —á–∞—â–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∞—Ç–∞—Å–µ—Ç [SQuAD](https://rajpurkar.github.io/SQuAD-explorer/), –ø–æ—ç—Ç–æ–º—É –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–µ–Ω–Ω–æ –µ–≥–æ. –°—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–∞–∫–∂–µ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç [SQuAD v2](https://huggingface.co/datasets/squad_v2), –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã, –Ω–µ –∏–º–µ—é—â–∏–µ –æ—Ç–≤–µ—Ç–∞. –ï—Å–ª–∏ –≤–∞—à —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–æ–ª–±–µ—Ü –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤, —Å—Ç–æ–ª–±–µ—Ü –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ —Å—Ç–æ–ª–±–µ—Ü –æ—Ç–≤–µ—Ç–æ–≤, –≤—ã —Å–º–æ–∂–µ—Ç–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –Ω–∏–∂–µ —à–∞–≥–∏.

### –î–∞—Ç–∞—Å–µ—Ç SQuAD[[the-squad-dataset]]

–ö–∞–∫ –æ–±—ã—á–Ω–æ, –º—ã –º–æ–∂–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç–∞—Å–µ—Ç –≤—Å–µ–≥–æ –∑–∞ –æ–¥–∏–Ω —à–∞–≥ –±–ª–∞–≥–æ–¥–∞—Ä—è —Ñ—É–Ω–∫—Ü–∏–∏ `load_dataset()`:

```py
from datasets import load_dataset

raw_datasets = load_dataset("squad")
```

–ú—ã –º–æ–∂–µ–º –≤–∑–≥–ª—è–Ω—É—Ç—å –Ω–∞ —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ –¥–∞—Ç–∞—Å–µ—Ç–µ SQuAD:

```py
raw_datasets
```

```python out
DatasetDict({
    train: Dataset({
        features: ['id', 'title', 'context', 'question', 'answers'],
        num_rows: 87599
    })
    validation: Dataset({
        features: ['id', 'title', 'context', 'question', 'answers'],
        num_rows: 10570
    })
})
```

–ü–æ—Ö–æ–∂–µ, —É –Ω–∞—Å –µ—Å—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –≤ –ø–æ–ª—è—Ö `context`, `question` –∏ `answers`, —Ç–∞–∫ —á—Ç–æ –¥–∞–≤–∞–π—Ç–µ –≤—ã–≤–µ–¥–µ–º –∏—Ö –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –Ω–∞—à–µ–≥–æ –æ–±—É—á–∞—é—â–µ–≥–æ –Ω–∞–±–æ—Ä–∞:

```py
print("Context: ", raw_datasets["train"][0]["context"])
print("Question: ", raw_datasets["train"][0]["question"])
print("Answer: ", raw_datasets["train"][0]["answers"])
```

```python out
Context: 'Architecturally, the school has a Catholic character. Atop the Main Building\'s gold dome is a golden statue of the Virgin Mary. Immediately in front of the Main Building and facing it, is a copper statue of Christ with arms upraised with the legend "Venite Ad Me Omnes". Next to the Main Building is the Basilica of the Sacred Heart. Immediately behind the basilica is the Grotto, a Marian place of prayer and reflection. It is a replica of the grotto at Lourdes, France where the Virgin Mary reputedly appeared to Saint Bernadette Soubirous in 1858. At the end of the main drive (and in a direct line that connects through 3 statues and the Gold Dome), is a simple, modern stone statue of Mary.'
Question: 'To whom did the Virgin Mary allegedly appear in 1858 in Lourdes France?'
Answer: {'text': ['Saint Bernadette Soubirous'], 'answer_start': [515]}
```

–ü–æ–ª—è `context` –∏ `question` –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç—ã –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏. –° –ø–æ–ª–µ–º `answers` –Ω–µ–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–µ–µ, –ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–ª–æ–≤–∞—Ä—å —Å –¥–≤—É–º—è –ø–æ–ª—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–±–∞ —è–≤–ª—è—é—Ç—Å—è —Å–ø–∏—Å–∫–∞–º–∏. –ò–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –±—É–¥–µ—Ç –æ–∂–∏–¥–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∞ `squad` –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ; –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–∞–º –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å—Å—è –æ —Ç–æ–º, —á—Ç–æ–±—ã –ø—Ä–∏–≤–µ—Å—Ç–∏ –æ—Ç–≤–µ—Ç—ã –∫ —Ç–∞–∫–æ–º—É –∂–µ —Ñ–æ—Ä–º–∞—Ç—É. –ü–æ–ª–µ `text` –¥–æ–≤–æ–ª—å–Ω–æ –æ—á–µ–≤–∏–¥–Ω–æ, –∞ –ø–æ–ª–µ `answer_start` —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω–¥–µ–∫—Å –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ –∫–∞–∂–¥–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.

–í–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –≤–æ–∑–º–æ–∂–Ω—ã–π –æ—Ç–≤–µ—Ç. –ú—ã –º–æ–∂–µ–º –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ç–æ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `Dataset.filter()`:

```py
raw_datasets["train"].filter(lambda x: len(x["answers"]["text"]) != 1)
```

```python out
Dataset({
    features: ['id', 'title', 'context', 'question', 'answers'],
    num_rows: 0
})
```

–î–ª—è –æ—Ü–µ–Ω–∫–∏, –æ–¥–Ω–∞–∫–æ, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∏–ª–∏ —Ä–∞–∑–Ω—ã–º–∏:

```py
print(raw_datasets["validation"][0]["answers"])
print(raw_datasets["validation"][2]["answers"])
```

```python out
{'text': ['Denver Broncos', 'Denver Broncos', 'Denver Broncos'], 'answer_start': [177, 177, 177]}
{'text': ['Santa Clara, California', "Levi's Stadium", "Levi's Stadium in the San Francisco Bay Area at Santa Clara, California."], 'answer_start': [403, 355, 355]}
```

–ú—ã –Ω–µ –±—É–¥–µ–º —É–≥–ª—É–±–ª—è—Ç—å—Å—è –≤ —Å—Ü–µ–Ω–∞—Ä–∏–π –æ—Ü–µ–Ω–∫–∏, –ø–æ—Å–∫–æ–ª—å–∫—É –≤—Å–µ —ç—Ç–æ –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä–Ω—É—Ç–æ –≤ –º–µ—Ç—Ä–∏–∫—É ü§ó Datasets –¥–ª—è –Ω–∞—Å, –Ω–æ –∫—Ä–∞—Ç–∫–æ —Å—É—Ç—å –≤ —Ç–æ–º, —á—Ç–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏–º–µ—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤, –∏ —ç—Ç–æ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –±—É–¥–µ—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Å–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–æ –≤—Å–µ–º–∏ –¥–æ–ø—É—Å—Ç–∏–º—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏ –∏ –≤—ã–±–∏—Ä–∞—Ç—å –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ï—Å–ª–∏ –º—ã –ø–æ—Å–º–æ—Ç—Ä–∏–º, –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –≤—ã–±–æ—Ä–∫—É —Å –∏–Ω–¥–µ–∫—Å–æ–º 2:

```py
print(raw_datasets["validation"][2]["context"])
print(raw_datasets["validation"][2]["question"])
```

```python out
'Super Bowl 50 was an American football game to determine the champion of the National Football League (NFL) for the 2015 season. The American Football Conference (AFC) champion Denver Broncos defeated the National Football Conference (NFC) champion Carolina Panthers 24‚Äì10 to earn their third Super Bowl title. The game was played on February 7, 2016, at Levi\'s Stadium in the San Francisco Bay Area at Santa Clara, California. As this was the 50th Super Bowl, the league emphasized the "golden anniversary" with various gold-themed initiatives, as well as temporarily suspending the tradition of naming each Super Bowl game with Roman numerals (under which the game would have been known as "Super Bowl L"), so that the logo could prominently feature the Arabic numerals 50.'
'Where did Super Bowl 50 take place?'
```

–º—ã –º–æ–∂–µ–º —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ –æ—Ç–≤–µ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–¥–Ω–∏–º –∏–∑ —Ç—Ä–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –≤–∏–¥–µ–ª–∏ —Ä–∞–Ω–µ–µ.

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö[[processing-the-training-data]]

<Youtube id="qgaM0weJHpA"/>

–ù–∞—á–Ω–µ–º —Å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –°–∞–º–æ–µ —Å–ª–æ–∂–Ω–æ–µ - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–∫–∏ –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å —Å–æ–±–æ–π –Ω–∞—á–∞–ª—å–Ω—É—é –∏ –∫–æ–Ω–µ—á–Ω—É—é –ø–æ–∑–∏—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –æ—Ç–≤–µ—Ç—É –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.

–ù–æ –Ω–µ –±—É–¥–µ–º –∑–∞–±–µ–≥–∞—Ç—å –≤–ø–µ—Ä–µ–¥. –°–Ω–∞—á–∞–ª–∞ –Ω–∞–º –Ω—É–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –≤–æ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥–µ–ª—å —Å–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä:

```py
from transformers import AutoTokenizer

model_checkpoint = "bert-base-cased"
tokenizer = AutoTokenizer.from_pretrained(model_checkpoint)
```

–ö–∞–∫ —É–ø–æ–º–∏–Ω–∞–ª–æ—Å—å —Ä–∞–Ω–µ–µ, –º—ã –±—É–¥–µ–º –ø—Ä–æ–≤–æ–¥–∏—Ç—å –¥–æ–æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ BERT, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Ç–∏–ø –º–æ–¥–µ–ª–∏, –µ—Å–ª–∏ –≤ –Ω–µ–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –±—ã—Å—Ç—Ä—ã–π —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä. –í—ã –º–æ–∂–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å –≤—Å–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å –±—ã—Å—Ç—Ä–æ–π –≤–µ—Ä—Å–∏–µ–π –≤ [—ç—Ç–æ–π –±–æ–ª—å—à–æ–π —Ç–∞–±–ª–∏—Ü–µ](https://huggingface.co/transformers/#supported-frameworks), –∞ —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤–∞–º–∏ –æ–±—ä–µ–∫—Ç `tokenizer` –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è ü§ó Tokenizers, –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –µ–≥–æ –∞—Ç—Ä–∏–±—É—Ç `is_fast`:

```py
tokenizer.is_fast
```

```python out
True
```

–ú—ã –º–æ–∂–µ–º –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–∞—à–µ–º—É —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä—É –≤–æ–ø—Ä–æ—Å –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–µ, –∏ –æ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã, —á—Ç–æ–±—ã —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –ø–æ–¥–æ–±–Ω–æ–µ —ç—Ç–æ–º—É:

```
[CLS] question [SEP] context [SEP]
```

–î–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∏–º:

```py
context = raw_datasets["train"][0]["context"]
question = raw_datasets["train"][0]["question"]

inputs = tokenizer(question, context)
tokenizer.decode(inputs["input_ids"])
```

```python out
'[CLS] To whom did the Virgin Mary allegedly appear in 1858 in Lourdes France? [SEP] Architecturally, '
'the school has a Catholic character. Atop the Main Building\'s gold dome is a golden statue of the Virgin '
'Mary. Immediately in front of the Main Building and facing it, is a copper statue of Christ with arms '
'upraised with the legend " Venite Ad Me Omnes ". Next to the Main Building is the Basilica of the Sacred '
'Heart. Immediately behind the basilica is the Grotto, a Marian place of prayer and reflection. It is a '
'replica of the grotto at Lourdes, France where the Virgin Mary reputedly appeared to Saint Bernadette '
'Soubirous in 1858. At the end of the main drive ( and in a direct line that connects through 3 statues '
'and the Gold Dome ), is a simple, modern stone statue of Mary. [SEP]'
```

–í –∫–∞—á–µ—Å—Ç–≤–µ –º–µ—Ç–æ–∫ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏–Ω–¥–µ–∫—Å—ã —Ç–æ–∫–µ–Ω–æ–≤, –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏—Ö –æ—Ç–≤–µ—Ç, –∞ –∑–∞–¥–∞—á–∞ –º–æ–¥–µ–ª–∏ - –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –æ–¥–∏–Ω –Ω–∞—á–∞–ª—å–Ω—ã–π –∏ –∫–æ–Ω–µ—á–Ω—ã–π –ª–æ–≥–∏—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –≤—Ö–æ–¥–µ, –ø—Ä–∏ —ç—Ç–æ–º —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–∫–∏ –±—É–¥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

<div class="flex justify-center">
<img class="block dark:hidden" src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/qa_labels.svg" alt="One-hot encoded labels for question answering."/>
<img class="hidden dark:block" src="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/qa_labels-dark.svg" alt="One-hot encoded labels for question answering."/>
</div>

–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–º–µ—Ä—ã –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ –∏–º–µ—é—Ç –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–≤—ã—Å—è—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—É—é –Ω–∞–º–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É (–∫–æ—Ç–æ—Ä–∞—è –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —Ä–∞–≤–Ω–∞ 384). –ö–∞–∫ –º—ã –≤–∏–¥–µ–ª–∏ –≤ [–ì–ª–∞–≤–µ 6](../chapter6/4), –∫–æ–≥–¥–∞ –∏–∑—É—á–∞–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∫–æ–Ω–≤–µ–π–µ—Ä–∞ `question-answering`, –º—ã –±—É–¥–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–ª–∏–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏, —Å–æ–∑–¥–∞–≤–∞—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—É—á–∞—é—â–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏–∑ –æ–¥–Ω–æ–π –≤—ã–±–æ—Ä–∫–∏ –Ω–∞—à–µ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞, —Å–æ —Å–∫–æ–ª—å–∑—è—â–∏–º –æ–∫–Ω–æ–º –º–µ–∂–¥—É –Ω–∏–º–∏.

–ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ç–µ–∫—É—â–µ–º –ø—Ä–∏–º–µ—Ä–µ, –º—ã –º–æ–∂–µ–º –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–ª–∏–Ω—É –¥–æ 100 –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫–æ–ª—å–∑—è—â–µ–µ –æ–∫–Ω–æ –∏–∑ 50 —Ç–æ–∫–µ–Ω–æ–≤. –í –∫–∞—á–µ—Å—Ç–≤–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º:

- `max_length` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã (–∑–¥–µ—Å—å 100)
- `truncation="only_second"` –¥–ª—è —É—Å–µ—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–æ –≤—Ç–æ—Ä–æ–π –ø–æ–∑–∏—Ü–∏–∏), –∫–æ–≥–¥–∞ –≤–æ–ø—Ä–æ—Å —Å –µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π
- `stride` –¥–ª—è –∑–∞–¥–∞–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏—Ö—Å—è —Ç–æ–∫–µ–Ω–æ–≤ –º–µ–∂–¥—É –¥–≤—É–º—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞–º–∏ (–∑–¥–µ—Å—å 50)
- `return_overflowing_tokens=True`, —á—Ç–æ–±—ã —Å–æ–æ–±—â–∏—Ç—å —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä—É, —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω—ã –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã (overflowing tokens)

```py
inputs = tokenizer(
    question,
    context,
    max_length=100,
    truncation="only_second",
    stride=50,
    return_overflowing_tokens=True,
)

for ids in inputs["input_ids"]:
    print(tokenizer.decode(ids))
```

```python out
'[CLS] To whom did the Virgin Mary allegedly appear in 1858 in Lourdes France? [SEP] Architecturally, the school has a Catholic character. Atop the Main Building\'s gold dome is a golden statue of the Virgin Mary. Immediately in front of the Main Building and facing it, is a copper statue of Christ with arms upraised with the legend " Venite Ad Me Omnes ". Next to the Main Building is the Basilica of the Sacred Heart. Immediately behind the basi [SEP]'
'[CLS] To whom did the Virgin Mary allegedly appear in 1858 in Lourdes France? [SEP] the Main Building and facing it, is a copper statue of Christ with arms upraised with the legend " Venite Ad Me Omnes ". Next to the Main Building is the Basilica of the Sacred Heart. Immediately behind the basilica is the Grotto, a Marian place of prayer and reflection. It is a replica of the grotto at Lourdes, France where the Virgin [SEP]'
'[CLS] To whom did the Virgin Mary allegedly appear in 1858 in Lourdes France? [SEP] Next to the Main Building is the Basilica of the Sacred Heart. Immediately behind the basilica is the Grotto, a Marian place of prayer and reflection. It is a replica of the grotto at Lourdes, France where the Virgin Mary reputedly appeared to Saint Bernadette Soubirous in 1858. At the end of the main drive ( and in a direct line that connects through 3 [SEP]'
'[CLS] To whom did the Virgin Mary allegedly appear in 1858 in Lourdes France? [SEP]. It is a replica of the grotto at Lourdes, France where the Virgin Mary reputedly appeared to Saint Bernadette Soubirous in 1858. At the end of the main drive ( and in a direct line that connects through 3 statues and the Gold Dome ), is a simple, modern stone statue of Mary. [SEP]'
```

–ö–∞–∫ –º—ã –º–æ–∂–µ–º –≤–∏–¥–µ—Ç—å, –Ω–∞—à –ø—Ä–∏–º–µ—Ä –±—ã–ª —Ä–∞–∑–±–∏—Ç –Ω–∞ —á–µ—Ç—ã—Ä–µ –≤—Ö–æ–¥–∞, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–æ–ø—Ä–æ—Å –∏ —á–∞—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å ("Bernadette Soubirous") –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ç—Ä–µ—Ç—å–µ–º –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–º –≤—Ö–æ–¥–µ, –ø–æ—ç—Ç–æ–º—É, —Ä–∞–±–æ—Ç–∞—è —Å –¥–ª–∏–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏ —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º—ã —Å–æ–∑–¥–∞–¥–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—É—á–∞—é—â–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –æ—Ç–≤–µ—Ç –Ω–µ –±—É–¥–µ—Ç –≤–∫–ª—é—á–µ–Ω –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç. –î–ª—è —ç—Ç–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –º–µ—Ç–∫–∞–º–∏ –±—É–¥—É—Ç `start_position = end_position = 0` (—Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –º—ã –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–∫–µ–Ω `[CLS]`). –ú—ã —Ç–∞–∫–∂–µ –∑–∞–¥–∞–¥–∏–º —ç—Ç–∏ –º–µ—Ç–∫–∏ –≤ –Ω–µ—É–¥–∞—á–Ω–æ–º —Å–ª—É—á–∞–µ, –∫–æ–≥–¥–∞ –æ—Ç–≤–µ—Ç –±—ã–ª —É—Å–µ—á–µ–Ω, —Ç–∞–∫ —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –µ–≥–æ –Ω–∞—á–∞–ª–æ (–∏–ª–∏ –∫–æ–Ω–µ—Ü). –î–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤, –≥–¥–µ –æ—Ç–≤–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –º–µ—Ç–∫–∞–º–∏ –±—É–¥—É—Ç –∏–Ω–¥–µ–∫—Å —Ç–æ–∫–µ–Ω–∞, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –æ—Ç–≤–µ—Ç, –∏ –∏–Ω–¥–µ–∫—Å —Ç–æ–∫–µ–Ω–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –æ—Ç–≤–µ—Ç –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è.

–î–∞—Ç–∞—Å–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∞–º –Ω–∞—á–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª –æ—Ç–≤–µ—Ç–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –∞ –ø—Ä–∏–±–∞–≤–∏–≤ –∫ –Ω–µ–º—É –¥–ª–∏–Ω—É –æ—Ç–≤–µ—Ç–∞, –º—ã –º–æ–∂–µ–º –Ω–∞–π—Ç–∏ –∫–æ–Ω–µ—á–Ω—ã–π —Å–∏–º–≤–æ–ª –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ. –ß—Ç–æ–±—ã —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å –∏—Ö —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ —Ç–æ–∫–µ–Ω–æ–≤, –Ω–∞–º –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ—â–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä–æ–µ –º—ã –∏–∑—É—á–∞–ª–∏ –≤ [–ì–ª–∞–≤–µ 6](../chapter6/4). –ú—ã –º–æ–∂–µ–º –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞—à —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä –Ω–∞ –∏—Ö –≤–æ–∑–≤—Ä–∞—Ç, –ø–µ—Ä–µ–¥–∞–≤ `return_offsets_mapping=True`:

```py
inputs = tokenizer(
    question,
    context,
    max_length=100,
    truncation="only_second",
    stride=50,
    return_overflowing_tokens=True,
    return_offsets_mapping=True,
)
inputs.keys()
```

```python out
dict_keys(['input_ids', 'token_type_ids', 'attention_mask', 'offset_mapping', 'overflow_to_sample_mapping'])
```

–ö–∞–∫ –º—ã –≤–∏–¥–∏–º, –Ω–∞–º –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –æ–±—ã—á–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –≤—Ö–æ–¥–∞, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Ç–∏–ø–æ–≤ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –º–∞—Å–∫–∞ –≤–Ω–∏–º–∞–Ω–∏—è, –∞ —Ç–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –Ω–∞–º —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ—â–µ–Ω–∏–π –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–ª—é—á `overflow_to_sample_mapping`. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (—á—Ç–æ –º—ã –∏ –¥–æ–ª–∂–Ω—ã –¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã –∏–∑–≤–ª–µ—á—å –≤—ã–≥–æ–¥—É –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ –Ω–∞—à —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ Rust). –ü–æ—Å–∫–æ–ª—å–∫—É –æ–¥–∏–Ω –æ–±—Ä–∞–∑–µ—Ü –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, –æ–Ω —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–∞–∂–¥—ã–π –ø—Ä–∏–∑–Ω–∞–∫ —Å –ø—Ä–∏–º–µ—Ä–æ–º, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–Ω –ø—Ä–æ–∏–∑–æ—à–µ–ª. –ü–æ—Å–∫–æ–ª—å–∫—É –∑–¥–µ—Å—å –º—ã —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–∏ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–∏–º–µ—Ä, –º—ã –ø–æ–ª—É—á–∏–º —Å–ø–∏—Å–æ–∫ `0`:

```py
inputs["overflow_to_sample_mapping"]
```

```python out
[0, 0, 0, 0]
```

–ù–æ –µ—Å–ª–∏ –º—ã –ø—Ä–æ–≤–µ–¥–µ–º —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—é –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–∏–º–µ—Ä–æ–≤, —ç—Ç–æ —Å—Ç–∞–Ω–µ—Ç –±–æ–ª–µ–µ –ø–æ–ª–µ–∑–Ω—ã–º:

```py
inputs = tokenizer(
    raw_datasets["train"][2:6]["question"],
    raw_datasets["train"][2:6]["context"],
    max_length=100,
    truncation="only_second",
    stride=50,
    return_overflowing_tokens=True,
    return_offsets_mapping=True,
)

print(f"The 4 examples gave {len(inputs['input_ids'])} features.")
print(f"Here is where each comes from: {inputs['overflow_to_sample_mapping']}.")
```

```python out
'The 4 examples gave 19 features.'
'Here is where each comes from: [0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3].'
```

–ö–∞–∫ –º—ã –≤–∏–¥–∏–º, –ø–µ—Ä–≤—ã–µ —Ç—Ä–∏ –ø—Ä–∏–º–µ—Ä–∞ (—Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ 2, 3 –∏ 4 –≤ –æ–±—É—á–∞—é—â–µ–º –Ω–∞–±–æ—Ä–µ) –¥–∞–ª–∏ –ø–æ —á–µ—Ç—ã—Ä–µ –ø—Ä–∏–∑–Ω–∞–∫–∞, –∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–∏–º–µ—Ä (—Å –∏–Ω–¥–µ–∫—Å–æ–º 5 –≤ –æ–±—É—á–∞—é—â–µ–º –Ω–∞–±–æ—Ä–µ) - 7 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤.

–≠—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –ø–æ–ª–µ–∑–Ω–∞ –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –º–µ—Ç–∫–æ–π. –ö–∞–∫ —É–∂–µ —É–ø–æ–º–∏–Ω–∞–ª–æ—Å—å —Ä–∞–Ω–µ–µ, —ç—Ç–∏–º–∏ –º–µ—Ç–∫–∞–º–∏ —è–≤–ª—è—é—Ç—Å—è:

- `(0, 0)`, –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –æ–±–ª–∞—Å—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- `(start_position, end_position)`, –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –æ–±–ª–∞—Å—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –ø—Ä–∏—á–µ–º `start_position` - —ç—Ç–æ –∏–Ω–¥–µ–∫—Å —Ç–æ–∫–µ–Ω–∞ (–≤–æ –≤—Ö–æ–¥–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞—Ö) –≤ –Ω–∞—á–∞–ª–µ –æ—Ç–≤–µ—Ç–∞, –∞ `end_position` - –∏–Ω–¥–µ–∫—Å —Ç–æ–∫–µ–Ω–∞ (–≤–æ –≤—Ö–æ–¥–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞—Ö) –≤ –∫–æ–Ω—Ü–µ –æ—Ç–≤–µ—Ç–∞

–ß—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–æ–π –∏–∑ —ç—Ç–∏—Ö —Å–ª—É—á–∞–µ–≤ –∏–º–µ–µ—Ç –º–µ—Å—Ç–æ, –∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ, –ø–æ–∑–∏—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤, –º—ã —Å–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å—ã, —Å –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–æ –≤—Ö–æ–¥–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞—Ö. –î–ª—è —ç—Ç–æ–≥–æ –º—ã –º–æ–≥–ª–∏ –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Ç–∏–ø–æ–≤ —Ç–æ–∫–µ–Ω–æ–≤, –Ω–æ –ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω–∏ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, DistilBERT –∏—Ö –Ω–µ —Ç—Ä–µ–±—É–µ—Ç), –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –º—ã –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –º–µ—Ç–æ–¥–æ–º `sequence_ids()` –∏–∑ `BatchEncoding`, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞—à —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä. 

–ü–æ–ª—É—á–∏–≤ –∏–Ω–¥–µ–∫—Å—ã —Ç–æ–∫–µ–Ω–æ–≤, –º—ã —Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–º–µ—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å–æ–±–æ–π –∫–æ—Ä—Ç–µ–∂–∏ –∏–∑ –¥–≤—É—Ö —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª, –æ–±–æ–∑–Ω–∞—á–∞—é—â–∏—Ö –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ —Å–∏–º–≤–æ–ª–æ–≤ –≤–Ω—É—Ç—Ä–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º—ã –º–æ–∂–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ —ç—Ç–æ–º –ø—Ä–∏–∑–Ω–∞–∫–µ –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ –∏–ª–∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –¥–æ –Ω–∞—á–∞–ª–∞ –æ—Ç–≤–µ—Ç–∞ (–≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –º–µ—Ç–∫–∞ –±—É–¥–µ—Ç `(0, 0)`). –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ç–∞–∫, –º—ã –∑–∞—Ü–∏–∫–ª–∏–≤–∞–µ–º—Å—è, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –ø–µ—Ä–≤—ã–π –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–æ–∫–µ–Ω –æ—Ç–≤–µ—Ç–∞:

```py
answers = raw_datasets["train"][2:6]["answers"]
start_positions = []
end_positions = []

for i, offset in enumerate(inputs["offset_mapping"]):
    sample_idx = inputs["overflow_to_sample_mapping"][i]
    answer = answers[sample_idx]
    start_char = answer["answer_start"][0]
    end_char = answer["answer_start"][0] + len(answer["text"][0])
    sequence_ids = inputs.sequence_ids(i)

    # –ù–∞–π–¥—ë–º –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    idx = 0
    while sequence_ids[idx] != 1:
        idx += 1
    context_start = idx
    while sequence_ids[idx] == 1:
        idx += 1
    context_end = idx - 1

    # –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –º–µ—Ç–∫–æ–π –±—É–¥–µ—Ç (0, 0)
    if offset[context_start][0] > start_char or offset[context_end][1] < end_char:
        start_positions.append(0)
        end_positions.append(0)
    else:
        # –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ —ç—Ç–æ –Ω–∞—á–∞–ª—å–Ω–∞—è –∏ –∫–æ–Ω–µ—á–Ω–∞—è –ø–æ–∑–∏—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
        idx = context_start
        while idx <= context_end and offset[idx][0] <= start_char:
            idx += 1
        start_positions.append(idx - 1)

        idx = context_end
        while idx >= context_start and offset[idx][1] >= end_char:
            idx -= 1
        end_positions.append(idx + 1)

start_positions, end_positions
```

```python out
([83, 51, 19, 0, 0, 64, 27, 0, 34, 0, 0, 0, 67, 34, 0, 0, 0, 0, 0],
 [85, 53, 21, 0, 0, 70, 33, 0, 40, 0, 0, 0, 68, 35, 0, 0, 0, 0, 0])
```

–î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞—à–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞. –î–ª—è –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞ –º—ã –Ω–∞—Ö–æ–¥–∏–º `(83, 85)` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –º–µ—Ç–æ–∫, –ø–æ—ç—Ç–æ–º—É –¥–∞–≤–∞–π—Ç–µ —Å—Ä–∞–≤–Ω–∏–º —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç —Å –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –ª–µ–∫—Å–µ–º —Å 83 –ø–æ 85 (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ):

```py
idx = 0
sample_idx = inputs["overflow_to_sample_mapping"][idx]
answer = answers[sample_idx]["text"][0]

start = start_positions[idx]
end = end_positions[idx]
labeled_answer = tokenizer.decode(inputs["input_ids"][idx][start : end + 1])

print(f"Theoretical answer: {answer}, labels give: {labeled_answer}")
```

```python out
'Theoretical answer: the Main Building, labels give: the Main Building'
```

–ò—Ç–∞–∫, —ç—Ç–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ! –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä–∏–º –∏–Ω–¥–µ–∫—Å 4, –≥–¥–µ –º—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –º–µ—Ç–∫–∏ –Ω–∞ `(0, 0)`, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ—Ç–≤–µ—Ç –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —ç—Ç–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞:

```py
idx = 4
sample_idx = inputs["overflow_to_sample_mapping"][idx]
answer = answers[sample_idx]["text"][0]

decoded_example = tokenizer.decode(inputs["input_ids"][idx])
print(f"Theoretical answer: {answer}, decoded example: {decoded_example}")
```

```python out
'Theoretical answer: a Marian place of prayer and reflection, decoded example: [CLS] What is the Grotto at Notre Dame? [SEP] Architecturally, the school has a Catholic character. Atop the Main Building\'s gold dome is a golden statue of the Virgin Mary. Immediately in front of the Main Building and facing it, is a copper statue of Christ with arms upraised with the legend " Venite Ad Me Omnes ". Next to the Main Building is the Basilica of the Sacred Heart. Immediately behind the basilica is the Grot [SEP]'
```

–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ, –º—ã –Ω–µ –≤–∏–¥–∏–º –æ—Ç–≤–µ—Ç–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.

<Tip>

‚úèÔ∏è **–í–∞—à–∞ –æ—á–µ—Ä–µ–¥—å!** –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã XLNet –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Å–ª–µ–≤–∞, –∞ –≤–æ–ø—Ä–æ—Å –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –º–µ–Ω—è—é—Ç—Å—è –º–µ—Å—Ç–∞–º–∏. –ê–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–ª–∏, –∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ XLNet (–∏ –¥–æ–±–∞–≤—å—Ç–µ `padding=True`). –ò–º–µ–π—Ç–µ –≤ –≤–∏–¥—É, —á—Ç–æ —Ç–æ–∫–µ–Ω `[CLS]` –º–æ–∂–µ—Ç –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –ø–æ–∑–∏—Ü–∏–∏ 0 –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è.

</Tip>

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –º—ã —à–∞–≥ –∑–∞ —à–∞–≥–æ–º —Ä–∞–∑–æ–±—Ä–∞–ª–∏—Å—å —Å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –º—ã –º–æ–∂–µ–º —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –±—É–¥–µ–º –ø—Ä–∏–º–µ–Ω—è—Ç—å –∫–æ –≤—Å–µ–º—É –¥–∞—Ç–∞—Å–µ—Ç—É. –ú—ã –¥–æ–ø–æ–ª–Ω–∏–º –∫–∞–∂–¥—ã–π –ø—Ä–∏–∑–Ω–∞–∫ –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã, –∫–æ—Ç–æ—Ä—É—é –º—ã –∑–∞–¥–∞–ª–∏, –ø–æ—Å–∫–æ–ª—å–∫—É –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –±—É–¥—É—Ç –¥–ª–∏–Ω–Ω—ã–º–∏ (–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –æ–±—Ä–∞–∑—Ü—ã –±—É–¥—É—Ç —Ä–∞–∑–±–∏—Ç—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤), –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∑–¥–µ—Å—å –Ω–µ –∏–º–µ–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–π –ø–æ–ª—å–∑—ã:

```py
max_length = 384
stride = 128


def preprocess_training_examples(examples):
    questions = [q.strip() for q in examples["question"]]
    inputs = tokenizer(
        questions,
        examples["context"],
        max_length=max_length,
        truncation="only_second",
        stride=stride,
        return_overflowing_tokens=True,
        return_offsets_mapping=True,
        padding="max_length",
    )

    offset_mapping = inputs.pop("offset_mapping")
    sample_map = inputs.pop("overflow_to_sample_mapping")
    answers = examples["answers"]
    start_positions = []
    end_positions = []

    for i, offset in enumerate(offset_mapping):
        sample_idx = sample_map[i]
        answer = answers[sample_idx]
        start_char = answer["answer_start"][0]
        end_char = answer["answer_start"][0] + len(answer["text"][0])
        sequence_ids = inputs.sequence_ids(i)

        # –ù–∞–π–¥—ë–º –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        idx = 0
        while sequence_ids[idx] != 1:
            idx += 1
        context_start = idx
        while sequence_ids[idx] == 1:
            idx += 1
        context_end = idx - 1

        # –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –º–µ—Ç–∫–æ–π –±—É–¥–µ—Ç (0, 0)
        if offset[context_start][0] > start_char or offset[context_end][1] < end_char:
            start_positions.append(0)
            end_positions.append(0)
        else:
            # –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ —ç—Ç–æ –Ω–∞—á–∞–ª—å–Ω–∞—è –∏ –∫–æ–Ω–µ—á–Ω–∞—è –ø–æ–∑–∏—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
            idx = context_start
            while idx <= context_end and offset[idx][0] <= start_char:
                idx += 1
            start_positions.append(idx - 1)

            idx = context_end
            while idx >= context_start and offset[idx][1] >= end_char:
                idx -= 1
            end_positions.append(idx + 1)

    inputs["start_positions"] = start_positions
    inputs["end_positions"] = end_positions
    return inputs
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ –¥–≤–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã –∏ –¥–ª–∏–Ω—ã —Å–∫–æ–ª—å–∑—è—â–µ–≥–æ –æ–∫–Ω–∞, –∞ —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–∏–ª–∏ –Ω–µ–º–Ω–æ–≥–æ –æ—á–∏—Å—Ç–∫–∏ –ø–µ—Ä–µ–¥ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–µ–π: –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ SQuAD –∏–º–µ—é—Ç –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç (–∏ –∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ –ø—Ä–∏ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏, –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –º–æ–¥–µ–ª—å –≤—Ä–æ–¥–µ RoBERTa), –ø–æ—ç—Ç–æ–º—É –º—ã —É–¥–∞–ª–∏–ª–∏ —ç—Ç–∏ –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã.

–ß—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –∫–æ –≤—Å–µ–º—É –æ–±—É—á–∞—é—â–µ–º—É –Ω–∞–±–æ—Ä—É, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ `Dataset.map()` —Å —Ñ–ª–∞–≥–æ–º `batched=True`. –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —Ç–∞–∫ –∫–∞–∫ –º—ã –∏–∑–º–µ–Ω—è–µ–º –¥–ª–∏–Ω—É –¥–∞—Ç–∞—Å–µ—Ç–∞ (–ø–æ—Å–∫–æ–ª—å–∫—É –æ–¥–∏–Ω –ø—Ä–∏–º–µ—Ä –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—É—á–∞—é—â–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤):

```py
train_dataset = raw_datasets["train"].map(
    preprocess_training_examples,
    batched=True,
    remove_columns=raw_datasets["train"].column_names,
)
len(raw_datasets["train"]), len(train_dataset)
```

```python out
(87599, 88729)
```

–ö–∞–∫ –º—ã –≤–∏–¥–∏–º, –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–±–∞–≤–∏–ª–∞ –æ–∫–æ–ª–æ 1 000 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤. –¢–µ–ø–µ—Ä—å –Ω–∞—à –æ–±—É—á–∞—é—â–∏–π –Ω–∞–±–æ—Ä –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é - –¥–∞–≤–∞–π—Ç–µ –∑–∞–π–º–µ–º—Å—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞!

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö[[processing-the-validation-data]]

–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–æ—â–µ, –ø–æ—Å–∫–æ–ª—å–∫—É –Ω–∞–º –Ω–µ –Ω—É–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–∫–∏ (–µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –º—ã –Ω–µ —Ö–æ—Ç–∏–º –≤—ã—á–∏—Å–ª—è—Ç—å –ø–æ—Ç–µ—Ä–∏ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –Ω–æ —ç—Ç–æ —á–∏—Å–ª–æ –Ω–µ –ø–æ–º–æ–∂–µ—Ç –Ω–∞–º –ø–æ–Ω—è—Ç—å, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–∞ –º–æ–¥–µ–ª—å). –ù–∞—Å—Ç–æ—è—â–µ–π —Ä–∞–¥–æ—Å—Ç—å—é –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –º–æ–¥–µ–ª–∏ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–∞—Ö –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–º –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–º–µ—â–µ–Ω–∏–π, —Ç–∞–∫ –∏ —Å–ø–æ—Å–æ–± —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º –ø—Ä–∏–º–µ—Ä–æ–º, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–Ω –≤–∑—è—Ç. –ü–æ—Å–∫–æ–ª—å–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ –µ—Å—Ç—å —Å—Ç–æ–ª–±–µ—Ü ID, –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç ID.

–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, —á—Ç–æ –º—ã –¥–æ–±–∞–≤–∏–º —Å—é–¥–∞, - —ç—Ç–æ –Ω–µ–º–Ω–æ–≥–æ –ø–æ—á–∏—Å—Ç–∏–º —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–º–µ—â–µ–Ω–∏–π. –û–Ω–∏ –±—É–¥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–º–µ—â–µ–Ω–∏—è –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –Ω–æ –Ω–∞ —ç—Ç–∞–ø–µ –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏ —É –Ω–∞—Å –Ω–µ –±—É–¥–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–∑–Ω–∞—Ç—å, –∫–∞–∫–∞—è —á–∞—Å—Ç—å –≤—Ö–æ–¥–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç—É, –∞ –∫–∞–∫–∞—è - –≤–æ–ø—Ä–æ—Å—É (–º–µ—Ç–æ–¥ `sequence_ids()`, –∫–æ—Ç–æ—Ä—ã–π –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏, –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—ã—Ö–æ–¥–∞ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä–∞). –ü–æ—ç—Ç–æ–º—É –º—ã —É—Å—Ç–∞–Ω–æ–≤–∏–º —Å–º–µ—â–µ–Ω–∏—è, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—É, –≤ `None`:

```py
def preprocess_validation_examples(examples):
    questions = [q.strip() for q in examples["question"]]
    inputs = tokenizer(
        questions,
        examples["context"],
        max_length=max_length,
        truncation="only_second",
        stride=stride,
        return_overflowing_tokens=True,
        return_offsets_mapping=True,
        padding="max_length",
    )

    sample_map = inputs.pop("overflow_to_sample_mapping")
    example_ids = []

    for i in range(len(inputs["input_ids"])):
        sample_idx = sample_map[i]
        example_ids.append(examples["id"][sample_idx])

        sequence_ids = inputs.sequence_ids(i)
        offset = inputs["offset_mapping"][i]
        inputs["offset_mapping"][i] = [
            o if sequence_ids[k] == 1 else None for k, o in enumerate(offset)
        ]

    inputs["example_id"] = example_ids
    return inputs
```

–ú—ã –º–æ–∂–µ–º –ø—Ä–∏–º–µ–Ω–∏—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –∫–æ –≤—Å–µ–º—É –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–æ–º—É –¥–∞—Ç–∞—Å–µ—Ç—É, –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ:

```py
validation_dataset = raw_datasets["validation"].map(
    preprocess_validation_examples,
    batched=True,
    remove_columns=raw_datasets["validation"].column_names,
)
len(raw_datasets["validation"]), len(validation_dataset)
```

```python out
(10570, 10822)
```

–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –º—ã –¥–æ–±–∞–≤–∏–ª–∏ –≤—Å–µ–≥–æ –ø–∞—Ä—É —Å–æ—Ç–µ–Ω –ø—Ä–∏–º–µ—Ä–æ–≤, –ø–æ—ç—Ç–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –≤ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ –Ω–µ–º–Ω–æ–≥–æ –∫–æ—Ä–æ—á–µ.

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –º—ã –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, –º–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ –æ–±—É—á–µ–Ω–∏—é.

{#if fw === 'pt'}

## –î–æ–æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —Å API `Trainer`[[fine-tuning-the-model-with-the-trainer-api]]

–ö–æ–¥ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –±—É–¥–µ—Ç –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂ –Ω–∞ –∫–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ -- —Å–∞–º—ã–º —Å–ª–æ–∂–Ω—ã–º –±—É–¥–µ—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `compute_metrics()`. –ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –¥–æ–ø–æ–ª–Ω–∏–ª–∏ –≤—Å–µ –ø—Ä–∏–º–µ—Ä—ã –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã, –∫–æ—Ç–æ—Ä—É—é –º—ã –∑–∞–¥–∞–ª–∏, –Ω–µ—Ç –Ω–∏–∫–∞–∫–æ–≥–æ –∫–æ–ª–ª–∞—Ç–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –ø–æ—ç—Ç–æ–º—É –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ - —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, –æ —á–µ–º –Ω–∞–º –Ω—É–∂–Ω–æ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å—Å—è. –°–∞–º—ã–º —Å–ª–æ–∂–Ω—ã–º –±—É–¥–µ—Ç –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –º–æ–¥–µ–ª–∏ –≤ –æ—Ç—Ä–µ–∑–∫–∏ —Ç–µ–∫—Å—Ç–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤; –∫–∞–∫ —Ç–æ–ª—å–∫–æ –º—ã —ç—Ç–æ —Å–¥–µ–ª–∞–µ–º, –º–µ—Ç—Ä–∏–∫–∞ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ ü§ó Datasets —Å–¥–µ–ª–∞–µ—Ç –∑–∞ –Ω–∞—Å –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å —Ä–∞–±–æ—Ç—ã.

{:else}

## –î–æ–æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —Å Keras[[fine-tuning-the-model-with-keras]]

–ö–æ–¥ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –±—É–¥–µ—Ç –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂ –Ω–∞ –∫–æ–¥ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö, –Ω–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –±—É–¥–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–º. –ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –¥–æ–ø–æ–ª–Ω–∏–ª–∏ –≤—Å–µ –ø—Ä–∏–º–µ—Ä—ã –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã, –∫–æ—Ç–æ—Ä—É—é –º—ã –∑–∞–¥–∞–ª–∏, –Ω–µ—Ç –∫–æ–ª–ª–∞—Ç–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –ø–æ—ç—Ç–æ–º—É –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ - —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, –æ —á–µ–º –Ω–∞–º –Ω—É–∂–Ω–æ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å—Å—è. –°–∞–º–æ–µ —Å–ª–æ–∂–Ω–æ–µ - —ç—Ç–æ –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –º–æ–¥–µ–ª–∏ –≤ –æ—Ç—Ä–µ–∑–∫–∏ —Ç–µ–∫—Å—Ç–∞ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö; –∫–∞–∫ —Ç–æ–ª—å–∫–æ –º—ã —ç—Ç–æ —Å–¥–µ–ª–∞–µ–º, –º–µ—Ç—Ä–∏–∫–∞ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ ü§ó Datasets —Å–¥–µ–ª–∞–µ—Ç –∑–∞ –Ω–∞—Å –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å —Ä–∞–±–æ—Ç—ã.

{/if}

### –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞[[post-processing]]

{#if fw === 'pt'}

<Youtube id="BNy08iIWVJM"/>

{:else}

<Youtube id="VN67ZpN33Ss"/>

{/if}

–ú–æ–¥–µ–ª—å –≤—ã–≤–µ–¥–µ—Ç –ª–æ–≥–∏—Ç—ã –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–π –∏ –∫–æ–Ω–µ—á–Ω–æ–π –ø–æ–∑–∏—Ü–∏–π –æ—Ç–≤–µ—Ç–∞ –≤–æ –≤—Ö–æ–¥–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞—Ö, –∫–∞–∫ –º—ã –≤–∏–¥–µ–ª–∏ –ø—Ä–∏ –∏–∑—É—á–µ–Ω–∏–∏ [–∫–æ–Ω–≤–µ–π–µ—Ä–∞ `question-answering`](../chapter6/3b). –®–∞–≥ –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏ –±—É–¥–µ—Ç –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω —Ç–æ–º—É, —á—Ç–æ –º—ã –¥–µ–ª–∞–ª–∏ —Ç–∞–º, —Ç–∞–∫ —á—Ç–æ –≤–æ—Ç –∫—Ä–∞—Ç–∫–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –º—ã –¥–µ–ª–∞–ª–∏:

- –ú—ã –º–∞—Å–∫–∏—Ä–æ–≤–∞–ª–∏ –Ω–∞—á–∞–ª—å–Ω—ã–µ –∏ –∫–æ–Ω–µ—á–Ω—ã–µ –ª–æ–≥–∏—Ç—ã, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–∫–µ–Ω–∞–º –≤–Ω–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
- –ó–∞—Ç–µ–º –º—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–ª–∏ –Ω–∞—á–∞–ª—å–Ω—ã–µ –∏ –∫–æ–Ω–µ—á–Ω—ã–µ –ª–æ–≥–∏—Ç—ã –≤ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Å –ø–æ–º–æ—â—å—é softmax.
- –ö–∞–∂–¥–æ–π –ø–∞—Ä–µ `(start_token, end_token)` –º—ã –ø—Ä–∏—Å–≤–∞–∏–≤–∞–ª–∏ –æ—Ü–µ–Ω–∫—É, –≤–∑—è–≤ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –¥–≤—É—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π.
- –ú—ã –∏—Å–∫–∞–ª–∏ –ø–∞—Ä—É —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–æ–π, –∫–æ—Ç–æ—Ä–∞—è –¥–∞–≤–∞–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `start_token` –º–µ–Ω—å—à–µ `end_token`).

–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –º—ã –Ω–µ–º–Ω–æ–≥–æ –∏–∑–º–µ–Ω–∏–º —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å, –ø–æ—Å–∫–æ–ª—å–∫—É –Ω–∞–º –Ω–µ –Ω—É–∂–Ω–æ –≤—ã—á–∏—Å–ª—è—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ü–µ–Ω–∫–∏ (—Ç–æ–ª—å–∫–æ —Å–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç). –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º—ã –º–æ–∂–µ–º –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —à–∞–≥ softmax. –ß—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å, –º—ã —Ç–∞–∫–∂–µ –Ω–µ –±—É–¥–µ–º –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–∞—Ä—ã `(start_token, end_token)`, –∞ —Ç–æ–ª—å–∫–æ —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –Ω–∞–∏–±–æ–ª—å—à–∏–º `n_best` –ª–æ–≥–∏—Ç–∞–º (–ø—Ä–∏ `n_best=20`). –¢–∞–∫ –∫–∞–∫ –º—ã –ø—Ä–æ–ø—É—Å—Ç–∏–º softmax, —ç—Ç–∏ –æ—Ü–µ–Ω–∫–∏ –±—É–¥—É—Ç –æ—Ü–µ–Ω–∫–∞–º–∏ –ª–æ–≥–∏—Ç–æ–≤, –∏ –±—É–¥—É—Ç –ø–æ–ª—É—á–µ–Ω—ã –ø—É—Ç–µ–º –≤–∑—è—Ç–∏—è —Å—É–º–º—ã –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∏ –∫–æ–Ω–µ—á–Ω–æ–≥–æ –ª–æ–≥–∏—Ç–æ–≤ (–≤–º–µ—Å—Ç–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è, –ø–æ –ø—Ä–∞–≤–∏–ª—É \\(\log(ab) = \log(a) + \log(b)\\)).

–ß—Ç–æ–±—ã –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —ç—Ç–æ, –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≥–Ω–æ–∑—ã. –ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –µ—â–µ –Ω–µ –æ–±—É—á–∏–ª–∏ –Ω–∞—à—É –º–æ–¥–µ–ª—å, –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∫–æ–Ω–≤–µ–π–µ—Ä–∞ QA, —á—Ç–æ–±—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –Ω–∞ –Ω–µ–±–æ–ª—å—à–æ–π —á–∞—Å—Ç–∏ –Ω–∞–±–æ—Ä–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏. –ú—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—É –∂–µ —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏, —á—Ç–æ –∏ —Ä–∞–Ω—å—à–µ; –ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω–∞ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—É—é –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `tokenizer`, –Ω–∞–º –ø—Ä–æ—Å—Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç –Ω–∞ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä –º–æ–¥–µ–ª–∏, –∫–æ—Ç–æ—Ä—É—é –º—ã —Ö–æ—Ç–∏–º –≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```python
small_eval_set = raw_datasets["validation"].select(range(100))
trained_checkpoint = "distilbert-base-cased-distilled-squad"

tokenizer = AutoTokenizer.from_pretrained(trained_checkpoint)
eval_set = small_eval_set.map(
    preprocess_validation_examples,
    batched=True,
    remove_columns=raw_datasets["validation"].column_names,
)
```

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω, –º—ã –º–µ–Ω—è–µ–º —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –≤—ã–±—Ä–∞–Ω –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ:

```python
tokenizer = AutoTokenizer.from_pretrained(model_checkpoint)
```

–ó–∞—Ç–µ–º –º—ã —É–¥–∞–ª—è–µ–º –∏–∑ –Ω–∞—à–µ–≥–æ `eval_set` —Å—Ç–æ–ª–±—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –æ–∂–∏–¥–∞–µ—Ç –º–æ–¥–µ–ª—å, —Å–æ–∑–¥–∞–µ–º –±–∞—Ç—á —Å–æ –≤—Å–µ–π —ç—Ç–æ–π –Ω–µ–±–æ–ª—å—à–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –µ–≥–æ —á–µ—Ä–µ–∑ –º–æ–¥–µ–ª—å. –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω GPU, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã:

{#if fw === 'pt'}

```python
import torch
from transformers import AutoModelForQuestionAnswering

eval_set_for_model = eval_set.remove_columns(["example_id", "offset_mapping"])
eval_set_for_model.set_format("torch")

device = torch.device("cuda") if torch.cuda.is_available() else torch.device("cpu")
batch = {k: eval_set_for_model[k].to(device) for k in eval_set_for_model.column_names}
trained_model = AutoModelForQuestionAnswering.from_pretrained(trained_checkpoint).to(
    device
)

with torch.no_grad():
    outputs = trained_model(**batch)
```

–ü–æ—Å–∫–æ–ª—å–∫—É `Trainer` –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–∞–º –ø—Ä–æ–≥–Ω–æ–∑—ã –≤ –≤–∏–¥–µ –º–∞—Å—Å–∏–≤–æ–≤ NumPy, –º—ã –±–µ—Ä–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –∏ –∫–æ–Ω–µ—á–Ω—ã–π –ª–æ–≥–∏—Ç—ã –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∏—Ö –≤ —ç—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç:

```python
start_logits = outputs.start_logits.cpu().numpy()
end_logits = outputs.end_logits.cpu().numpy()
```

{:else}

```python
import tensorflow as tf
from transformers import TFAutoModelForQuestionAnswering

eval_set_for_model = eval_set.remove_columns(["example_id", "offset_mapping"])
eval_set_for_model.set_format("numpy")

batch = {k: eval_set_for_model[k] for k in eval_set_for_model.column_names}
trained_model = TFAutoModelForQuestionAnswering.from_pretrained(trained_checkpoint)

outputs = trained_model(**batch)
```

–î–ª—è –æ–±–ª–µ–≥—á–µ–Ω–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –º–∞—Å—Å–∏–≤—ã NumPy:

```python
start_logits = outputs.start_logits.numpy()
end_logits = outputs.end_logits.numpy()
```

{/if}

–¢–µ–ø–µ—Ä—å –Ω–∞–º –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ —Å–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –≤ `small_eval_set`. –û–¥–∏–Ω –ø—Ä–∏–º–µ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–±–∏—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –≤ `eval_set`, –ø–æ—ç—Ç–æ–º—É –ø–µ—Ä–≤—ã–º —à–∞–≥–æ–º –±—É–¥–µ—Ç —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –≤ `small_eval_set` —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ –≤ `eval_set`:

```python
import collections

example_to_features = collections.defaultdict(list)
for idx, feature in enumerate(eval_set):
    example_to_features[feature["example_id"]].append(idx)
```

–ò–º–µ—è —ç—Ç–æ –Ω–∞ —Ä—É–∫–∞—Ö, –º—ã –º–æ–∂–µ–º –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ —Ä–∞–±–æ—Ç–µ, –∏—Ç–µ—Ä–∏—Ä—É—è—Å—å –ø–æ –≤—Å–µ–º –ø—Ä–∏–º–µ—Ä–∞–º –∏, –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞, –ø–æ –≤—Å–µ–º –∞—Å—Å–æ—Ü–∏–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å –Ω–∏–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º. –ö–∞–∫ –º—ã —É–∂–µ –≥–æ–≤–æ—Ä–∏–ª–∏, –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –æ—Ü–µ–Ω–∫–∏ –ª–æ–≥–∏—Ç–æ–≤ –¥–ª—è `n_best` –Ω–∞—á–∞–ª—å–Ω—ã—Ö –ª–æ–≥–∏—Ç–æ–≤ –∏ –∫–æ–Ω–µ—á–Ω—ã—Ö –ª–æ–≥–∏—Ç–æ–≤, –∏—Å–∫–ª—é—á–∞—è –ø–æ–∑–∏—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞—é—Ç:

- –û—Ç–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –≤–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- –û—Ç–≤–µ—Ç —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π –¥–ª–∏–Ω–æ–π
- –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç (–º—ã –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ `max_answer_length=30`).

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –º—ã –ø–æ–ª—É—á–∏–ª–∏ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞, –º—ã –ø—Ä–æ—Å—Ç–æ –≤—ã–±–∏—Ä–∞–µ–º —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –ª—É—á—à—É—é –æ—Ü–µ–Ω–∫—É –ª–æ–≥–∏—Ç–∞:

```python
import numpy as np

n_best = 20
max_answer_length = 30
predicted_answers = []

for example in small_eval_set:
    example_id = example["id"]
    context = example["context"]
    answers = []

    for feature_index in example_to_features[example_id]:
        start_logit = start_logits[feature_index]
        end_logit = end_logits[feature_index]
        offsets = eval_set["offset_mapping"][feature_index]

        start_indexes = np.argsort(start_logit)[-1 : -n_best - 1 : -1].tolist()
        end_indexes = np.argsort(end_logit)[-1 : -n_best - 1 : -1].tolist()
        for start_index in start_indexes:
            for end_index in end_indexes:
                # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Ç–≤–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
                if offsets[start_index] is None or offsets[end_index] is None:
                    continue
                # –ü—Ä–æ–ø—É—Å–∫–∞–π—Ç–µ –æ—Ç–≤–µ—Ç—ã, –¥–ª–∏–Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –ª–∏–±–æ < 0, –ª–∏–±–æ > max_answer_length.
                if (
                    end_index < start_index
                    or end_index - start_index + 1 > max_answer_length
                ):
                    continue

                answers.append(
                    {
                        "text": context[offsets[start_index][0] : offsets[end_index][1]],
                        "logit_score": start_logit[start_index] + end_logit[end_index],
                    }
                )

    best_answer = max(answers, key=lambda x: x["logit_score"])
    predicted_answers.append({"id": example_id, "prediction_text": best_answer["text"]})
```

–û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ - —ç—Ç–æ —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–∂–∏–¥–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∞, –∫–æ—Ç–æ—Ä—É—é –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å. –ö–∞–∫ –æ–±—ã—á–Ω–æ, –º—ã –º–æ–∂–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–µ —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ ü§ó Evaluate:

```python
import evaluate

metric = evaluate.load("squad")
```

–≠—Ç–∞ –º–µ—Ç—Ä–∏–∫–∞ –æ–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º—ã–µ –æ—Ç–≤–µ—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –º—ã –≤–∏–¥–µ–ª–∏ –≤—ã—à–µ (—Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –æ–¥–Ω–∏–º –∫–ª—é—á–æ–º –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –ø—Ä–∏–º–µ—Ä–∞ –∏ –æ–¥–Ω–∏–º –∫–ª—é—á–æ–º –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º–æ–≥–æ —Ç–µ–∫—Å—Ç–∞), –∏ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–≤–µ—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ –Ω–∏–∂–µ (—Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –æ–¥–Ω–∏–º –∫–ª—é—á–æ–º –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –ø—Ä–∏–º–µ—Ä–∞ –∏ –æ–¥–Ω–∏–º –∫–ª—é—á–æ–º –¥–ª—è –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤):

```python
theoretical_answers = [
    {"id": ex["id"], "answers": ex["answers"]} for ex in small_eval_set
]
```

–¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ–ª—É—á–∞–µ–º —Ä–∞–∑—É–º–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –ø–æ—Å–º–æ—Ç—Ä–µ–≤ –Ω–∞ –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –æ–±–æ–∏—Ö —Å–ø–∏—Å–∫–æ–≤:

```python
print(predicted_answers[0])
print(theoretical_answers[0])
```

```python out
{'id': '56be4db0acb8001400a502ec', 'prediction_text': 'Denver Broncos'}
{'id': '56be4db0acb8001400a502ec', 'answers': {'text': ['Denver Broncos', 'Denver Broncos', 'Denver Broncos'], 'answer_start': [177, 177, 177]}}
```

–ù–µ —Ç–∞–∫ —É–∂ –ø–ª–æ—Ö–æ! –¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –æ—Ü–µ–Ω–∫—É, –∫–æ—Ç–æ—Ä—É—é –¥–∞–µ—Ç –Ω–∞–º –º–µ—Ç—Ä–∏–∫–∞:

```python
metric.compute(predictions=predicted_answers, references=theoretical_answers)
```

```python out
{'exact_match': 83.0, 'f1': 88.25}
```

–û–ø—è—Ç—å –∂–µ, —ç—Ç–æ –¥–æ–≤–æ–ª—å–Ω–æ —Ö–æ—Ä–æ—à–æ, –µ—Å–ª–∏ —É—á–µ—Å—Ç—å, —á—Ç–æ —Å–æ–≥–ª–∞—Å–Ω–æ [–µ–≥–æ —Å—Ç–∞—Ç—å–µ](https://arxiv.org/abs/1910.01108v2) DistilBERT —Å –¥–æ–æ–±—É—á–µ–Ω–∏–µ–º –Ω–∞ SQuAD –ø–æ–ª—É—á–∞–µ—Ç 79,1 –∏ 86,9 –¥–ª—è —ç—Ç–∏—Ö –æ—Ü–µ–Ω–æ–∫ –Ω–∞ –≤—Å–µ–º –¥–∞—Ç–∞—Å–µ—Ç–µ.

{#if fw === 'pt'}

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –ø–æ–º–µ—Å—Ç–∏–º –≤—Å–µ, —á—Ç–æ –º—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–¥–µ–ª–∞–ª–∏, –≤ —Ñ—É–Ω–∫—Ü–∏—é `compute_metrics()`, –∫–æ—Ç–æ—Ä—É—é –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ `Trainer`. –û–±—ã—á–Ω–æ —Ñ—É–Ω–∫—Ü–∏—è `compute_metrics()` –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ—Ä—Ç–µ–∂ `eval_preds` —Å –ª–æ–≥–∏—Ç–∞–º–∏ –∏ –º–µ—Ç–∫–∞–º–∏. –ó–¥–µ—Å—å –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –Ω–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ, —Ç–∞–∫ –∫–∞–∫ –º—ã –¥–æ–ª–∂–Ω—ã –∏—Å–∫–∞—Ç—å –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Å–º–µ—â–µ–Ω–∏—è –∏ –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å—Ö–æ–¥–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã, –ø–æ—ç—Ç–æ–º—É –º—ã –Ω–µ —Å–º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—ã—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ü–µ–Ω–∫–∏ –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è. –ú—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–µ —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ü–µ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

–§—É–Ω–∫—Ü–∏—è `compute_metrics()` –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç —Ç–µ –∂–µ —à–∞–≥–∏, —á—Ç–æ –∏ –¥–æ —ç—Ç–æ–≥–æ, —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–µ–±–æ–ª—å—à–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –º—ã –Ω–µ –Ω–∞–π–¥–µ–º –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (–≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –º—ã –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É).

{:else}

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –ø–æ–º–µ—Å—Ç–∏–º –≤—Å–µ, —á—Ç–æ –º—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–¥–µ–ª–∞–ª–∏, –≤ —Ñ—É–Ω–∫—Ü–∏—é `compute_metrics()`, –∫–æ—Ç–æ—Ä—É—é –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –Ω–∞—à–µ–π –º–æ–¥–µ–ª–∏. –ù–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–æ–ª—å—à–µ, —á–µ–º –ø—Ä–æ—Å—Ç–æ –≤—ã—Ö–æ–¥–Ω—ã–µ –ª–æ–≥–∏—Ç—ã, –ø–æ—Å–∫–æ–ª—å–∫—É –º—ã –¥–æ–ª–∂–Ω—ã –∏—Å–∫–∞—Ç—å –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Å–º–µ—â–µ–Ω–∏–µ, –∞ –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ –ø—Ä–∏–º–µ—Ä–æ–≤ - –∏—Å—Ö–æ–¥–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã:

{/if}

```python
from tqdm.auto import tqdm


def compute_metrics(start_logits, end_logits, features, examples):
    example_to_features = collections.defaultdict(list)
    for idx, feature in enumerate(features):
        example_to_features[feature["example_id"]].append(idx)

    predicted_answers = []
    for example in tqdm(examples):
        example_id = example["id"]
        context = example["context"]
        answers = []

        # –ò—Ç–µ—Ä–∏—Ä—É–µ–º—Å—è –ø–æ –≤—Å–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º, –∞—Å—Å–æ—Ü–∏–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å —ç—Ç–∏–º –ø—Ä–∏–º–µ—Ä–æ–º
        for feature_index in example_to_features[example_id]:
            start_logit = start_logits[feature_index]
            end_logit = end_logits[feature_index]
            offsets = features[feature_index]["offset_mapping"]

            start_indexes = np.argsort(start_logit)[-1 : -n_best - 1 : -1].tolist()
            end_indexes = np.argsort(end_logit)[-1 : -n_best - 1 : -1].tolist()
            for start_index in start_indexes:
                for end_index in end_indexes:
                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Ç–≤–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
                    if offsets[start_index] is None or offsets[end_index] is None:
                        continue
                    # –ü—Ä–æ–ø—É—Å–∫–∞–π—Ç–µ –æ—Ç–≤–µ—Ç—ã, –¥–ª–∏–Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –ª–∏–±–æ < 0, –ª–∏–±–æ > max_answer_length
                    if (
                        end_index < start_index
                        or end_index - start_index + 1 > max_answer_length
                    ):
                        continue

                    answer = {
                        "text": context[offsets[start_index][0] : offsets[end_index][1]],
                        "logit_score": start_logit[start_index] + end_logit[end_index],
                    }
                    answers.append(answer)

        # –í—ã–±–∏—Ä–∞–µ–º –æ—Ç–≤–µ—Ç —Å –ª—É—á—à–µ–π –æ—Ü–µ–Ω–∫–æ–π
        if len(answers) > 0:
            best_answer = max(answers, key=lambda x: x["logit_score"])
            predicted_answers.append(
                {"id": example_id, "prediction_text": best_answer["text"]}
            )
        else:
            predicted_answers.append({"id": example_id, "prediction_text": ""})

    theoretical_answers = [{"id": ex["id"], "answers": ex["answers"]} for ex in examples]
    return metric.compute(predictions=predicted_answers, references=theoretical_answers)
```

–ú—ã –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–µ —Ä–∞–±–æ—Ç—É –Ω–∞ –Ω–∞—à–∏—Ö –ø—Ä–æ–≥–Ω–æ–∑–∞—Ö:

```python
compute_metrics(start_logits, end_logits, eval_set, small_eval_set)
```

```python out
{'exact_match': 83.0, 'f1': 88.25}
```

–í—ã–≥–ª—è–¥–∏—Ç –æ—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —ç—Ç–æ –¥–ª—è –¥–æ–æ–±—É—á–µ–Ω–∏—è –Ω–∞—à–µ–π –º–æ–¥–µ–ª–∏.

### –î–æ–æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏[[fine-tuning-the-model]]

{#if fw === 'pt'}

–¢–µ–ø–µ—Ä—å –º—ã –≥–æ—Ç–æ–≤—ã –∫ –æ–±—É—á–µ–Ω–∏—é –Ω–∞—à–µ–π –º–æ–¥–µ–ª–∏. –î–∞–≤–∞–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–¥–∏–º –µ–µ, –∏—Å–ø–æ–ª—å–∑—É—è –∫–ª–∞—Å—Å `AutoModelForQuestionAnswering`, –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ:

```python
model = AutoModelForQuestionAnswering.from_pretrained(model_checkpoint)
```

{:else}

–¢–µ–ø–µ—Ä—å –º—ã –≥–æ—Ç–æ–≤—ã –∫ –æ–±—É—á–µ–Ω–∏—é –Ω–∞—à–µ–π –º–æ–¥–µ–ª–∏. –î–∞–≤–∞–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–¥–∏–º –µ–µ, –∏—Å–ø–æ–ª—å–∑—É—è –∫–ª–∞—Å—Å `TFAutoModelForQuestionAnswering`, –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ:

```python
model = TFAutoModelForQuestionAnswering.from_pretrained(model_checkpoint)
```

{/if}

–ö–∞–∫ –æ–±—ã—á–Ω–æ, –º—ã –ø–æ–ª—É—á–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–µ—Å–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è (–≤–µ—Å–∞ –≥–æ–ª–æ–≤—ã –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è), –∞ –¥—Ä—É–≥–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º (–≤–µ—Å–∞ –≥–æ–ª–æ–≤—ã –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã). –í—ã —É–∂–µ –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ –ø—Ä–∏–≤—ã–∫–Ω—É—Ç—å –∫ —ç—Ç–æ–º—É, –Ω–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–æ–¥–µ–ª—å –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ –¥–æ–æ–±—É—á–µ–Ω–∏–∏ - —Ö–æ—Ä–æ—à–æ, —á—Ç–æ –º—ã —Å–µ–π—á–∞—Å —ç—Ç–∏–º –∑–∞–π–º–µ–º—Å—è!

–ß—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞—à—É –º–æ–¥–µ–ª—å –Ω–∞ Hub, –Ω–∞–º –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏ –≤ Hugging Face. –ï—Å–ª–∏ –≤—ã –≤—ã–ø–æ–ª–Ω—è–µ—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ –±–ª–æ–∫–Ω–æ—Ç–µ, –≤—ã –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ —Å –ø–æ–º–æ—â—å—é —Å–ª–µ–¥—É—é—â–µ–π —Å–ª—É–∂–µ–±–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤–∏–¥–∂–µ—Ç, –≥–¥–µ –≤—ã –º–æ–∂–µ—Ç–µ –≤–≤–µ—Å—Ç–∏ —Å–≤–æ–∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:

```python
from huggingface_hub import notebook_login

notebook_login()
```

–ï—Å–ª–∏ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ –Ω–µ –≤ –±–ª–æ–∫–Ω–æ—Ç–µ, –ø—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
huggingface-cli login
```

{#if fw === 'pt'}

–ö–æ–≥–¥–∞ —ç—Ç–æ —Å–¥–µ–ª–∞–Ω–æ, –º—ã –º–æ–∂–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞—à–∏ `TrainingArguments`. –ö–∞–∫ –º—ã —É–∂–µ –≥–æ–≤–æ—Ä–∏–ª–∏, –∫–æ–≥–¥–∞ –æ–ø—Ä–µ–¥–µ–ª—è–ª–∏ –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫–∏, –º—ã –Ω–µ —Å–º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å –æ–±—ã—á–Ω—ã–π —Ü–∏–∫–ª –æ—Ü–µ–Ω–∫–∏ –∏–∑-–∑–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏ `compute_metrics()`. –ú—ã –º–æ–≥–ª–∏ –±—ã –Ω–∞–ø–∏—Å–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ–¥–∫–ª–∞—Å—Å `Trainer` –¥–ª—è —ç—Ç–æ–≥–æ (—Ç–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ [–ø—Ä–∏–º–µ—Ä–µ —Å–∫—Ä–∏–ø—Ç–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã](https://github.com/huggingface/transformers/blob/master/examples/pytorch/question-answering/trainer_qa.py)), –Ω–æ —ç—Ç–æ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –º—ã –±—É–¥–µ–º –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –º–æ–¥–µ–ª—å —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ü–µ –æ–±—É—á–µ–Ω–∏—è, –∞ –∫–∞–∫ –ø—Ä–æ–≤–æ–¥–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—É—é –æ—Ü–µ–Ω–∫—É, –ø–æ–∫–∞–∂–µ–º –Ω–∏–∂–µ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è".

–ò–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å API `Trainer` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–≤–æ–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ ü§ó Accelerate –±–ª–∏—Å—Ç–∞–µ—Ç: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∞—Å—Å–∞ –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–ª—É—á–∞–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª–µ–∑–Ω–µ–Ω–Ω–æ–π, –Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ —Ü–∏–∫–ª–∞ –æ–±—É—á–µ–Ω–∏—è - —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ.

Let's take a look at our `TrainingArguments`:

```python
from transformers import TrainingArguments

args = TrainingArguments(
    "bert-finetuned-squad",
    evaluation_strategy="no",
    save_strategy="epoch",
    learning_rate=2e-5,
    num_train_epochs=3,
    weight_decay=0.01,
    fp16=True,
    push_to_hub=True,
)
```

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∏–∑ –Ω–∏—Ö –º—ã —É–∂–µ –≤–∏–¥–µ–ª–∏: –º—ã –∑–∞–¥–∞–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö –æ–±—É—á–µ–Ω–∏—è –∏ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –≤–µ—Å–∞) –∏ —É–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ —Ö–æ—Ç–∏–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –º–æ–¥–µ–ª—å –≤ –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–π —ç–ø–æ—Ö–∏, –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –æ—Ü–µ–Ω–∫—É –∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Model Hub. –ú—ã —Ç–∞–∫–∂–µ –≤–∫–ª—é—á–∞–µ–º –æ–±—É—á–µ–Ω–∏–µ —Å–æ —Å–º–µ—à–∞–Ω–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é —Å `fp16=True`, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –º–æ–∂–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö GPU.

{:else}

–¢–µ–ø–µ—Ä—å –≤—Å–µ –≥–æ—Ç–æ–≤–æ, –∏ –º—ã –º–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å –Ω–∞—à TF –¥–∞—Ç–∞—Å–µ—Ç. –ù–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π –∫–æ–ª–ª–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

```python
from transformers import DefaultDataCollator

data_collator = DefaultDataCollator(return_tensors="tf")
```

–ê —Ç–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–¥–∏–º –¥–∞—Ç–∞—Å–µ—Ç, –∫–∞–∫ –æ–±—ã—á–Ω–æ.

```python
tf_train_dataset = model.prepare_tf_dataset(
    train_dataset,
    collate_fn=data_collator,
    shuffle=True,
    batch_size=16,
)
tf_eval_dataset = model.prepare_tf_dataset(
    validation_dataset,
    collate_fn=data_collator,
    shuffle=False,
    batch_size=16,
)
```

–î–∞–ª–µ–µ –º—ã –∑–∞–¥–∞–µ–º –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è –∏ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º –Ω–∞—à—É –º–æ–¥–µ–ª—å:

```python
from transformers import create_optimizer
from transformers.keras_callbacks import PushToHubCallback
import tensorflow as tf

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –æ–±—É—á–µ–Ω–∏—è - —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω–æ–µ –Ω–∞ —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞, –∑–∞—Ç–µ–º —É–º–Ω–æ–∂–µ–Ω–Ω–æ–µ
# by the total number of epochs. Note that the tf_train_dataset here is a batched tf.data.Dataset,
# –∞ –Ω–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç Hugging Face, –ø–æ—ç—Ç–æ–º—É –µ–≥–æ len() —É–∂–µ —Ä–∞–≤–µ–Ω num_samples // batch_size.
num_train_epochs = 3
num_train_steps = len(tf_train_dataset) * num_train_epochs
optimizer, schedule = create_optimizer(
    init_lr=2e-5,
    num_warmup_steps=0,
    num_train_steps=num_train_steps,
    weight_decay_rate=0.01,
)
model.compile(optimizer=optimizer)

# –û–±—É—á–µ–Ω–∏–µ —Å–æ —Å–º–µ—à–∞–Ω–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é float16
tf.keras.mixed_precision.set_global_policy("mixed_float16")
```

–ù–∞–∫–æ–Ω–µ—Ü, –º—ã –≥–æ—Ç–æ–≤—ã –∫ –æ–±—É—á–µ–Ω–∏—é —Å –ø–æ–º–æ—â—å—é `model.fit()`. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `PushToHubCallback` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ –≤ Hub –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —ç–ø–æ—Ö–∏.

{/if}

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Ä–æ–∑–∏—Ç–æ—Ä–∏–π –±—É–¥–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –≤–∞—à–µ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –∏–º–µ–Ω –∏ –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–¥–∞–Ω–Ω—ã–º –≤—ã—Ö–æ–¥–Ω—ã–º –∫–∞—Ç–∞–ª–æ–≥–æ–º, —Ç–∞–∫ —á—Ç–æ –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –æ–Ω –±—É–¥–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ `"sgugger/bert-finetuned-squad"`. –ú—ã –º–æ–∂–µ–º –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —ç—Ç–æ, –ø–µ—Ä–µ–¥–∞–≤ `hub_model_id`; –Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é `huggingface_course`, –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `hub_model_id="huggingface_course/bert-finetuned-squad"` (—ç—Ç–æ –º–æ–¥–µ–ª—å, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –º—ã —Å—Å—ã–ª–∞–ª–∏—Å—å –≤ –Ω–∞—á–∞–ª–µ —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞).

{#if fw === 'pt'}

<Tip>

üí° –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤–∞–º–∏ –≤—ã—Ö–æ–¥–Ω–æ–π –∫–∞—Ç–∞–ª–æ–≥ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–º –∫–ª–æ–Ω–æ–º —Ç–æ–≥–æ —Ä–æ–∑–∏—Ç–æ—Ä–∏—è, –≤ –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ (–ø–æ—ç—Ç–æ–º—É –∑–∞–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è, –µ—Å–ª–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –æ—à–∏–±–∫—É –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ `Trainer`).

</Tip>

–ù–∞–∫–æ–Ω–µ—Ü, –º—ã –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–µ–º –≤—Å–µ –≤ –∫–ª–∞—Å—Å `Trainer` –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –æ–±—É—á–µ–Ω–∏–µ:

```python
from transformers import Trainer

trainer = Trainer(
    model=model,
    args=args,
    train_dataset=train_dataset,
    eval_dataset=validation_dataset,
    tokenizer=tokenizer,
)
trainer.train()
```

{:else}

```python
from transformers.keras_callbacks import PushToHubCallback

callback = PushToHubCallback(output_dir="bert-finetuned-squad", tokenizer=tokenizer)

# –ú—ã —Å–æ–±–∏—Ä–∞–µ–º—Å—è –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É –Ω–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –æ–±—É—á–µ–Ω–∏—è
model.fit(tf_train_dataset, callbacks=[callback], epochs=num_train_epochs)
```

{/if}

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –º–æ–¥–µ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (–∑–¥–µ—Å—å - –∫–∞–∂–¥—É—é —ç–ø–æ—Ö—É), –æ–Ω–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ Hub –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–æ–π –º–∞—à–∏–Ω–µ. –í—Å–µ –æ–±—É—á–µ–Ω–∏–µ –∑–∞–Ω–∏–º–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è (—á—É—Ç—å –±–æ–ª—å—à–µ —á–∞—Å–∞ –Ω–∞ Titan RTX), –ø–æ—ç—Ç–æ–º—É –≤–æ –≤—Ä–µ–º—è –µ–≥–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–ø–∏—Ç—å –∫–æ—Ñ–µ –∏–ª–∏ –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å —Ç–µ —á–∞—Å—Ç–∏ –∫—É—Ä—Å–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∫–∞–∑–∞–ª–∏—Å—å –≤–∞–º –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–º–∏. –¢–∞–∫–∂–µ –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –∫–∞–∫ —Ç–æ–ª—å–∫–æ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è –ø–µ—Ä–≤–∞—è —ç–ø–æ—Ö–∞, –≤—ã —É–≤–∏–¥–∏—Ç–µ, —á—Ç–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–µ—Å–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ Hub, –∏ —Å–º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –∏–≥—Ä–∞—Ç—å —Å –≤–∞—à–µ–π –º–æ–¥–µ–ª—å—é –Ω–∞ –µ–µ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.

{#if fw === 'pt'}

–ö–æ–≥–¥–∞ –æ–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –º—ã –º–æ–∂–µ–º –Ω–∞–∫–æ–Ω–µ—Ü –æ—Ü–µ–Ω–∏—Ç—å –Ω–∞—à—É –º–æ–¥–µ–ª—å (–∏ –ø–æ–º–æ–ª–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ –≤—Å–µ —ç—Ç–æ –≤—Ä–µ–º—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –≤–ø—É—Å—Ç—É—é). –ú–µ—Ç–æ–¥ `predict()` —Ñ—É–Ω–∫—Ü–∏–∏ `Trainer` –≤–µ—Ä–Ω–µ—Ç –∫–æ—Ä—Ç–µ–∂, –≥–¥–µ –ø–µ—Ä–≤—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –±—É–¥—É—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ (–∑–¥–µ—Å—å –ø–∞—Ä–∞ —Å –Ω–∞—á–∞–ª—å–Ω—ã–º –∏ –∫–æ–Ω–µ—á–Ω—ã–º –ª–æ–≥–∏—Ç–∞–º–∏). –ú—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é `compute_metrics()`:

```python
predictions, _, _ = trainer.predict(validation_dataset)
start_logits, end_logits = predictions
compute_metrics(start_logits, end_logits, validation_dataset, raw_datasets["validation"])
```

{:else}

–ö–æ–≥–¥–∞ –æ–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –º—ã –º–æ–∂–µ–º –Ω–∞–∫–æ–Ω–µ—Ü –æ—Ü–µ–Ω–∏—Ç—å –Ω–∞—à—É –º–æ–¥–µ–ª—å (–∏ –ø–æ–º–æ–ª–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ –≤—Å–µ —ç—Ç–æ –≤—Ä–µ–º—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –≤–ø—É—Å—Ç—É—é). –ú–µ—Ç–æ–¥ `predict()` —Ñ—É–Ω–∫—Ü–∏–∏ `Trainer` –≤–µ—Ä–Ω–µ—Ç –∫–æ—Ä—Ç–µ–∂, –≥–¥–µ –ø–µ—Ä–≤—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –±—É–¥—É—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ (–∑–¥–µ—Å—å –ø–∞—Ä–∞ —Å –Ω–∞—á–∞–ª—å–Ω—ã–º –∏ –∫–æ–Ω–µ—á–Ω—ã–º –ª–æ–≥–∏—Ç–∞–º–∏). –ú—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é `compute_metrics()`:

```python
predictions = model.predict(tf_eval_dataset)
compute_metrics(
    predictions["start_logits"],
    predictions["end_logits"],
    validation_dataset,
    raw_datasets["validation"],
)
```

{/if}

```python out
{'exact_match': 81.18259224219489, 'f1': 88.67381321905516}
```

–û—Ç–ª–∏—á–Ω–æ! –î–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è, –±–∞–∑–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ —Å—Ç–∞—Ç—å–µ BERT –¥–ª—è —ç—Ç–æ–π –º–æ–¥–µ–ª–∏, —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç 80,8 –∏ 88,5, —Ç–∞–∫ —á—Ç–æ –º—ã –∫–∞–∫ —Ä–∞–∑ —Ç–∞–º, –≥–¥–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å.

{#if fw === 'pt'}

–ù–∞–∫–æ–Ω–µ—Ü, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ `push_to_hub()`, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é –º–æ–¥–µ–ª–∏:

```py
trainer.push_to_hub(commit_message="Training complete")
```

–≠—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL —Ç–æ–ª—å–∫–æ —á—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –∫–æ–º–º–∏—Ç–∞, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –µ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å:

```python out
'https://huggingface.co/sgugger/bert-finetuned-squad/commit/9dcee1fbc25946a6ed4bb32efb1bd71d5fa90b68'
```

`Trainer` —Ç–∞–∫–∂–µ —Å–æ–∑–¥–∞–µ—Ç —á–µ—Ä–Ω–æ–≤–∏–∫ –∫–∞—Ä—Ç–æ—á–∫–∏ –º–æ–¥–µ–ª–∏ —Å–æ –≤—Å–µ–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –æ—Ü–µ–Ω–∫–∏ –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –µ–µ.

{/if}

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ –Ω–∞ Model Hub, —á—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å –∏ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –µ—é —Å –¥—Ä—É–∑—å—è–º–∏, —Å–µ–º—å–µ–π –∏ –ª—é–±–∏–º—ã–º–∏ –ø–∏—Ç–æ–º—Ü–∞–º–∏. –í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–≤–µ–ª–∏ –¥–æ–æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –∑–∞–¥–∞—á–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å - –ø–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!

<Tip>

‚úèÔ∏è **–í–∞—à–∞ –æ—á–µ—Ä–µ–¥—å!** –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –º–æ–¥–µ–ª–∏, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, –ª—É—á—à–µ –ª–∏ –æ–Ω–∞ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å —ç—Ç–æ–π –∑–∞–¥–∞—á–µ–π!

</Tip>

{#if fw === 'pt'}

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ –ø–æ–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–π —Ü–∏–∫–ª, –º—ã –ø–æ–∫–∞–∂–µ–º –≤–∞–º, –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Ç–æ –∂–µ —Å–∞–º–æ–µ —Å –ø–æ–º–æ—â—å—é ü§ó Accelerate.

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è[[a-custom-training-loop]]

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è, —á—Ç–æ–±—ã –≤—ã –º–æ–≥–ª–∏ –ª–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω—É–∂–Ω—ã–µ –≤–∞–º —á–∞—Å—Ç–∏. –û–Ω –±—É–¥–µ—Ç –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂ –Ω–∞ —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è –≤ [–ì–ª–∞–≤–µ 3](../chapter3/4), –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Ü–∏–∫–ª–∞ –æ—Ü–µ–Ω–∫–∏. –ú—ã —Å–º–æ–∂–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –º–æ–¥–µ–ª—å, –ø–æ—Å–∫–æ–ª—å–∫—É –±–æ–ª—å—à–µ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –∫–ª–∞—Å—Å–æ–º `Trainer`.

### –ü–æ–¥–≥–æ—Ç–æ–≤–∏–º –≤—Å–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è[[preparing-everything-for-training]]

–°–Ω–∞—á–∞–ª–∞ –Ω–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å `DataLoader`—ã –∏–∑ –Ω–∞—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤. –ú—ã —É—Å—Ç–∞–Ω–æ–≤–∏–º —Ñ–æ—Ä–º–∞—Ç —ç—Ç–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –≤ `"torch"` –∏ —É–¥–∞–ª–∏–º —Å—Ç–æ–ª–±—Ü—ã –≤ –Ω–∞–±–æ—Ä–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–æ–¥–µ–ª—å—é. –ó–∞—Ç–µ–º –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `default_data_collator`, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–π Transformers, –≤ –∫–∞—á–µ—Å—Ç–≤–µ `collate_fn` –∏ –ø–µ—Ä–µ–º–µ—à–∞–µ–º –æ–±—É—á–∞—é—â–∏–π –Ω–∞–±–æ—Ä, –Ω–æ –Ω–µ –Ω–∞–±–æ—Ä –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏:

```py
from torch.utils.data import DataLoader
from transformers import default_data_collator

train_dataset.set_format("torch")
validation_set = validation_dataset.remove_columns(["example_id", "offset_mapping"])
validation_set.set_format("torch")

train_dataloader = DataLoader(
    train_dataset,
    shuffle=True,
    collate_fn=default_data_collator,
    batch_size=8,
)
eval_dataloader = DataLoader(
    validation_set, collate_fn=default_data_collator, batch_size=8
)
```

–ó–∞—Ç–µ–º –º—ã —Ä–µ–∏–Ω—Å—Ç–∞–Ω—Ü–∏—Ä—É–µ–º –Ω–∞—à—É –º–æ–¥–µ–ª—å, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º—ã –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –¥–æ–æ–±—É—á–µ–Ω–∏–µ, –∞ —Å–Ω–æ–≤–∞ –Ω–∞—á–∏–Ω–∞–µ–º —Å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ BERT:

```py
model = AutoModelForQuestionAnswering.from_pretrained(model_checkpoint)
```

–¢–æ–≥–¥–∞ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä. –ö–∞–∫ –æ–±—ã—á–Ω–æ, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π `AdamW`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Ö–æ–∂ –Ω–∞ Adam, –Ω–æ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –≤ —Å–ø–æ—Å–æ–±–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∑–∞—Ç—É—Ö–∞–Ω–∏—è –≤–µ—Å–∞:

```py
from torch.optim import AdamW

optimizer = AdamW(model.parameters(), lr=2e-5)
```

–ö–æ–≥–¥–∞ —É –Ω–∞—Å –µ—Å—Ç—å –≤—Å–µ —ç—Ç–∏ –æ–±—ä–µ–∫—Ç—ã, –º—ã –º–æ–∂–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏—Ö –≤ –º–µ—Ç–æ–¥ `accelerator.prepare()`. –ü–æ–º–Ω–∏—Ç–µ, —á—Ç–æ –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ–±—É—á–∞—Ç—å –Ω–∞ TPU –≤ –±–ª–æ–∫–Ω–æ—Ç–µ Colab, –≤–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤–µ—Å—å —ç—Ç–æ—Ç –∫–æ–¥ –≤ —Ñ—É–Ω–∫—Ü–∏—é –æ–±—É—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–∏ –æ–¥–Ω—É —è—á–µ–π–∫—É, –∏–Ω—Å—Ç–∞–Ω—Ü–∏—Ä—É—é—â—É—é `Accelerator`. –ú—ã –º–æ–∂–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±—É—á–∞—Ç—å —Å–æ —Å–º–µ—à–∞–Ω–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é, –ø–µ—Ä–µ–¥–∞–≤ `fp16=True` –≤ `Accelerator` (–∏–ª–∏, –µ—Å–ª–∏ –≤—ã –≤—ã–ø–æ–ª–Ω—è–µ—Ç–µ –∫–æ–¥ –≤ –≤–∏–¥–µ —Å–∫—Ä–∏–ø—Ç–∞, –ø—Ä–æ—Å—Ç–æ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–ø–æ–ª–Ω–∏–ª–∏ ü§ó Accelerate `config` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º).

```py
from accelerate import Accelerator

accelerator = Accelerator(fp16=True)
model, optimizer, train_dataloader, eval_dataloader = accelerator.prepare(
    model, optimizer, train_dataloader, eval_dataloader
)
```

–ö–∞–∫ –≤—ã —É–∂–µ –ø–æ–Ω—è–ª–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤, –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª–∏–Ω—É `train_dataloader` –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à–∞–≥–æ–≤ –æ–±—É—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω–∞ –ø—Ä–æ–π–¥–µ—Ç —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `accelerator.prepare()`. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ –ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫, —á—Ç–æ –∏ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö:

```py
from transformers import get_scheduler

num_train_epochs = 3
num_update_steps_per_epoch = len(train_dataloader)
num_training_steps = num_train_epochs * num_update_steps_per_epoch

lr_scheduler = get_scheduler(
    "linear",
    optimizer=optimizer,
    num_warmup_steps=0,
    num_training_steps=num_training_steps,
)
```

–ß—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞—à—É –º–æ–¥–µ–ª—å –Ω–∞ Hub, –Ω–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç `Repository` –≤ —Ä–∞–±–æ—á–µ–π –ø–∞–ø–∫–µ. –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ Hub Hugging Face, –µ—Å–ª–∏ –≤—ã –µ—â–µ –Ω–µ –≤–æ—à–ª–∏ –≤ –Ω–µ–≥–æ. –ú—ã –æ–ø—Ä–µ–¥–µ–ª–∏–º –∏–º—è —Ä–æ–∑–∏—Ç–æ—Ä–∏—è –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É –º–æ–¥–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Ö–æ—Ç–∏–º –ø—Ä–∏—Å–≤–æ–∏—Ç—å –Ω–∞—à–µ–π –º–æ–¥–µ–ª–∏ (–Ω–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –∑–∞–º–µ–Ω–∏—Ç—å `repo_name` –Ω–∞ —Å–≤–æ–µ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ; –æ–Ω–æ –ø—Ä–æ—Å—Ç–æ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤–∞—à–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ –∏ –¥–µ–ª–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è `get_full_repo_name()`):

```py
from huggingface_hub import Repository, get_full_repo_name

model_name = "bert-finetuned-squad-accelerate"
repo_name = get_full_repo_name(model_name)
repo_name
```

```python out
'sgugger/bert-finetuned-squad-accelerate'
```

–ó–∞—Ç–µ–º –º—ã –º–æ–∂–µ–º –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ä–æ–∑–∏—Ç–æ—Ä–∏–π –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É. –ï—Å–ª–∏ –æ–Ω–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —ç—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–ª–æ–Ω–æ–º —Ç–æ–≥–æ —Ä–æ–∑–∏—Ç–æ—Ä–∏—è, —Å –∫–æ—Ç–æ—Ä—ã–º –º—ã —Ä–∞–±–æ—Ç–∞–µ–º:

```py
output_dir = "bert-finetuned-squad-accelerate"
repo = Repository(output_dir, clone_from=repo_name)
```

–¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ, —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ –≤ `output_dir`, –≤—ã–∑–≤–∞–≤ –º–µ—Ç–æ–¥ `repo.push_to_hub()`. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –Ω–∞–º –∑–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –º–æ–¥–µ–ª–∏ –≤ –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–π —ç–ø–æ—Ö–∏.

### –¶–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è[[training-loop]]

–¢–µ–ø–µ—Ä—å –º—ã –≥–æ—Ç–æ–≤—ã –Ω–∞–ø–∏—Å–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è. –ü–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞, —á—Ç–æ–±—ã —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Ö–æ–¥–æ–º –æ–±—É—á–µ–Ω–∏—è, —Ü–∏–∫–ª —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö —á–∞—Å—Ç–µ–π:

- –°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ –æ–±—É—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é –ø–æ `train_dataloader`, –ø—Ä—è–º–æ–π –ø—Ä–æ—Ö–æ–¥ –ø–æ –º–æ–¥–µ–ª–∏, –∑–∞—Ç–µ–º –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ—Ö–æ–¥ –∏ —à–∞–≥ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞.
- –û—Ü–µ–Ω–∫–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π –º—ã —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è `start_logits` –∏ `end_logits` –ø–µ—Ä–µ–¥ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º –∏—Ö –≤ –º–∞—Å—Å–∏–≤—ã NumPy. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–∏–∫–ª–∞ –æ—Ü–µ–Ω–∫–∏ –º—ã –æ–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —É—Å–µ—á–µ–Ω–∏–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ `Accelerator` –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ –∫–æ–Ω—Ü–µ, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —É –Ω–∞—Å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ –∫–∞–∂–¥–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ.
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞, –≥–¥–µ –º—ã —Å–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –º–æ–¥–µ–ª—å –∏ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä, –∞ –∑–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞–µ–º `repo.push_to_hub()`. –ö–∞–∫ –∏ —Ä–∞–Ω—å—à–µ, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç `blocking=False`, —á—Ç–æ–±—ã —É–∫–∞–∑–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–µ ü§ó Hub –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å push. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –æ–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –∞ —ç—Ç–∞ (–¥–ª–∏–Ω–Ω–∞—è) –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ.

–í–æ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–¥ —Ü–∏–∫–ª–∞ –æ–±—É—á–µ–Ω–∏—è:

```py
from tqdm.auto import tqdm
import torch

progress_bar = tqdm(range(num_training_steps))

for epoch in range(num_train_epochs):
    # –û–±—É—á–µ–Ω–∏–µ
    model.train()
    for step, batch in enumerate(train_dataloader):
        outputs = model(**batch)
        loss = outputs.loss
        accelerator.backward(loss)

        optimizer.step()
        lr_scheduler.step()
        optimizer.zero_grad()
        progress_bar.update(1)

    # –û—Ü–µ–Ω–∫–∞
    model.eval()
    start_logits = []
    end_logits = []
    accelerator.print("Evaluation!")
    for batch in tqdm(eval_dataloader):
        with torch.no_grad():
            outputs = model(**batch)

        start_logits.append(accelerator.gather(outputs.start_logits).cpu().numpy())
        end_logits.append(accelerator.gather(outputs.end_logits).cpu().numpy())

    start_logits = np.concatenate(start_logits)
    end_logits = np.concatenate(end_logits)
    start_logits = start_logits[: len(validation_dataset)]
    end_logits = end_logits[: len(validation_dataset)]

    metrics = compute_metrics(
        start_logits, end_logits, validation_dataset, raw_datasets["validation"]
    )
    print(f"epoch {epoch}:", metrics)

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞
    accelerator.wait_for_everyone()
    unwrapped_model = accelerator.unwrap_model(model)
    unwrapped_model.save_pretrained(output_dir, save_function=accelerator.save)
    if accelerator.is_main_process:
        tokenizer.save_pretrained(output_dir)
        repo.push_to_hub(
            commit_message=f"Training in progress epoch {epoch}", blocking=False
        )
```

–ï—Å–ª–∏ –≤—ã –≤–ø–µ—Ä–≤—ã–µ –≤–∏–¥–∏—Ç–µ –º–æ–¥–µ–ª—å, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å –ø–æ–º–æ—â—å—é ü§ó Accelerate, –¥–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Ç—Ä–∏ —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–µ —Å —ç—Ç–∏–º —Å–≤—è–∑–∞–Ω—ã:

```py
accelerator.wait_for_everyone()
unwrapped_model = accelerator.unwrap_model(model)
unwrapped_model.save_pretrained(output_dir, save_function=accelerator.save)
```

–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ—è—Å–Ω–µ–Ω–∏–π: –æ–Ω–∞ –ø—Ä–µ–¥–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ–º –ø—Ä–æ—Ü–µ—Å—Å–∞–º –ø–æ–¥–æ–∂–¥–∞—Ç—å, –ø–æ–∫–∞ –≤—Å–µ –Ω–µ –æ–∫–∞–∂—É—Ç—Å—è –Ω–∞ —ç—Ç–æ–π —Å—Ç–∞–¥–∏–∏, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É. –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —É –Ω–∞—Å –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –º–æ–¥–µ–ª—å –≤ –∫–∞–∂–¥–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º. –ó–∞—Ç–µ–º –º—ã –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º `unwrapped_model`, –∫–æ—Ç–æ—Ä–∞—è —è–≤–ª—è–µ—Ç—Å—è –±–∞–∑–æ–≤–æ–π –º–æ–¥–µ–ª—å—é, –∫–æ—Ç–æ—Ä—É—é –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏. –ú–µ—Ç–æ–¥ `accelerator.prepare()` –∏–∑–º–µ–Ω—è–µ—Ç –º–æ–¥–µ–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –æ–±—É—á–µ–Ω–∏–∏, –ø–æ—ç—Ç–æ–º—É —É –Ω–µ–µ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç –º–µ—Ç–æ–¥–∞ `save_pretrained()`; –º–µ—Ç–æ–¥ `accelerator.unwrap_model()` –æ—Ç–º–µ–Ω—è–µ—Ç —ç—Ç–æ—Ç —à–∞–≥. –ù–∞–∫–æ–Ω–µ—Ü, –º—ã –≤—ã–∑—ã–≤–∞–µ–º `save_pretrained()`, –Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º —ç—Ç–æ–º—É –º–µ—Ç–æ–¥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `accelerator.save()` –≤–º–µ—Å—Ç–æ `torch.save()`.

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —É –≤–∞—Å –¥–æ–ª–∂–Ω–∞ –ø–æ–ª—É—á–∏—Ç—å—Å—è –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –¥–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏–µ –Ω–∞ –º–æ–¥–µ–ª—å, –æ–±—É—á–µ–Ω–Ω—É—é —Å –ø–æ–º–æ—â—å—é `Trainer`. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä—É—é –º—ã –æ–±—É—á–∏–ª–∏ —Å –ø–æ–º–æ—â—å—é —ç—Ç–æ–≥–æ –∫–æ–¥–∞, –Ω–∞ [*huggingface-course/bert-finetuned-squad-accelerate*](https://huggingface.co/huggingface-course/bert-finetuned-squad-accelerate). –ê –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫–∏–µ-–ª–∏–±–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ü–∏–∫–ª–µ –æ–±—É—á–µ–Ω–∏—è, –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–ø—Ä—è–º—É—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏—Ö, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–≤ –∫–æ–¥, –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–π –≤—ã—à–µ!

{/if}

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–æ–æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏[[using-the-fine-tuned-model]]

–ú—ã —É–∂–µ –ø–æ–∫–∞–∑–∞–ª–∏ –≤–∞–º, –∫–∞–∫ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å, –¥–æ–æ–±—É—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–π –º—ã –ø—Ä–æ–≤–æ–¥–∏–ª–∏ –Ω–∞ Model Hub, —Å –ø–æ–º–æ—â—å—é –≤–∏–¥–∂–µ—Ç–∞ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞. –ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–µ –ª–æ–∫–∞–ª—å–Ω–æ –≤ `pipeline`, –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑–∞—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–æ–¥–µ–ª–∏:

```py
from transformers import pipeline

# –ó–∞–º–µ–Ω–∏—Ç–µ –∑–¥–µ—Å—å –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∞–º–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Ç–æ—á–∫—É
model_checkpoint = "huggingface-course/bert-finetuned-squad"
question_answerer = pipeline("question-answering", model=model_checkpoint)

context = """
ü§ó Transformers is backed by the three most popular deep learning libraries ‚Äî Jax, PyTorch and TensorFlow ‚Äî with a seamless integration
between them. It's straightforward to train your models with one before loading them for inference with the other.
"""
question = "Which deep learning libraries back ü§ó Transformers?"
question_answerer(question=question, context=context)
```

```python out
{'score': 0.9979003071784973,
 'start': 78,
 'end': 105,
 'answer': 'Jax, PyTorch and TensorFlow'}
```

–û—Ç–ª–∏—á–Ω–æ! –ù–∞—à–∞ –º–æ–¥–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫ –∂–µ —Ö–æ—Ä–æ—à–æ, –∫–∞–∫ –∏ –º–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —ç—Ç–æ–≥–æ –∫–æ–Ω–≤–µ–π–µ—Ä–∞!
