# –¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è Unigram[[unigram-tokenization]]

<CourseFloatingBanner chapter={6}
  classNames="absolute z-10 right-0 top-0"
  notebooks={[
    {label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/en/chapter6/section7.ipynb"},
    {label: "Aws Studio", value: "https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/en/chapter6/section7.ipynb"},
]} />

–ê–ª–≥–æ—Ä–∏—Ç–º Unigram —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ SentencePiece, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏, –ø—Ä–∏–º–µ–Ω—è–µ–º—ã–º –≤ —Ç–∞–∫–∏—Ö –º–æ–¥–µ–ª—è—Ö, –∫–∞–∫ AlBERT, T5, mBART, Big Bird –∏ XLNet.

<Youtube id="TGZfZVuF9Yc"/>

<Tip>

üí° –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è Unigram, –≤–ø–ª–æ—Ç—å –¥–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ, –µ—Å–ª–∏ –≤–∞–º –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –æ–±—â–∏–π –æ–±–∑–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏.

</Tip>

## –ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—É—á–µ–Ω–∏—è[[training-algorithm]]

–ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å BPE –∏ WordPiece, Unigram —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥—Ä—É–≥–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏: –æ–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç —Å –±–æ–ª—å—à–æ–≥–æ —Å–ª–æ–≤–∞—Ä–Ω–æ–≥–æ –∑–∞–ø–∞—Å–∞ –∏ —É–¥–∞–ª—è–µ—Ç –∏–∑ –Ω–µ–≥–æ —Ç–æ–∫–µ–Ω—ã, –ø–æ–∫–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç –∂–µ–ª–∞–µ–º–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ —Å–ª–æ–≤–∞—Ä—è. –°—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞—Ä—è: –Ω–∞–ø—Ä–∏–º–µ—Ä, –º—ã –º–æ–∂–µ–º –≤–∑—è—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ –≤ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ª–æ–≤–∞—Ö –∏–ª–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å BPE –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∫–æ—Ä–ø—É—Å—É —Å –±–æ–ª—å—à–∏–º –æ–±—ä–µ–º–æ–º —Å–ª–æ–≤–∞—Ä—è.

–ù–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –æ–±—É—á–µ–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º Unigram —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ—Ç–µ—Ä–∏ –ø–æ –∫–æ—Ä–ø—É—Å—É —Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–µ–≥–æ —Å–ª–æ–≤–∞—Ä–Ω–æ–≥–æ –∑–∞–ø–∞—Å–∞. –ó–∞—Ç–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ –≤ —Å–ª–æ–≤–∞—Ä–µ –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã—á–∏—Å–ª—è–µ—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ —É–≤–µ–ª–∏—á–∏—Ç—Å—è –æ–±—â–∞—è –ø–æ—Ç–µ—Ä—è, –µ—Å–ª–∏ —ç—Ç–æ—Ç —Å–∏–º–≤–æ–ª –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω, –∏ –∏—â–µ—Ç —Å–∏–º–≤–æ–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–≤–µ–ª–∏—á–∞—Ç –µ–µ –º–µ–Ω—å—à–µ –≤—Å–µ–≥–æ. –≠—Ç–∏ —Å–∏–º–≤–æ–ª—ã –æ–∫–∞–∑—ã–≤–∞—é—Ç –º–µ–Ω—å—à–µ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –æ–±—â—É—é –ø–æ—Ç–µ—Ä—é –ø–æ –∫–æ—Ä–ø—É—Å—É, –ø–æ—ç—Ç–æ–º—É –≤ –Ω–µ–∫–æ—Ç–æ—Ä–æ–º —Å–º—ã—Å–ª–µ –æ–Ω–∏ "–º–µ–Ω–µ–µ –Ω—É–∂–Ω—ã" –∏ —è–≤–ª—è—é—Ç—Å—è –ª—É—á—à–∏–º–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ.

–≠—Ç–æ –æ—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, –ø–æ—ç—Ç–æ–º—É –º—ã —É–¥–∞–ª—è–µ–º –Ω–µ –ø—Ä–æ—Å—Ç–æ –æ–¥–∏–Ω —Å–∏–º–≤–æ–ª, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º –ø–æ—Ç–µ—Ä—å, –∞ \\(p\\) (\\(p\\) - –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä, –∫–æ—Ç–æ—Ä—ã–º –≤—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å, –æ–±—ã—á–Ω–æ 10 –∏–ª–∏ 20) –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ —Å–∏–º–≤–æ–ª–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º –ø–æ—Ç–µ—Ä—å. –≠—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ —Å–ª–æ–≤–∞—Ä—å –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç –∂–µ–ª–∞–µ–º–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –º—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–¥–∞–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ª—é–±–æ–µ —Å–ª–æ–≤–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ.

–ò—Ç–∞–∫, –≤—Å–µ –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ —Ç—É–º–∞–Ω–Ω–æ: –æ—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ–±—ã –≤—ã—á–∏—Å–ª–∏—Ç—å –ø–æ—Ç–µ—Ä–∏ –ø–æ –∫–æ—Ä–ø—É—Å—É –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫ –æ–Ω–∏ –∏–∑–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ —Å–ª–æ–≤–∞—Ä—è, –Ω–æ –º—ã –µ—â–µ –Ω–µ –æ–±—ä—è—Å–Ω–∏–ª–∏, –∫–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å. –≠—Ç–æ—Ç —à–∞–≥ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏ Unigram, –ø–æ—ç—Ç–æ–º—É –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –µ–≥–æ –¥–∞–ª–µ–µ.

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ—Ä–ø—É—Å —Ç–µ–∫—Å—Ç–∞ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤:

```
("hug", 10), ("pug", 5), ("pun", 12), ("bun", 4), ("hugs", 5)
```

–∏ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –º—ã –≤–æ–∑—å–º–µ–º –≤—Å–µ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–ª–æ–≤–∞—Ä—è:

```
["h", "u", "g", "hu", "ug", "p", "pu", "n", "un", "b", "bu", "s", "hug", "gs", "ugs"]
```

## –ê–ª–≥–æ—Ä–∏—Ç–º —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏[[tokenization-algorithm]]

–ú–æ–¥–µ–ª—å Unigram - —ç—Ç–æ —Ç–∏–ø —è–∑—ã–∫–æ–≤–æ–π –º–æ–¥–µ–ª–∏, –≤ –∫–æ—Ç–æ—Ä–æ–π –∫–∞–∂–¥—ã–π —Ç–æ–∫–µ–Ω —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –æ—Ç –ø—Ä–µ–¥—à–µ—Å—Ç–≤—É—é—â–∏—Ö –µ–º—É. –≠—Ç–æ —Å–∞–º–∞—è –ø—Ä–æ—Å—Ç–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å –≤ —Ç–æ–º —Å–º—ã—Å–ª–µ, —á—Ç–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ X —Å —É—á–µ—Ç–æ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ - —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ X. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –µ—Å–ª–∏ –±—ã –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –º–æ–¥–µ–ª—å Unigram –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞, –º—ã –±—ã –≤—Å–µ–≥–¥–∞ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–ª–∏ –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–π—Å—è —Ç–æ–∫–µ–Ω.

–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ - —ç—Ç–æ –µ–≥–æ —á–∞—Å—Ç–æ—Ç–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑, –∫–æ–≥–¥–∞ –º—ã –µ–≥–æ –Ω–∞—Ö–æ–¥–∏–º) –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ—Ä–ø—É—Å–µ, –¥–µ–ª–µ–Ω–Ω–∞—è –Ω–∞ —Å—É–º–º—É —á–∞—Å—Ç–æ—Ç –≤—Å–µ—Ö —Ç–æ–∫–µ–Ω–æ–≤ –≤ —Å–ª–æ–≤–∞—Ä–µ (—á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å—É–º–º—ã –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π —Ä–∞–≤–Ω—ã 1). –ù–∞–ø—Ä–∏–º–µ—Ä, `"ug"` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ `"hug"`, `"pug"` –∏ `"hugs"`, –ø–æ—ç—Ç–æ–º—É –µ–≥–æ —á–∞—Å—Ç–æ—Ç–∞ –≤ –Ω–∞—à–µ–º –∫–æ—Ä–ø—É—Å–µ —Ä–∞–≤–Ω–∞ 20.

–ó–¥–µ—Å—å –ø—Ä–∏–≤–µ–¥–µ–Ω—ã —á–∞—Å—Ç–æ—Ç—ã –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø–æ–¥—Å–ª–æ–≤ –≤ —Å–ª–æ–≤–∞—Ä–µ:

```
("h", 15) ("u", 36) ("g", 20) ("hu", 15) ("ug", 20) ("p", 17) ("pu", 17) ("n", 16)
("un", 16) ("b", 4) ("bu", 4) ("s", 5) ("hug", 15) ("gs", 5) ("ugs", 5)
```

–ò—Ç–∞–∫, —Å—É–º–º–∞ –≤—Å–µ—Ö —á–∞—Å—Ç–æ—Ç —Ä–∞–≤–Ω–∞ 210, –∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ–¥—Å–ª–æ–≤–∞ `"ug"`, —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 20/210.

<Tip>

‚úèÔ∏è **–¢–µ–ø–µ—Ä—å –≤–∞—à–∞ –æ—á–µ—Ä–µ–¥—å!** –ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–¥ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤—ã—à–µ—É–∫–∞–∑–∞–Ω–Ω—ã—Ö —á–∞—Å—Ç–æ—Ç –∏ –¥–≤–∞–∂–¥—ã –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –∞ —Ç–∞–∫–∂–µ –æ–±—â—É—é —Å—É–º–º—É.

</Tip>

–¢–µ–ø–µ—Ä—å –¥–ª—è —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞ –º—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ —Ç–æ–∫–µ–Ω—ã –∏ –≤—ã—á–∏—Å–ª—è–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –∏–∑ –Ω–∏—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –º–æ–¥–µ–ª—å—é Unigram. –ü–æ—Å–∫–æ–ª—å–∫—É –≤—Å–µ —Ç–æ–∫–µ–Ω—ã —Å—á–∏—Ç–∞—é—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏, —ç—Ç–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä–∞–≤–Ω–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ `["p", "u", "g"]` —Å–ª–æ–≤–∞ `"pug"` –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç:

$$P([``p", ``u", ``g"]) = P(``p") \times P(``u") \times P(``g") = \frac{5}{210} \times \frac{36}{210} \times \frac{20}{210} = 0.000389$$

–î–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è, —Ç–æ–∫–µ–Ω `["pu", "g"]` –∏–º–µ–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:

$$P([``pu", ``g"]) = P(``pu") \times P(``g") = \frac{5}{210} \times \frac{20}{210} = 0.0022676$$

—Ç–∞–∫ —á—Ç–æ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–µ–Ω. –í —Ü–µ–ª–æ–º, —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–æ–∫–µ–Ω–æ–≤ –±—É–¥—É—Ç –∏–º–µ—Ç—å –Ω–∞–∏–±–æ–ª—å—à—É—é –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å (–∏–∑-–∑–∞ –¥–µ–ª–µ–Ω–∏—è –Ω–∞ 210, –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞), —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ–º—É –∂–µ–ª–∞–Ω–∏—é: —Ä–∞–∑–±–∏—Ç—å —Å–ª–æ–≤–æ –Ω–∞ –Ω–∞–∏–º–µ–Ω—å—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤.

–¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è —Å–ª–æ–≤–∞ —Å –ø–æ–º–æ—â—å—é –º–æ–¥–µ–ª–∏ Unigram - —ç—Ç–æ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è —Å –Ω–∞–∏–±–æ–ª—å—à–µ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é. –í –ø—Ä–∏–º–µ—Ä–µ —Å `"pug"` –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –ø–æ–ª—É—á–∏–ª–∏ –±—ã –¥–ª—è –∫–∞–∂–¥–æ–π –≤–æ–∑–º–æ–∂–Ω–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏:

```
["p", "u", "g"] : 0.000389
["p", "ug"] : 0.0022676
["pu", "g"] : 0.0022676
```

–¢–∞–∫, `"pug"` –±—É–¥–µ—Ç —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∫–∞–∫ `["p", "ug"]` –∏–ª–∏ `["pu", "g"]`, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫–∞—è –∏–∑ —ç—Ç–∏—Ö —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–π –≤—Å—Ç—Ä–µ—Ç–∏—Ç—Å—è –ø–µ—Ä–≤–æ–π (–æ—Ç–º–µ—Ç–∏–º, —á—Ç–æ –≤ –±–æ–ª—å—à–æ–º –∫–æ—Ä–ø—É—Å–µ –ø–æ–¥–æ–±–Ω—ã–µ —Å–ª—É—á–∞–∏ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ –±—É–¥—É—Ç —Ä–µ–¥–∫–∏).

–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –±—ã–ª–æ –ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –≤—ã—á–∏—Å–ª–∏—Ç—å –∏—Ö –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏, –Ω–æ –≤ –æ–±—â–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ –±—É–¥–µ—Ç –Ω–µ–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–µ–µ. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è *–∞–ª–≥–æ—Ä–∏—Ç–º –í–∏—Ç–µ—Ä–±–∏ (Viterbi algorithm)*. –ü–æ —Å—É—Ç–∏, –º—ã –º–æ–∂–µ–º –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–π –¥–∞–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞, —Å–∫–∞–∑–∞–≤, —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤–µ—Ç–≤—å –æ—Ç —Å–∏–º–≤–æ–ª–∞ _a_ –¥–æ —Å–∏–º–≤–æ–ª–∞ _b_, –µ—Å–ª–∏ –ø–æ–¥—Å–ª–æ–≤–æ –æ—Ç _a_ –¥–æ _b_ –µ—Å—Ç—å –≤ —Å–ª–æ–≤–∞—Ä–µ, –∏ –ø—Ä–∏–ø–∏—Å–∞—Ç—å —ç—Ç–æ–π –≤–µ—Ç–≤–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ–¥—Å–ª–æ–≤–∞.

–ß—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –ø—É—Ç—å –≤ —ç—Ç–æ–º –≥—Ä–∞—Ñ–µ, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏–º–µ—Ç—å –Ω–∞–∏–ª—É—á—à—É—é –æ—Ü–µ–Ω–∫—É, –∞–ª–≥–æ—Ä–∏—Ç–º –í–∏—Ç–µ—Ä–±–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ –≤ —Å–ª–æ–≤–µ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é —Å –Ω–∞–∏–ª—É—á—à–µ–π –æ—Ü–µ–Ω–∫–æ–π, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —ç—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏. –ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –∏–¥–µ–º –æ—Ç –Ω–∞—á–∞–ª–∞ –∫ –∫–æ–Ω—Ü—É, —ç—Ç–æ—Ç –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏, –ø–µ—Ä–µ–±–∏—Ä–∞—è –≤—Å–µ –ø–æ–¥—Å–ª–æ–≤–∞, –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏–µ—Å—è –Ω–∞ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏, –∞ –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É—è –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ —Å –ø–æ–∑–∏—Ü–∏–∏, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —ç—Ç–æ –ø–æ–¥—Å–ª–æ–≤–æ. –ó–∞—Ç–µ–º –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ø—É—Ç—å, —á—Ç–æ–±—ã –ø—Ä–∏–π—Ç–∏ –∫ –∫–æ–Ω—Ü—É.

–î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–∞—à–µ–≥–æ —Å–ª–æ–≤–∞—Ä—è –∏ —Å–ª–æ–≤–∞ `"unhug"`. –î–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ –ø–æ–¥—Å–ª–æ–≤–∞ —Å –Ω–∞–∏–ª—É—á—à–∏–º–∏ –æ—Ü–µ–Ω–∫–∞–º–∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```
Character 0 (u): "u" (score 0.171429)
Character 1 (n): "un" (score 0.076191)
Character 2 (h): "un" "h" (score 0.005442)
Character 3 (u): "un" "hu" (score 0.005442)
Character 4 (g): "un" "hug" (score 0.005442)
```

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, `"unhug"` –±—É–¥–µ—Ç —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∫–∞–∫ `["un", "hug"]`.

<Tip>

‚úèÔ∏è **–¢–µ–ø–µ—Ä—å –≤–∞—à–∞ –æ—á–µ—Ä–µ–¥—å!** –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—é —Å–ª–æ–≤–∞ `" huggun"` –∏ –µ–≥–æ –æ—Ü–µ–Ω–∫—É.

</Tip>

## –ù–∞–∑–∞–¥ –∫ –æ–±—É—á–µ–Ω–∏—é[[back-to-training]]

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –º—ã —É–≤–∏–¥–µ–ª–∏, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è, –º—ã –º–æ–∂–µ–º –Ω–µ–º–Ω–æ–≥–æ –≥–ª—É–±–∂–µ –∏–∑—É—á–∏—Ç—å –ø–æ—Ç–µ—Ä–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è. –ù–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ —ç—Ç–∞ –ø–æ—Ç–µ—Ä—è –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø—É—Ç–µ–º —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ –≤ –∫–æ—Ä–ø—É—Å–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–µ–∫—É—â–µ–≥–æ —Å–ª–æ–≤–∞—Ä—è –∏ –º–æ–¥–µ–ª–∏ Unigram, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º–æ–π —á–∞—Å—Ç–æ—Ç–∞–º–∏ –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –≤ –∫–æ—Ä–ø—É—Å–µ (–∫–∞–∫ –±—ã–ª–æ –ø–æ–∫–∞–∑–∞–Ω–æ —Ä–∞–Ω–µ–µ).

–ö–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ –≤ –∫–æ—Ä–ø—É—Å–µ –∏–º–µ–µ—Ç –æ—Ü–µ–Ω–∫—É, –∞ –ø–æ—Ç–µ—Ä—è - —ç—Ç–æ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –ª–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–æ–µ –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–∏–µ —ç—Ç–∏—Ö –æ—Ü–µ–Ω–æ–∫, —Ç–æ –µ—Å—Ç—å —Å—É–º–º–∞ –¥–ª—è –≤—Å–µ—Ö —Å–ª–æ–≤ –≤ –∫–æ—Ä–ø—É—Å–µ –≤—Å–µ—Ö `-log(P(word))`.

–î–∞–≤–∞–π—Ç–µ –≤–µ—Ä–Ω–µ–º—Å—è –∫ –Ω–∞—à–µ–º—É –ø—Ä–∏–º–µ—Ä—É —Å–æ —Å–ª–µ–¥—É—é—â–∏–º –∫–æ—Ä–ø—É—Å–æ–º:

```
("hug", 10), ("pug", 5), ("pun", 12), ("bun", 4), ("hugs", 5)
```

–¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –æ—Ü–µ–Ω–∫–∞–º–∏:

```
"hug": ["hug"] (score 0.071428)
"pug": ["pu", "g"] (score 0.007710)
"pun": ["pu", "n"] (score 0.006168)
"bun": ["bu", "n"] (score 0.001451)
"hugs": ["hug", "s"] (score 0.001701)
```

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø–æ—Ç–µ—Ä–∏ –±—É–¥—É—Ç:

```
10 * (-log(0.071428)) + 5 * (-log(0.007710)) + 12 * (-log(0.006168)) + 4 * (-log(0.001451)) + 5 * (-log(0.001701)) = 169.8
```

–¢–µ–ø–µ—Ä—å –Ω–∞–º –Ω—É–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å, –∫–∞–∫ —É–¥–∞–ª–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ—Ç–µ—Ä–∏. –≠—Ç–æ –¥–æ–≤–æ–ª—å–Ω–æ —É—Ç–æ–º–∏—Ç–µ–ª—å–Ω–æ, –ø–æ—ç—Ç–æ–º—É –º—ã –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞–µ–º —ç—Ç–æ –¥–ª—è –¥–≤—É—Ö —Ç–æ–∫–µ–Ω–æ–≤ –∏ –æ—Å—Ç–∞–≤–∏–º –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ç–æ–º, –∫–æ–≥–¥–∞ —É –Ω–∞—Å –±—É–¥–µ—Ç –∫–æ–¥, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å –Ω–∞–º. –í —ç—Ç–æ–º (–æ—á–µ–Ω—å) –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Å–ª—É—á–∞–µ —É –Ω–∞—Å –µ—Å—Ç—å –¥–≤–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã–µ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö —Å–ª–æ–≤: –∫–∞–∫ –º—ã –≤–∏–¥–µ–ª–∏ —Ä–∞–Ω–µ–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, `"pug"` –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ `["p", "ug"]` —Å —Ç–µ–º –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ `"pu"` –∏–∑ —Å–ª–æ–≤–∞—Ä—è –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —Ç–æ—á–Ω–æ —Ç–∞–∫–∏–º –∂–µ –ø–æ—Ç–µ—Ä—è–º.

–° –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, —É–¥–∞–ª–µ–Ω–∏–µ `" hug"` —É—Å—É–≥—É–±–∏—Ç –ø–æ—Ç–µ—Ä–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è `"hug"` –∏ `"hugs"` —Å—Ç–∞–Ω–µ—Ç:

```
"hug": ["hu", "g"] (score 0.006802)
"hugs": ["hu", "gs"] (score 0.001701)
```

–≠—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–≤–µ–¥—É—Ç –∫ —É–≤–µ–ª–∏—á–µ–Ω–∏—é –ø–æ—Ç–µ—Ä—å:

```
- 10 * (-log(0.071428)) + 10 * (-log(0.006802)) = 23.5
```

–ü–æ—ç—Ç–æ–º—É —Ç–æ–∫–µ–Ω `"pu"`, –≤–µ—Ä–æ—è—Ç–Ω–æ, –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –∏–∑ —Å–ª–æ–≤–∞—Ä—è, –Ω–æ –Ω–µ `"hug"`.

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Unigram[[implementing-unigram]]

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ —Ä–µ–∞–ª–∏–∑—É–µ–º –≤—Å–µ, —á—Ç–æ –º—ã –≤–∏–¥–µ–ª–∏ –¥–æ —Å–∏—Ö –ø–æ—Ä, –≤ –∫–æ–¥–µ. –ö–∞–∫ –∏ –≤ —Å–ª—É—á–∞–µ —Å BPE –∏ WordPiece, —ç—Ç–æ –Ω–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ Unigram (—Å–æ–≤—Å–µ–º –Ω–∞–æ–±–æ—Ä–æ—Ç), –Ω–æ –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–º–æ—á—å –≤–∞–º –ø–æ–Ω—è—Ç—å –µ–≥–æ –Ω–µ–º–Ω–æ–≥–æ –ª—É—á—à–µ.

–í –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–∏–º–µ—Ä–∞ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ –∫–æ—Ä–ø—É—Å —Ç–µ–∫—Å—Ç–∞, —á—Ç–æ –∏ —Ä–∞–Ω—å—à–µ:

```python
corpus = [
    "This is the Hugging Face Course.",
    "This chapter is about tokenization.",
    "This section shows several tokenizer algorithms.",
    "Hopefully, you will be able to understand how they are trained and generate tokens.",
]
```

–ù–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –º–æ–¥–µ–ª–∏ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `xlnet-base-cased`:

```python
from transformers import AutoTokenizer

tokenizer = AutoTokenizer.from_pretrained("xlnet-base-cased")
```

–ö–∞–∫ –∏ –≤ —Å–ª—É—á–∞–µ —Å BPE –∏ WordPiece, –º—ã –Ω–∞—á–∏–Ω–∞–µ–º —Å –ø–æ–¥—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—Ö–æ–∂–¥–µ–Ω–∏–π –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ –≤ –∫–æ—Ä–ø—É—Å:

```python
from collections import defaultdict

word_freqs = defaultdict(int)
for text in corpus:
    words_with_offsets = tokenizer.backend_tokenizer.pre_tokenizer.pre_tokenize_str(text)
    new_words = [word for word, offset in words_with_offsets]
    for word in new_words:
        word_freqs[word] += 1

word_freqs
```

–ó–∞—Ç–µ–º –Ω–∞–º –Ω—É–∂–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—à —Å–ª–æ–≤–∞—Ä—å —á–µ–º-—Ç–æ –±–æ–ª—å—à–∏–º, —á–µ–º —Ä–∞–∑–º–µ—Ä —Å–ª–æ–≤–∞—Ä—è, –∫–æ—Ç–æ—Ä—ã–π –º—ã –∑–∞—Ö–æ—Ç–∏–º –ø–æ–ª—É—á–∏—Ç—å –≤ –∫–æ–Ω—Ü–µ. –ú—ã –¥–æ–ª–∂–Ω—ã –≤–∫–ª—é—á–∏—Ç—å –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (–∏–Ω–∞—á–µ –º—ã –Ω–µ —Å–º–æ–∂–µ–º —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ), –Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø–æ–¥—Å—Ç—Ä–æ–∫ –º—ã —Å–æ—Ö—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ —Å–∞–º—ã–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ, –ø–æ—ç—Ç–æ–º—É –º—ã –æ—Ç—Å–æ—Ä—Ç–∏—Ä—É–µ–º –∏—Ö –ø–æ —á–∞—Å—Ç–æ—Ç–µ:

```python
char_freqs = defaultdict(int)
subwords_freqs = defaultdict(int)
for word, freq in word_freqs.items():
    for i in range(len(word)):
        char_freqs[word[i]] += freq
        # –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–ª–æ–≤–∞ –¥–ª–∏–Ω–æ–π –Ω–µ –º–µ–Ω–µ–µ 2
        for j in range(i + 2, len(word) + 1):
            subwords_freqs[word[i:j]] += freq

# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ–¥—Å–ª–æ–≤ –ø–æ —á–∞—Å—Ç–æ—Ç–µ
sorted_subwords = sorted(subwords_freqs.items(), key=lambda x: x[1], reverse=True)
sorted_subwords[:10]
```

```python out
[('‚ñÅt', 7), ('is', 5), ('er', 5), ('‚ñÅa', 5), ('‚ñÅto', 4), ('to', 4), ('en', 4), ('‚ñÅT', 3), ('‚ñÅTh', 3), ('‚ñÅThi', 3)]
```

–ú—ã –≥—Ä—É–ø–ø–∏—Ä—É–µ–º —Å–∏–º–≤–æ–ª—ã —Å –ª—É—á—à–∏–º–∏ –ø–æ–¥—Å–ª–æ–≤–∞–º–∏, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å —Ä–∞–∑–º–µ—Ä–æ–º 300:

```python
token_freqs = list(char_freqs.items()) + sorted_subwords[: 300 - len(char_freqs)]
token_freqs = {token: freq for token, freq in token_freqs}
```

<Tip>

üí° SentencePiece –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º Enhanced Suffix Array (ESA) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–ª–æ–≤–∞—Ä—è.

</Tip>

–î–∞–ª–µ–µ –º—ã –≤—ã—á–∏—Å–ª—è–µ–º —Å—É–º–º—É –≤—Å–µ—Ö —á–∞—Å—Ç–æ—Ç, —á—Ç–æ–±—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —á–∞—Å—Ç–æ—Ç—ã –≤ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏. –î–ª—è –Ω–∞—à–µ–π –º–æ–¥–µ–ª–∏ –º—ã –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∞—Ä–∏—Ñ–º—ã –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π, –ø–æ—Ç–æ–º—É —á—Ç–æ —á–∏—Å–ª–µ–Ω–Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å –ª–æ–≥–∞—Ä–∏—Ñ–º—ã, —á–µ–º –ø–µ—Ä–µ–º–Ω–æ–∂–∞—Ç—å –º–∞–ª–µ–Ω—å–∫–∏–µ —á–∏—Å–ª–∞, –∏ —ç—Ç–æ —É–ø—Ä–æ—Å—Ç–∏—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—å –º–æ–¥–µ–ª–∏:

```python
from math import log

total_sum = sum([freq for token, freq in token_freqs.items()])
model = {token: -log(freq / total_sum) for token, freq in token_freqs.items()}
```

–¢–µ–ø–µ—Ä—å –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ —Å–ª–æ–≤ —Å –ø–æ–º–æ—â—å—é –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –í–∏—Ç–µ—Ä–±–∏. –ö–∞–∫ –º—ã —É–∂–µ –≤–∏–¥–µ–ª–∏, —ç—Ç–æ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã—á–∏—Å–ª—è–µ—Ç –Ω–∞–∏–ª—É—á—à—É—é —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é –∫–∞–∂–¥–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ —Å–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—É—é –º—ã –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å –∏–º–µ–Ω–µ–º `best_segmentations`. –ú—ã –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –ø–æ –æ–¥–Ω–æ–º—É —Å–ª–æ–≤–∞—Ä—é –Ω–∞ –∫–∞–∂–¥—É—é –ø–æ–∑–∏—Ü–∏—é –≤ —Å–ª–æ–≤–µ (–æ—Ç 0 –¥–æ –µ–≥–æ –ø–æ–ª–Ω–æ–π –¥–ª–∏–Ω—ã), —Å –¥–≤—É–º—è –∫–ª—é—á–∞–º–∏: –∏–Ω–¥–µ–∫—Å –Ω–∞—á–∞–ª–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ç–æ–∫–µ–Ω–∞ –≤ –ª—É—á—à–µ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –æ—Ü–µ–Ω–∫–∞ –ª—É—á—à–µ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏. –ü–æ –∏–Ω–¥–µ–∫—Å—É –Ω–∞—á–∞–ª–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ç–æ–∫–µ–Ω–∞ –º—ã —Å–º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é, –∫–æ–≥–¥–∞ —Å–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω.

–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –¥–≤—É—Ö —Ü–∏–∫–ª–æ–≤: –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –∫–∞–∂–¥—É—é –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é, –∞ –≤—Ç–æ—Ä–æ–π —Ü–∏–∫–ª –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å —ç—Ç–æ–π –Ω–∞—á–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏. –ï—Å–ª–∏ –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ –µ—Å—Ç—å –≤ —Å–ª–æ–≤–∞—Ä–µ, –º—ã –ø–æ–ª—É—á–∞–µ–º –Ω–æ–≤—É—é —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é —Å–ª–æ–≤–∞ –¥–æ —ç—Ç–æ–π –∫–æ–Ω–µ—á–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏, –∫–æ—Ç–æ—Ä—É—é —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å —Ç–æ–π, —á—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `best_segmentations`.

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –º—ã –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–∏–Ω–∞–µ–º —Å –∫–æ–Ω—Ü–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –æ—Ç –æ–¥–Ω–æ–π –Ω–∞—á–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –∫ –¥—Ä—É–≥–æ–π, –∑–∞–ø–∏—Å—ã–≤–∞—è —Ç–æ–∫–µ–Ω—ã –ø–æ –º–µ—Ä–µ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è, –ø–æ–∫–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ–º –Ω–∞—á–∞–ª–∞ —Å–ª–æ–≤–∞:

```python
def encode_word(word, model):
    best_segmentations = [{"start": 0, "score": 1}] + [
        {"start": None, "score": None} for _ in range(len(word))
    ]
    for start_idx in range(len(word)):
        # –≠—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ —à–∞–≥–∞–º–∏ —Ü–∏–∫–ª–∞
        best_score_at_start = best_segmentations[start_idx]["score"]
        for end_idx in range(start_idx + 1, len(word) + 1):
            token = word[start_idx:end_idx]
            if token in model and best_score_at_start is not None:
                score = model[token] + best_score_at_start
                # –ï—Å–ª–∏ –º—ã –Ω–∞—à–ª–∏ –ª—É—á—à—É—é —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é, –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â—É—é—Å—è –Ω–∞ end_idx, –º—ã –æ–±–Ω–æ–≤–ª—è–µ–º
                if (
                    best_segmentations[end_idx]["score"] is None
                    or best_segmentations[end_idx]["score"] > score
                ):
                    best_segmentations[end_idx] = {"start": start_idx, "score": score}

    segmentation = best_segmentations[-1]
    if segmentation["score"] is None:
        # –ú—ã –Ω–µ –Ω–∞—à–ª–∏ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—é —Å–ª–æ–≤–∞ -> –≤–æ–∑–≤—Ä–∞—â–∞–µ–º unknown
        return ["<unk>"], None

    score = segmentation["score"]
    start = segmentation["start"]
    end = len(word)
    tokens = []
    while start != 0:
        tokens.insert(0, word[start:end])
        next_start = best_segmentations[start]["start"]
        end = start
        start = next_start
    tokens.insert(0, word[start:end])
    return tokens, score
```

–ú—ã —É–∂–µ –º–æ–∂–µ–º –æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–∞—à—É –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª–æ–≤–∞—Ö:

```python
print(encode_word("Hopefully", model))
print(encode_word("This", model))
```

```python out
(['H', 'o', 'p', 'e', 'f', 'u', 'll', 'y'], 41.5157494601402)
(['This'], 6.288267030694535)
```

–¢–µ–ø–µ—Ä—å –ª–µ–≥–∫–æ –≤—ã—á–∏—Å–ª–∏—Ç—å –ø–æ—Ç–µ—Ä–∏ –º–æ–¥–µ–ª–∏ –Ω–∞ –∫–æ—Ä–ø—É—Å–µ!

```python
def compute_loss(model):
    loss = 0
    for word, freq in word_freqs.items():
        _, word_loss = encode_word(word, model)
        loss += freq * word_loss
    return loss
```

–ú—ã –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ —Ä–∞–±–æ—Ç—É –Ω–∞ –∏–º–µ—é—â–µ–π—Å—è —É –Ω–∞—Å –º–æ–¥–µ–ª–∏:

```python
compute_loss(model)
```

```python out
413.10377642940875
```

–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ —Ç–∞–∫–∂–µ –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Å–æ–±–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏; –Ω–∞–º –ø—Ä–æ—Å—Ç–æ –Ω—É–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å –ø–æ—Ç–µ—Ä–∏ –¥–ª—è –º–æ–¥–µ–ª–∏, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞:

```python
import copy


def compute_scores(model):
    scores = {}
    model_loss = compute_loss(model)
    for token, score in model.items():
        # –ú—ã –≤—Å–µ–≥–¥–∞ —Ö—Ä–∞–Ω–∏–º —Ç–æ–∫–µ–Ω—ã –¥–ª–∏–Ω–æ–π 1
        if len(token) == 1:
            continue
        model_without_token = copy.deepcopy(model)
        _ = model_without_token.pop(token)
        scores[token] = compute_loss(model_without_token) - model_loss
    return scores
```

–ú—ã –º–æ–∂–µ–º –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —ç—Ç–æ –Ω–∞ –∑–∞–¥–∞–Ω–Ω–æ–º —Ç–æ–∫–µ–Ω–µ:

```python
scores = compute_scores(model)
print(scores["ll"])
print(scores["his"])
```

–ü–æ—Å–∫–æ–ª—å–∫—É `"ll"` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ —Å–ª–æ–≤–∞ `"Hopefully"`, –∏ –µ–≥–æ —É–¥–∞–ª–µ–Ω–∏–µ, –≤–µ—Ä–æ—è—Ç–Ω–æ, –∑–∞—Å—Ç–∞–≤–∏—Ç –Ω–∞—Å –¥–≤–∞–∂–¥—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω `"l"` –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ, –º—ã –æ–∂–∏–¥–∞–µ–º, —á—Ç–æ –æ–Ω –±—É–¥–µ—Ç –∏–º–µ—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—É—é –ø–æ—Ç–µ—Ä—é. `"his"` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Å–ª–æ–≤–∞ `"This"`, –∫–æ—Ç–æ—Ä–æ–µ —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å–∞–º–æ –ø–æ —Å–µ–±–µ, –ø–æ—ç—Ç–æ–º—É –º—ã –æ–∂–∏–¥–∞–µ–º, —á—Ç–æ –ø–æ—Ç–µ—Ä–∏ –±—É–¥—É—Ç –Ω—É–ª–µ–≤—ã–º–∏. –í–æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

```python out
6.376412403623874
0.0
```

<Tip>

üí° –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –æ—á–µ–Ω—å –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω, –ø–æ—ç—Ç–æ–º—É SentencePiece –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω—É—é –æ—Ü–µ–Ω–∫—É –ø–æ—Ç–µ—Ä—å –º–æ–¥–µ–ª–∏ –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ X: –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –Ω–∞—á–∏–Ω–∞—Ç—å —Å –Ω—É–ª—è, –æ–Ω –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω X –µ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–µ–π –≤ –æ—Å—Ç–∞–≤—à–µ–º—Å—è —Å–ª–æ–≤–∞—Ä–µ. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤—Å–µ –æ—Ü–µ–Ω–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –ø–æ—Ç–µ—Ä—è–º–∏ –º–æ–¥–µ–ª–∏.

</Tip>

–ö–æ–≥–¥–∞ —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è, –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å–ª–æ–≤–∞—Ä—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª—å—é, –∞ –∑–∞—Ç–µ–º –∏—Ç–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è, –ø–æ–∫–∞ –º—ã –Ω–µ –≤—ã—á–µ—Ä–∫–Ω–µ–º –∏–∑ —Å–ª–æ–≤–∞—Ä—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤, —á—Ç–æ–±—ã –¥–æ—Å—Ç–∏—á—å –∂–µ–ª–∞–µ–º–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞:

```python
percent_to_remove = 0.1
while len(model) > 100:
    scores = compute_scores(model)
    sorted_scores = sorted(scores.items(), key=lambda x: x[1])
    # –£–¥–∞–ª–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã percent_to_remove —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º–∏ –æ—Ü–µ–Ω–∫–∞–º–∏
    for i in range(int(len(model) * percent_to_remove)):
        _ = token_freqs.pop(sorted_scores[i][0])

    total_sum = sum([freq for token, freq in token_freqs.items()])
    model = {token: -log(freq / total_sum) for token, freq in token_freqs.items()}
```

–ó–∞—Ç–µ–º, —á—Ç–æ–±—ã —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–π —Ç–µ–∫—Å—Ç, –Ω–∞–º –ø—Ä–æ—Å—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—é, –∞ –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é `encode_word()`:

```python
def tokenize(text, model):
    words_with_offsets = tokenizer.backend_tokenizer.pre_tokenizer.pre_tokenize_str(text)
    pre_tokenized_text = [word for word, offset in words_with_offsets]
    encoded_words = [encode_word(word, model)[0] for word in pre_tokenized_text]
    return sum(encoded_words, [])


tokenize("This is the Hugging Face course.", model)
```

```python out
['‚ñÅThis', '‚ñÅis', '‚ñÅthe', '‚ñÅHugging', '‚ñÅFace', '‚ñÅ', 'c', 'ou', 'r', 's', 'e', '.']
```

–í–æ—Ç –∏ –≤—Å–µ –æ–± Unigram! –ù–∞–¥–µ–µ–º—Å—è, —Ç–µ–ø–µ—Ä—å –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è —ç–∫—Å–ø–µ—Ä—Ç–æ–º –≤–æ –≤—Å–µ–º, —á—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤. –í —Å–ª–µ–¥—É—é—â–µ–º —Ä–∞–∑–¥–µ–ª–µ –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –±–ª–æ–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ ü§ó Tokenizers –∏ –ø–æ–∫–∞–∂–µ–º, –∫–∞–∫ –∏—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä–∞.
